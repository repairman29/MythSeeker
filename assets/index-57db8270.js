var e=Object.defineProperty,t=(t,a,n)=>(((t,a,n)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n})(t,"symbol"!=typeof a?a+"":a,n),n);import{r as a,a as n,R as r,b as s,c as i}from"./react-vendor-132e4a4f.js";import{T as o,r as l,_ as c,C as d,b as u,E as h,F as m,U as p,h as g,d as f,k as x,m as y,e as b,V as w,W as v,X as j,Y as N}from"./firebase-core-8eeeb07d.js";import{g as k,G as C,s as S,a as A,b as T,c as E,o as P}from"./firebase-auth-1430596a.js";import{g as M,s as I,d as D,a as R,u as $,b as L,c as O,q as _,w as U,e as F,f as z,h as W,o as H,i as B}from"./firebase-firestore-534e8e51.js";import{g as q}from"./firebase-database-c7b0c40e.js";import{S as V,A as Y,T as G,U as J,C as K,a as X,b as Q,c as Z,d as ee,e as te,R as ae,H as ne,X as re,Z as se,f as ie,F as oe,g as le,G as ce,h as de,i as ue,B as he,P as me,j as pe,k as ge,l as fe}from"./ui-vendor-ea82f2ea.js";import{g as xe,h as ye}from"./firebase-functions-a61ddb80.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var be={exports:{}},we={},ve=a,je=Symbol.for("react.element"),Ne=Symbol.for("react.fragment"),ke=Object.prototype.hasOwnProperty,Ce=ve.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Se={key:!0,ref:!0,__self:!0,__source:!0};function Ae(e,t,a){var n,r={},s=null,i=null;for(n in void 0!==a&&(s=""+a),void 0!==t.key&&(s=""+t.key),void 0!==t.ref&&(i=t.ref),t)ke.call(t,n)&&!Se.hasOwnProperty(n)&&(r[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===r[n]&&(r[n]=t[n]);return{$$typeof:je,type:e,key:s,ref:i,props:r,_owner:Ce.current}}we.Fragment=Ne,we.jsx=Ae,we.jsxs=Ae,be.exports=we;var Te=be.exports,Ee={},Pe=n;Ee.createRoot=Pe.createRoot,Ee.hydrateRoot=Pe.hydrateRoot;const Me={},Ie=function(e,t,a){if(!t||0===t.length)return e();const n=document.getElementsByTagName("link");return Promise.all(t.map(e=>{if((e=function(e){return"/"+e}(e))in Me)return;Me[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(a)for(let a=n.length-1;a>=0;a--){const r=n[a];if(r.href===e&&(!t||"stylesheet"===r.rel))return}else if(document.querySelector(`link[href="${e}"]${r}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script",s.crossOrigin=""),s.href=e,document.head.appendChild(s),t?new Promise((t,a)=>{s.addEventListener("load",t),s.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0})).then(()=>e()).catch(e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e})};var De={};Object.defineProperty(De,"__esModule",{value:!0}),De.parse=function(e,t){const a=new Ue,n=e.length;if(n<2)return a;const r=(null==t?void 0:t.decode)||We;let s=0;do{const t=e.indexOf("=",s);if(-1===t)break;const i=e.indexOf(";",s),o=-1===i?n:i;if(t>o){s=e.lastIndexOf(";",t-1)+1;continue}const l=Fe(e,s,t),c=ze(e,t,l),d=e.slice(l,c);if(void 0===a[d]){let n=Fe(e,t+1,o),s=ze(e,o,n);const i=r(e.slice(n,s));a[d]=i}s=o+1}while(s<n);return a},De.serialize=function(e,t,a){const n=(null==a?void 0:a.encode)||encodeURIComponent;if(!Re.test(e))throw new TypeError(`argument name is invalid: ${e}`);const r=n(t);if(!$e.test(r))throw new TypeError(`argument val is invalid: ${t}`);let s=e+"="+r;if(!a)return s;if(void 0!==a.maxAge){if(!Number.isInteger(a.maxAge))throw new TypeError(`option maxAge is invalid: ${a.maxAge}`);s+="; Max-Age="+a.maxAge}if(a.domain){if(!Le.test(a.domain))throw new TypeError(`option domain is invalid: ${a.domain}`);s+="; Domain="+a.domain}if(a.path){if(!Oe.test(a.path))throw new TypeError(`option path is invalid: ${a.path}`);s+="; Path="+a.path}if(a.expires){if(!function(e){return"[object Date]"===_e.call(e)}(a.expires)||!Number.isFinite(a.expires.valueOf()))throw new TypeError(`option expires is invalid: ${a.expires}`);s+="; Expires="+a.expires.toUTCString()}if(a.httpOnly&&(s+="; HttpOnly"),a.secure&&(s+="; Secure"),a.partitioned&&(s+="; Partitioned"),a.priority)switch("string"==typeof a.priority?a.priority.toLowerCase():void 0){case"low":s+="; Priority=Low";break;case"medium":s+="; Priority=Medium";break;case"high":s+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${a.priority}`)}if(a.sameSite)switch("string"==typeof a.sameSite?a.sameSite.toLowerCase():a.sameSite){case!0:case"strict":s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"none":s+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${a.sameSite}`)}return s};const Re=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,$e=/^[\u0021-\u003A\u003C-\u007E]*$/,Le=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,Oe=/^[\u0020-\u003A\u003D-\u007E]*$/,_e=Object.prototype.toString,Ue=(()=>{const e=function(){};return e.prototype=Object.create(null),e})();function Fe(e,t,a){do{const a=e.charCodeAt(t);if(32!==a&&9!==a)return t}while(++t<a);return a}function ze(e,t,a){for(;t>a;){const a=e.charCodeAt(--t);if(32!==a&&9!==a)return t+1}return a}function We(e){if(-1===e.indexOf("%"))return e;try{return decodeURIComponent(e)}catch(t){return e}}var He="popstate";function Be(e,t){if(!1===e||null==e)throw new Error(t)}function qe(e,t){if(!e)try{throw new Error(t)}catch(a){}}function Ve(e,t){return{usr:e.state,key:e.key,idx:t}}function Ye(e,t,a=null,n){return{pathname:"string"==typeof e?e:e.pathname,search:"",hash:"",..."string"==typeof t?Je(t):t,state:a,key:t&&t.key||n||Math.random().toString(36).substring(2,10)}}function Ge({pathname:e="/",search:t="",hash:a=""}){return t&&"?"!==t&&(e+="?"===t.charAt(0)?t:"?"+t),a&&"#"!==a&&(e+="#"===a.charAt(0)?a:"#"+a),e}function Je(e){let t={};if(e){let a=e.indexOf("#");a>=0&&(t.hash=e.substring(a),e=e.substring(0,a));let n=e.indexOf("?");n>=0&&(t.search=e.substring(n),e=e.substring(0,n)),e&&(t.pathname=e)}return t}function Ke(e,t,a="/"){return function(e,t,a){let n=dt(("string"==typeof t?Je(t):t).pathname||"/",a);if(null==n)return null;let r=Xe(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){return e.length===t.length&&e.slice(0,-1).every((e,a)=>e===t[a])?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(r);let s=null;for(let i=0;null==s&&i<r.length;++i){let e=ct(n);s=ot(r[i],e,false)}return s}(e,t,a)}function Xe(e,t=[],a=[],n=""){let r=(e,r,s)=>{let i={relativePath:void 0===s?e.path||"":s,caseSensitive:!0===e.caseSensitive,childrenIndex:r,route:e};i.relativePath.startsWith("/")&&(Be(i.relativePath.startsWith(n),`Absolute route path "${i.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),i.relativePath=i.relativePath.slice(n.length));let o=pt([n,i.relativePath]),l=a.concat(i);e.children&&e.children.length>0&&(Be(!0!==e.index,`Index routes must not have child routes. Please remove all child routes from route path "${o}".`),Xe(e.children,t,l,o)),(null!=e.path||e.index)&&t.push({path:o,score:it(o,e.index),routesMeta:l})};return e.forEach((e,t)=>{var a;if(""!==e.path&&(null==(a=e.path)?void 0:a.includes("?")))for(let n of Qe(e.path))r(e,t,n);else r(e,t)}),t}function Qe(e){let t=e.split("/");if(0===t.length)return[];let[a,...n]=t,r=a.endsWith("?"),s=a.replace(/\?$/,"");if(0===n.length)return r?[s,""]:[s];let i=Qe(n.join("/")),o=[];return o.push(...i.map(e=>""===e?s:[s,e].join("/"))),r&&o.push(...i),o.map(t=>e.startsWith("/")&&""===t?"/":t)}var Ze=/^:[\w-]+$/,et=3,tt=2,at=1,nt=10,rt=-2,st=e=>"*"===e;function it(e,t){let a=e.split("/"),n=a.length;return a.some(st)&&(n+=rt),t&&(n+=tt),a.filter(e=>!st(e)).reduce((e,t)=>e+(Ze.test(t)?et:""===t?at:nt),n)}function ot(e,t,a=!1){let{routesMeta:n}=e,r={},s="/",i=[];for(let o=0;o<n.length;++o){let e=n[o],l=o===n.length-1,c="/"===s?t:t.slice(s.length)||"/",d=lt({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),u=e.route;if(!d&&l&&a&&!n[n.length-1].route.index&&(d=lt({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!d)return null;Object.assign(r,d.params),i.push({params:r,pathname:pt([s,d.pathname]),pathnameBase:gt(pt([s,d.pathnameBase])),route:u}),"/"!==d.pathnameBase&&(s=pt([s,d.pathnameBase]))}return i}function lt(e,t){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[a,n]=function(e,t=!1,a=!0){qe("*"===e||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let n=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,a)=>(n.push({paramName:t,isOptional:null!=a}),a?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),r+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?r+="\\/*$":""!==e&&"/"!==e&&(r+="(?:(?=\\/|$))"),[new RegExp(r,t?void 0:"i"),n]}(e.path,e.caseSensitive,e.end),r=t.match(a);if(!r)return null;let s=r[0],i=s.replace(/(.)\/+$/,"$1"),o=r.slice(1);return{params:n.reduce((e,{paramName:t,isOptional:a},n)=>{if("*"===t){let e=o[n]||"";i=s.slice(0,s.length-e.length).replace(/(.)\/+$/,"$1")}const r=o[n];return e[t]=a&&!r?void 0:(r||"").replace(/%2F/g,"/"),e},{}),pathname:s,pathnameBase:i,pattern:e}}function ct(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return qe(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function dt(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let a=t.endsWith("/")?t.length-1:t.length,n=e.charAt(a);return n&&"/"!==n?null:e.slice(a)||"/"}function ut(e,t,a,n){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${a}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function ht(e){let t=function(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}(e);return t.map((e,a)=>a===t.length-1?e.pathname:e.pathnameBase)}function mt(e,t,a,n=!1){let r;"string"==typeof e?r=Je(e):(r={...e},Be(!r.pathname||!r.pathname.includes("?"),ut("?","pathname","search",r)),Be(!r.pathname||!r.pathname.includes("#"),ut("#","pathname","hash",r)),Be(!r.search||!r.search.includes("#"),ut("#","search","hash",r)));let s,i=""===e||""===r.pathname,o=i?"/":r.pathname;if(null==o)s=a;else{let e=t.length-1;if(!n&&o.startsWith("..")){let t=o.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}s=e>=0?t[e]:"/"}let l=function(e,t="/"){let{pathname:a,search:n="",hash:r=""}="string"==typeof e?Je(e):e,s=a?a.startsWith("/")?a:function(e,t){let a=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?a.length>1&&a.pop():"."!==e&&a.push(e)}),a.length>1?a.join("/"):"/"}(a,t):t;return{pathname:s,search:ft(n),hash:xt(r)}}(r,s),c=o&&"/"!==o&&o.endsWith("/"),d=(i||"."===o)&&a.endsWith("/");return l.pathname.endsWith("/")||!c&&!d||(l.pathname+="/"),l}var pt=e=>e.join("/").replace(/\/\/+/g,"/"),gt=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),ft=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",xt=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"",yt=["POST","PUT","PATCH","DELETE"];new Set(yt);var bt=["GET",...yt];new Set(bt);var wt=a.createContext(null);wt.displayName="DataRouter";var vt=a.createContext(null);vt.displayName="DataRouterState";var jt=a.createContext({isTransitioning:!1});jt.displayName="ViewTransition",a.createContext(new Map).displayName="Fetchers",a.createContext(null).displayName="Await";var Nt=a.createContext(null);Nt.displayName="Navigation";var kt=a.createContext(null);kt.displayName="Location";var Ct=a.createContext({outlet:null,matches:[],isDataRoute:!1});Ct.displayName="Route";var St=a.createContext(null);function At(){return null!=a.useContext(kt)}function Tt(){return Be(At(),"useLocation() may be used only in the context of a <Router> component."),a.useContext(kt).location}St.displayName="RouteError";var Et="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Pt(e){a.useContext(Nt).static||a.useLayoutEffect(e)}function Mt(){let{isDataRoute:e}=a.useContext(Ct);return e?function(){let{router:e}=function(){let e=a.useContext(wt);return Be(e,_t("useNavigate")),e}(),t=Ut("useNavigate"),n=a.useRef(!1);return Pt(()=>{n.current=!0}),a.useCallback(async(a,r={})=>{qe(n.current,Et),n.current&&("number"==typeof a?e.navigate(a):await e.navigate(a,{fromRouteId:t,...r}))},[e,t])}():function(){Be(At(),"useNavigate() may be used only in the context of a <Router> component.");let e=a.useContext(wt),{basename:t,navigator:n}=a.useContext(Nt),{matches:r}=a.useContext(Ct),{pathname:s}=Tt(),i=JSON.stringify(ht(r)),o=a.useRef(!1);return Pt(()=>{o.current=!0}),a.useCallback((a,r={})=>{if(qe(o.current,Et),!o.current)return;if("number"==typeof a)return void n.go(a);let l=mt(a,JSON.parse(i),s,"path"===r.relative);null==e&&"/"!==t&&(l.pathname="/"===l.pathname?t:pt([t,l.pathname])),(r.replace?n.replace:n.push)(l,r.state,r)},[t,n,i,s,e])}()}function It(e,{relative:t}={}){let{matches:n}=a.useContext(Ct),{pathname:r}=Tt(),s=JSON.stringify(ht(n));return a.useMemo(()=>mt(e,JSON.parse(s),r,"path"===t),[e,s,r,t])}function Dt(e,t,n,r){var s;Be(At(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=a.useContext(Nt),{matches:o}=a.useContext(Ct),l=o[o.length-1],c=l?l.params:{},d=l?l.pathname:"/",u=l?l.pathnameBase:"/",h=l&&l.route;{let e=h&&h.path||"";zt(d,!h||e.endsWith("*")||e.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${e}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.\n\nPlease change the parent <Route path="${e}"> to <Route path="${"/"===e?"*":`${e}/*`}">.`)}let m,p=Tt();if(t){let e="string"==typeof t?Je(t):t;Be("/"===u||(null==(s=e.pathname)?void 0:s.startsWith(u)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${e.pathname}" was given in the \`location\` prop.`),m=e}else m=p;let g=m.pathname||"/",f=g;if("/"!==u){let e=u.replace(/^\//,"").split("/");f="/"+g.replace(/^\//,"").split("/").slice(e.length).join("/")}let x=Ke(e,{pathname:f});qe(h||null!=x,`No routes matched location "${m.pathname}${m.search}${m.hash}" `),qe(null==x||void 0!==x[x.length-1].route.element||void 0!==x[x.length-1].route.Component||void 0!==x[x.length-1].route.lazy,`Matched leaf route at location "${m.pathname}${m.search}${m.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let y=function(e,t=[],n=null){if(null==e){if(!n)return null;if(n.errors)e=n.matches;else{if(0!==t.length||n.initialized||!(n.matches.length>0))return null;e=n.matches}}let r=e,s=null==n?void 0:n.errors;if(null!=s){let e=r.findIndex(e=>e.route.id&&void 0!==(null==s?void 0:s[e.route.id]));Be(e>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),r=r.slice(0,Math.min(r.length,e+1))}let i=!1,o=-1;if(n)for(let a=0;a<r.length;a++){let e=r[a];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(o=a),e.route.id){let{loaderData:t,errors:a}=n,s=e.route.loader&&!t.hasOwnProperty(e.route.id)&&(!a||void 0===a[e.route.id]);if(e.route.lazy||s){i=!0,r=o>=0?r.slice(0,o+1):[r[0]];break}}}return r.reduceRight((e,l,c)=>{let d,u=!1,h=null,m=null;n&&(d=s&&l.route.id?s[l.route.id]:void 0,h=l.route.errorElement||$t,i&&(o<0&&0===c?(zt("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),u=!0,m=null):o===c&&(u=!0,m=l.route.hydrateFallbackElement||null)));let p=t.concat(r.slice(0,c+1)),g=()=>{let t;return t=d?h:u?m:l.route.Component?a.createElement(l.route.Component,null):l.route.element?l.route.element:e,a.createElement(Ot,{match:l,routeContext:{outlet:e,matches:p,isDataRoute:null!=n},children:t})};return n&&(l.route.ErrorBoundary||l.route.errorElement||0===c)?a.createElement(Lt,{location:n.location,revalidation:n.revalidation,component:h,error:d,children:g(),routeContext:{outlet:null,matches:p,isDataRoute:!0}}):g()},null)}(x&&x.map(e=>Object.assign({},e,{params:Object.assign({},c,e.params),pathname:pt([u,i.encodeLocation?i.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:pt([u,i.encodeLocation?i.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),o,n);return t&&y?a.createElement(kt.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...m},navigationType:"POP"}},y):y}function Rt(){let e=function(){var e;let t=a.useContext(St),n=function(){let e=a.useContext(vt);return Be(e,_t("useRouteError")),e}(),r=Ut("useRouteError");return void 0!==t?t:null==(e=n.errors)?void 0:e[r]}(),t=function(e){return null!=e&&"number"==typeof e.status&&"string"==typeof e.statusText&&"boolean"==typeof e.internal&&"data"in e}(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},o=null;return o=a.createElement(a.Fragment,null,a.createElement("p",null,"ðŸ’¿ Hey developer ðŸ‘‹"),a.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",a.createElement("code",{style:i},"ErrorBoundary")," or"," ",a.createElement("code",{style:i},"errorElement")," prop on your route.")),a.createElement(a.Fragment,null,a.createElement("h2",null,"Unexpected Application Error!"),a.createElement("h3",{style:{fontStyle:"italic"}},t),n?a.createElement("pre",{style:s},n):null,o)}a.createContext(null);var $t=a.createElement(Rt,null),Lt=class extends a.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){}render(){return void 0!==this.state.error?a.createElement(Ct.Provider,{value:this.props.routeContext},a.createElement(St.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Ot({routeContext:e,match:t,children:n}){let r=a.useContext(wt);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),a.createElement(Ct.Provider,{value:e},n)}function _t(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Ut(e){let t=function(e){let t=a.useContext(Ct);return Be(t,_t(e)),t}(e),n=t.matches[t.matches.length-1];return Be(n.route.id,`${e} can only be used on routes that contain a unique "id"`),n.route.id}var Ft={};function zt(e,t,a){t||Ft[e]||(Ft[e]=!0,qe(!1,a))}function Wt({to:e,replace:t,state:n,relative:r}){Be(At(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=a.useContext(Nt);qe(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=a.useContext(Ct),{pathname:o}=Tt(),l=Mt(),c=mt(e,ht(i),o,"path"===r),d=JSON.stringify(c);return a.useEffect(()=>{l(JSON.parse(d),{replace:t,state:n,relative:r})},[l,d,r,t,n]),null}function Ht(e){Be(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Bt({basename:e="/",children:t=null,location:n,navigationType:r="POP",navigator:s,static:i=!1}){Be(!At(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=e.replace(/^\/*/,"/"),l=a.useMemo(()=>({basename:o,navigator:s,static:i,future:{}}),[o,s,i]);"string"==typeof n&&(n=Je(n));let{pathname:c="/",search:d="",hash:u="",state:h=null,key:m="default"}=n,p=a.useMemo(()=>{let e=dt(c,o);return null==e?null:{location:{pathname:e,search:d,hash:u,state:h,key:m},navigationType:r}},[o,c,d,u,h,m,r]);return qe(null!=p,`<Router basename="${o}"> is not able to match the URL "${c}${d}${u}" because it does not start with the basename, so the <Router> won't render anything.`),null==p?null:a.createElement(Nt.Provider,{value:l},a.createElement(kt.Provider,{children:t,value:p}))}function qt({children:e,location:t}){return Dt(Vt(e),t)}function Vt(e,t=[]){let n=[];return a.Children.forEach(e,(e,r)=>{if(!a.isValidElement(e))return;let s=[...t,r];if(e.type===a.Fragment)return void n.push.apply(n,Vt(e.props.children,s));Be(e.type===Ht,`[${"string"==typeof e.type?e.type:e.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Be(!e.props.index||!e.props.children,"An index route cannot have child routes.");let i={id:e.props.id||s.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,hydrateFallbackElement:e.props.hydrateFallbackElement,HydrateFallback:e.props.HydrateFallback,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:!0===e.props.hasErrorBoundary||null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(i.children=Vt(e.props.children,s)),n.push(i)}),n}a.memo(function({routes:e,future:t,state:a}){return Dt(e,void 0,a)});var Yt="get",Gt="application/x-www-form-urlencoded";function Jt(e){return null!=e&&"string"==typeof e.tagName}var Kt=null,Xt=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Qt(e){return null==e||Xt.has(e)?e:(qe(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Gt}"`),null)}function Zt(e,t){if(!1===e||null==e)throw new Error(t)}function ea(e){return null!=e&&(null==e.href?"preload"===e.rel&&"string"==typeof e.imageSrcSet&&"string"==typeof e.imageSizes:"string"==typeof e.rel&&"string"==typeof e.href)}function ta(e,t,a,n,r,s){let i=(e,t)=>!a[t]||e.route.id!==a[t].route.id,o=(e,t)=>{var n;return a[t].pathname!==e.pathname||(null==(n=a[t].route.path)?void 0:n.endsWith("*"))&&a[t].params["*"]!==e.params["*"]};return"assets"===s?t.filter((e,t)=>i(e,t)||o(e,t)):"data"===s?t.filter((t,s)=>{var l;let c=n.routes[t.route.id];if(!c||!c.hasLoader)return!1;if(i(t,s)||o(t,s))return!0;if(t.route.shouldRevalidate){let n=t.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:(null==(l=a[0])?void 0:l.params)||{},nextUrl:new URL(e,window.origin),nextParams:t.params,defaultShouldRevalidate:!0});if("boolean"==typeof n)return n}return!0}):[]}function aa(){let e=a.useContext(wt);return Zt(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var na=a.createContext(void 0);function ra(){let e=a.useContext(na);return Zt(e,"You must render this element inside a <HydratedRouter> element"),e}function sa(e,t){return a=>{e&&e(a),a.defaultPrevented||t(a)}}function ia({page:e,...t}){let{router:n}=aa(),r=a.useMemo(()=>Ke(n.routes,e,n.basename),[n.routes,e,n.basename]);return r?a.createElement(oa,{page:e,matches:r,...t}):null}function oa({page:e,matches:t,...n}){let r=Tt(),{manifest:s,routeModules:i}=ra(),{basename:o}=aa(),{loaderData:l,matches:c}=function(){let e=a.useContext(vt);return Zt(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}(),d=a.useMemo(()=>ta(e,t,c,s,r,"data"),[e,t,c,s,r]),u=a.useMemo(()=>ta(e,t,c,s,r,"assets"),[e,t,c,s,r]),h=a.useMemo(()=>{if(e===r.pathname+r.search+r.hash)return[];let a=new Set,n=!1;if(t.forEach(e=>{var t;let r=s.routes[e.route.id];r&&r.hasLoader&&(!d.some(t=>t.route.id===e.route.id)&&e.route.id in l&&(null==(t=i[e.route.id])?void 0:t.shouldRevalidate)||r.hasClientLoader?n=!0:a.add(e.route.id))}),0===a.size)return[];let c=function(e,t){let a="string"==typeof e?new URL(e,"undefined"==typeof window?"server://singlefetch/":window.location.origin):e;return"/"===a.pathname?a.pathname="_root.data":t&&"/"===dt(a.pathname,t)?a.pathname=`${t.replace(/\/$/,"")}/_root.data`:a.pathname=`${a.pathname.replace(/\/$/,"")}.data`,a}(e,o);return n&&a.size>0&&c.searchParams.set("_routes",t.filter(e=>a.has(e.route.id)).map(e=>e.route.id).join(",")),[c.pathname+c.search]},[o,l,r,s,d,t,e,i]),m=a.useMemo(()=>function(e,t,{includeHydrateFallback:a}={}){return n=e.map(e=>{let n=t.routes[e.route.id];if(!n)return[];let r=[n.module];return n.clientActionModule&&(r=r.concat(n.clientActionModule)),n.clientLoaderModule&&(r=r.concat(n.clientLoaderModule)),a&&n.hydrateFallbackModule&&(r=r.concat(n.hydrateFallbackModule)),n.imports&&(r=r.concat(n.imports)),r}).flat(1),[...new Set(n)];var n}(u,s),[u,s]),p=function(e){let{manifest:t,routeModules:n}=ra(),[r,s]=a.useState([]);return a.useEffect(()=>{let a=!1;return async function(e,t,a){return function(e,t){let a=new Set;return new Set(t),e.reduce((e,t)=>{let n=JSON.stringify(function(e){let t={},a=Object.keys(e).sort();for(let n of a)t[n]=e[n];return t}(t));return a.has(n)||(a.add(n),e.push({key:n,link:t})),e},[])}((await Promise.all(e.map(async e=>{let n=t.routes[e.route.id];if(n){let e=await async function(e,t){if(e.id in t)return t[e.id];try{let a=await Ie(()=>import(e.module),[]);return t[e.id]=a,a}catch(a){return window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}(n,a);return e.links?e.links():[]}return[]}))).flat(1).filter(ea).filter(e=>"stylesheet"===e.rel||"preload"===e.rel).map(e=>"stylesheet"===e.rel?{...e,rel:"prefetch",as:"style"}:{...e,rel:"prefetch"}))}(e,t,n).then(e=>{a||s(e)}),()=>{a=!0}},[e,t,n]),r}(u);return a.createElement(a.Fragment,null,h.map(e=>a.createElement("link",{key:e,rel:"prefetch",as:"fetch",href:e,...n})),m.map(e=>a.createElement("link",{key:e,rel:"modulepreload",href:e,...n})),p.map(({key:e,link:t})=>a.createElement("link",{key:e,...t})))}function la(...e){return t=>{e.forEach(e=>{"function"==typeof e?e(t):null!=e&&(e.current=t)})}}na.displayName="FrameworkContext";var ca="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;try{ca&&(window.__reactRouterVersion="7.6.3")}catch(ko){}function da({basename:e,children:t,window:n}){let r=a.useRef();null==r.current&&(r.current=function(e={}){return function(e,t,a,n={}){let{window:r=document.defaultView,v5Compat:s=!1}=n,i=r.history,o="POP",l=null,c=d();function d(){return(i.state||{idx:null}).idx}function u(){o="POP";let e=d(),t=null==e?null:e-c;c=e,l&&l({action:o,location:m.location,delta:t})}function h(e){return function(e,t=!1){let a="http://localhost";"undefined"!=typeof window&&(a="null"!==window.location.origin?window.location.origin:window.location.href),Be(a,"No window.location.(origin|href) available to create URL");let n="string"==typeof e?e:Ge(e);return n=n.replace(/ $/,"%20"),!t&&n.startsWith("//")&&(n=a+n),new URL(n,a)}(e)}null==c&&(c=0,i.replaceState({...i.state,idx:c},""));let m={get action(){return o},get location(){return e(r,i)},listen(e){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(He,u),l=e,()=>{r.removeEventListener(He,u),l=null}},createHref:e=>t(r,e),createURL:h,encodeLocation(e){let t=h(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){o="PUSH";let n=Ye(m.location,e,t);a&&a(n,e),c=d()+1;let u=Ve(n,c),h=m.createHref(n);try{i.pushState(u,"",h)}catch(p){if(p instanceof DOMException&&"DataCloneError"===p.name)throw p;r.location.assign(h)}s&&l&&l({action:o,location:m.location,delta:1})},replace:function(e,t){o="REPLACE";let n=Ye(m.location,e,t);a&&a(n,e),c=d();let r=Ve(n,c),u=m.createHref(n);i.replaceState(r,"",u),s&&l&&l({action:o,location:m.location,delta:0})},go:e=>i.go(e)};return m}(function(e,t){let{pathname:a,search:n,hash:r}=e.location;return Ye("",{pathname:a,search:n,hash:r},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"==typeof t?t:Ge(t)},null,e)}({window:n,v5Compat:!0}));let s=r.current,[i,o]=a.useState({action:s.action,location:s.location}),l=a.useCallback(e=>{a.startTransition(()=>o(e))},[o]);return a.useLayoutEffect(()=>s.listen(l),[s,l]),a.createElement(Bt,{basename:e,children:t,location:i.location,navigationType:i.action,navigator:s})}var ua=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ha=a.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:r,reloadDocument:s,replace:i,state:o,target:l,to:c,preventScrollReset:d,viewTransition:u,...h},m){let p,{basename:g}=a.useContext(Nt),f="string"==typeof c&&ua.test(c),x=!1;if("string"==typeof c&&f&&(p=c,ca))try{let e=new URL(window.location.href),t=c.startsWith("//")?new URL(e.protocol+c):new URL(c),a=dt(t.pathname,g);t.origin===e.origin&&null!=a?c=a+t.search+t.hash:x=!0}catch(ko){qe(!1,`<Link to="${c}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let y=function(e,{relative:t}={}){Be(At(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=a.useContext(Nt),{hash:s,pathname:i,search:o}=It(e,{relative:t}),l=i;return"/"!==n&&(l="/"===i?n:pt([n,i])),r.createHref({pathname:l,search:o,hash:s})}(c,{relative:r}),[b,w,v]=function(e,t){let n=a.useContext(na),[r,s]=a.useState(!1),[i,o]=a.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:d,onMouseLeave:u,onTouchStart:h}=t,m=a.useRef(null);a.useEffect(()=>{if("render"===e&&o(!0),"viewport"===e){let e=new IntersectionObserver(e=>{e.forEach(e=>{o(e.isIntersecting)})},{threshold:.5});return m.current&&e.observe(m.current),()=>{e.disconnect()}}},[e]),a.useEffect(()=>{if(r){let e=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(e)}}},[r]);let p=()=>{s(!0)},g=()=>{s(!1),o(!1)};return n?"intent"!==e?[i,m,{}]:[i,m,{onFocus:sa(l,p),onBlur:sa(c,g),onMouseEnter:sa(d,p),onMouseLeave:sa(u,g),onTouchStart:sa(h,p)}]:[!1,m,{}]}(n,h),j=function(e,{target:t,replace:n,state:r,preventScrollReset:s,relative:i,viewTransition:o}={}){let l=Mt(),c=Tt(),d=It(e,{relative:i});return a.useCallback(a=>{if(function(e,t){return!(0!==e.button||t&&"_self"!==t||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e))}(a,t)){a.preventDefault();let t=void 0!==n?n:Ge(c)===Ge(d);l(e,{replace:t,state:r,preventScrollReset:s,relative:i,viewTransition:o})}},[c,l,d,n,r,t,e,s,i,o])}(c,{replace:i,state:o,target:l,preventScrollReset:d,relative:r,viewTransition:u}),N=a.createElement("a",{...h,...v,href:p||y,onClick:x||s?e:function(t){e&&e(t),t.defaultPrevented||j(t)},ref:la(m,w),target:l,"data-discover":f||"render"!==t?void 0:"true"});return b&&!f?a.createElement(a.Fragment,null,N,a.createElement(ia,{page:y})):N});function ma(e){let t=a.useContext(wt);return Be(t,function(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}(e)),t}ha.displayName="Link",a.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:r=!1,style:s,to:i,viewTransition:o,children:l,...c},d){let u=It(i,{relative:c.relative}),h=Tt(),m=a.useContext(vt),{navigator:p,basename:g}=a.useContext(Nt),f=null!=m&&function(e,t={}){let n=a.useContext(jt);Be(null!=n,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=ma("useViewTransitionState"),s=It(e,{relative:t.relative});if(!n.isTransitioning)return!1;let i=dt(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=dt(n.nextLocation.pathname,r)||n.nextLocation.pathname;return null!=lt(s.pathname,o)||null!=lt(s.pathname,i)}(u)&&!0===o,x=p.encodeLocation?p.encodeLocation(u).pathname:u.pathname,y=h.pathname,b=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;t||(y=y.toLowerCase(),b=b?b.toLowerCase():null,x=x.toLowerCase()),b&&g&&(b=dt(b,g)||b);const w="/"!==x&&x.endsWith("/")?x.length-1:x.length;let v,j=y===x||!r&&y.startsWith(x)&&"/"===y.charAt(w),N=null!=b&&(b===x||!r&&b.startsWith(x)&&"/"===b.charAt(x.length)),k={isActive:j,isPending:N,isTransitioning:f},C=j?e:void 0;v="function"==typeof n?n(k):[n,j?"active":null,N?"pending":null,f?"transitioning":null].filter(Boolean).join(" ");let S="function"==typeof s?s(k):s;return a.createElement(ha,{...c,"aria-current":C,className:v,ref:d,style:S,to:i,viewTransition:o},"function"==typeof l?l(k):l)}).displayName="NavLink",a.forwardRef(({discover:e="render",fetcherKey:t,navigate:n,reloadDocument:r,replace:s,state:i,method:o=Yt,action:l,onSubmit:c,relative:d,preventScrollReset:u,viewTransition:h,...m},p)=>{let g=function(){let{router:e}=ma("useSubmit"),{basename:t}=a.useContext(Nt),n=Ut("useRouteId");return a.useCallback(async(a,r={})=>{let{action:s,method:i,encType:o,formData:l,body:c}=function(e,t){let a,n,r,s,i;if(Jt(o=e)&&"form"===o.tagName.toLowerCase()){let i=e.getAttribute("action");n=i?dt(i,t):null,a=e.getAttribute("method")||Yt,r=Qt(e.getAttribute("enctype"))||Gt,s=new FormData(e)}else if(function(e){return Jt(e)&&"button"===e.tagName.toLowerCase()}(e)||function(e){return Jt(e)&&"input"===e.tagName.toLowerCase()}(e)&&("submit"===e.type||"image"===e.type)){let i=e.form;if(null==i)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let o=e.getAttribute("formaction")||i.getAttribute("action");if(n=o?dt(o,t):null,a=e.getAttribute("formmethod")||i.getAttribute("method")||Yt,r=Qt(e.getAttribute("formenctype"))||Qt(i.getAttribute("enctype"))||Gt,s=new FormData(i,e),!function(){if(null===Kt)try{new FormData(document.createElement("form"),0),Kt=!1}catch(ko){Kt=!0}return Kt}()){let{name:t,type:a,value:n}=e;if("image"===a){let e=t?`${t}.`:"";s.append(`${e}x`,"0"),s.append(`${e}y`,"0")}else t&&s.append(t,n)}}else{if(Jt(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');a=Yt,n=null,r=Gt,i=e}var o;return s&&"text/plain"===r&&(i=s,s=void 0),{action:n,method:a.toLowerCase(),encType:r,formData:s,body:i}}(a,t);if(!1===r.navigate){let t=r.fetcherKey||ga();await e.fetch(t,n,r.action||s,{preventScrollReset:r.preventScrollReset,formData:l,body:c,formMethod:r.method||i,formEncType:r.encType||o,flushSync:r.flushSync})}else await e.navigate(r.action||s,{preventScrollReset:r.preventScrollReset,formData:l,body:c,formMethod:r.method||i,formEncType:r.encType||o,replace:r.replace,state:r.state,fromRouteId:n,flushSync:r.flushSync,viewTransition:r.viewTransition})},[e,t,n])}(),f=function(e,{relative:t}={}){let{basename:n}=a.useContext(Nt),r=a.useContext(Ct);Be(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...It(e||".",{relative:t})},o=Tt();if(null==e){i.search=o.search;let e=new URLSearchParams(i.search),t=e.getAll("index");if(t.some(e=>""===e)){e.delete("index"),t.filter(e=>e).forEach(t=>e.append("index",t));let a=e.toString();i.search=a?`?${a}`:""}}return e&&"."!==e||!s.route.index||(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),"/"!==n&&(i.pathname="/"===i.pathname?n:pt([n,i.pathname])),Ge(i)}(l,{relative:d}),x="get"===o.toLowerCase()?"get":"post",y="string"==typeof l&&ua.test(l);return a.createElement("form",{ref:p,method:x,action:f,onSubmit:r?c:e=>{if(c&&c(e),e.defaultPrevented)return;e.preventDefault();let a=e.nativeEvent.submitter,r=(null==a?void 0:a.getAttribute("formmethod"))||o;g(a||e.currentTarget,{fetcherKey:t,method:r,navigate:n,replace:s,state:i,relative:d,preventScrollReset:u,viewTransition:h})},...m,"data-discover":y||"render"!==e?void 0:"true"})}).displayName="Form";var pa=0,ga=()=>`__${String(++pa)}__`;const fa=o({apiKey:"AIzaSyAVJvau3Hit06q1pNYCTOF-pVuutmk4oNQ",authDomain:"mythseekers-rpg.firebaseapp.com",databaseURL:"https://mythseekers-rpg-default-rtdb.firebaseio.com",projectId:"mythseekers-rpg",storageBucket:"mythseekers-rpg.firebasestorage.app",messagingSenderId:"659018227506",appId:"1:659018227506:web:82425e7adaf80c2e3c412b",measurementId:"G-E3T1V81ZX3"}),xa=k(fa),ya=M(fa);q(fa);const ba=new class{constructor(){t(this,"listeners",{})}async signInWithGoogle(){var e,t;try{const n=new C;n.setCustomParameters({prompt:"select_account"}),n.addScope("profile"),n.addScope("email");try{const e=await S(xa,n);await this.getUserProfile(e.user.uid)||await this.createUserProfile(e.user)}catch(a){if("auth/popup-blocked"!==a.code&&"auth/popup-closed-by-user"!==a.code&&!(null==(e=a.message)?void 0:e.includes("Cross-Origin-Opener-Policy"))&&!(null==(t=a.message)?void 0:t.includes("window.closed")))throw a;await A(xa,n)}}catch(n){throw n}}async handleRedirectSignIn(){try{const e=await T(xa);if(e){const t=e.user;return await this.getUserProfile(t.uid)||await this.createUserProfile(t),t}return null}catch(e){return null}}async signOut(){await E(xa)}onAuthStateChange(e){return P(xa,e)}getCurrentUser(){return xa.currentUser}async createUserProfile(e){try{const t={uid:e.uid,displayName:e.displayName||"Adventurer",email:e.email||"",photoURL:e.photoURL||"",createdAt:Date.now(),lastSeen:Date.now(),totalPlayTime:0,campaignsHosted:0,campaignsJoined:0};await I(D(ya,"users",e.uid),t)}catch(t){throw t}}async getUserProfile(e){try{const t=D(ya,"users",e),a=await R(t);return a.exists()?a.data():null}catch(t){return null}}async updateUserLastSeen(e){const t=D(ya,"users",e);await $(t,{lastSeen:Date.now()})}async saveCharacter(e){if(!this.getCurrentUser())throw new Error("User not authenticated");if(!ya)throw new Error("Firebase not initialized");const t={...e,lastPlayed:Date.now()};try{if(e.id){const a=D(ya,"characters",e.id);return await $(a,t),e.id}return(await L(O(ya,"characters"),t)).id}catch(a){throw a}}async getUserCharacters(e){const t=_(O(ya,"characters"),U("userId","==",e));return(await F(t)).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>t.lastPlayed-e.lastPlayed)}async getCharacter(e){const t=D(ya,"characters",e),a=await R(t);return a.exists()?{id:a.id,...a.data()}:null}async createGameSession(e){const t=this.generateGameCode(),a=this.getCurrentUser();if(!a)throw new Error("User must be authenticated");const n={code:t,theme:e.theme||"Classic Fantasy",background:e.background||"fantasy",hostId:a.uid,players:e.players||[],messages:e.messages||[],started:!1,customPrompt:e.customPrompt||"",maxPlayers:e.maxPlayers||6,createdAt:Date.now(),lastActivity:Date.now()},r=await L(O(ya,"games"),n);return await this.updateUserStats(a.uid,{campaignsHosted:1}),{gameId:r.id,code:t}}async joinGameSession(e,t){const a=this.getCurrentUser();if(!a)throw new Error("User must be authenticated");const n=_(O(ya,"games"),U("code","==",e),U("started","==",!1)),r=await F(n);if(r.empty)throw new Error("Game not found or already started");const s=r.docs[0],i=s.data();if(i.players.length>=i.maxPlayers)throw new Error("Game is full");if(i.players.find(e=>e.id===a.uid))throw new Error("Player already in game");const o=await this.getCharacter(t);if(!o)throw new Error("Character not found");const l={id:a.uid,name:o.name,characterId:t,isHost:!1,isOnline:!0,lastSeen:Date.now()};return await $(D(ya,"games",s.id),{players:z(l),lastActivity:Date.now()}),await this.updateUserStats(a.uid,{campaignsJoined:1}),{gameId:s.id,gameData:{...i,players:[...i.players,l]}}}async leaveGameSession(e){const t=this.getCurrentUser();if(!t)throw new Error("User must be authenticated");const a=D(ya,"games",e),n=await R(a);if(!n.exists())throw new Error("Game not found");const r=n.data().players.filter(e=>e.id!==t.uid);0===r.length?await W(a):await $(a,{players:r,lastActivity:Date.now()})}async startGameSession(e){const t=this.getCurrentUser();if(!t)throw new Error("User must be authenticated");const a=D(ya,"games",e),n=await R(a);if(!n.exists())throw new Error("Game not found");if(n.data().hostId!==t.uid)throw new Error("Only host can start the game");await $(a,{started:!0,lastActivity:Date.now()})}onGameUpdate(e,t){const a=D(ya,"games",e),n=H(a,e=>{if(e.exists()){const a={id:e.id,...e.data()};t(a)}});return this.listeners[e]=n,n}async sendMessage(e,t){if(!this.getCurrentUser())throw new Error("User must be authenticated");const a={...t,id:`msg-${Date.now()}`,timestamp:Date.now()},n=D(ya,"games",e);await $(n,{messages:z(a),lastActivity:Date.now()})}async saveGameProgress(e,t,a){const n=this.getCurrentUser();if(!n)throw new Error("User must be authenticated");const r=D(ya,"characters",t);await $(r,{...a,lastPlayed:Date.now()}),await this.updateUserStats(n.uid,{totalPlayTime:a.playTime||0})}async completeCampaign(e,t){if(!this.getCurrentUser())throw new Error("User must be authenticated");const a=D(ya,"games",e),n=await R(a);if(!n.exists())throw new Error("Game not found");const r=n.data();await L(O(ya,"campaigns"),{gameId:e,hostId:r.hostId,participants:r.players.map(e=>e.id),theme:r.theme,startedAt:r.createdAt,completedAt:Date.now(),duration:Date.now()-r.createdAt,messages:r.messages,campaignData:t}),await $(a,{completedAt:Date.now()})}async updateUserStats(e,t){const a=D(ya,"users",e);await $(a,t)}async getUserAchievements(e){try{const t=O(ya,"achievements"),a=_(t,U("userId","==",e)),n=await F(a),r=[];return n.forEach(e=>{r.push({id:e.id,...e.data()})}),r}catch(t){return[]}}async getPlayerStats(e){try{const t=await this.getUserProfile(e);if(!t)return{totalPlayTime:0,campaignsHosted:0,campaignsJoined:0,charactersCreated:0,totalXP:0,combatWins:0,questsCompleted:0,npcsInteracted:0,locationsDiscovered:0,achievementsUnlocked:0,lastActive:new Date,joinDate:new Date};const a=await this.getUserCharacters(e),n=await this.getUserAchievements(e);return{totalPlayTime:t.totalPlayTime||0,campaignsHosted:t.campaignsHosted||0,campaignsJoined:t.campaignsJoined||0,charactersCreated:a.length,totalXP:a.reduce((e,t)=>e+(t.experience||0),0),combatWins:0,questsCompleted:0,npcsInteracted:0,locationsDiscovered:0,achievementsUnlocked:n.length,lastActive:new Date(t.lastSeen),joinDate:new Date(t.createdAt)}}catch(t){return{totalPlayTime:0,campaignsHosted:0,campaignsJoined:0,charactersCreated:0,totalXP:0,combatWins:0,questsCompleted:0,npcsInteracted:0,locationsDiscovered:0,achievementsUnlocked:0,lastActive:new Date,joinDate:new Date}}}generateGameCode(){let e="";for(let t=0;t<6;t++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".charAt(Math.floor(36*Math.random()));return e}cleanup(){Object.values(this.listeners).forEach(e=>e()),this.listeners={}}},wa=()=>{const[e,t]=a.useState(null),[n,r]=a.useState(null),[s,i]=a.useState(!0),[o,l]=a.useState("overview"),[c,d]=a.useState([]),[u,h]=a.useState(null);a.useEffect(()=>ba.onAuthStateChange(async e=>{if(t(e),i(!1),e)try{const t=await ba.getUserProfile(e.uid);r(t),await m(e.uid)}catch(a){r(null)}else r(null)}),[]);const m=async e=>{try{const t=await ba.getUserAchievements(e);d(t);const a=await ba.getPlayerStats(e);h(a)}catch(t){}},p=e=>{const t=Math.floor(e/60),a=e%60;return t>24?`${Math.floor(t/24)}d ${t%24}h ${a}m`:`${t}h ${a}m`};if(s)return Te.jsx("div",{className:"text-blue-200",children:"Loading..."});if(!e)return Te.jsx("div",{className:"flex flex-col items-center space-y-2",children:Te.jsx("button",{onClick:async()=>{i(!0);try{await ba.signInWithGoogle()}catch(ko){alert("Login failed: "+ko)}i(!1)},className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-semibold hover:from-blue-700 hover:to-purple-700 transition-all",children:"Sign in with Google"})});const g=(f=(null==u?void 0:u.totalXP)||0,Math.floor(f/1e3)+1);var f;const x=(y=g)>=20?{name:"Legendary Master",color:"text-purple-400",icon:"ðŸ‘‘"}:y>=15?{name:"Epic Hero",color:"text-red-400",icon:"âš”ï¸"}:y>=10?{name:"Veteran Adventurer",color:"text-orange-400",icon:"ðŸ›¡ï¸"}:y>=5?{name:"Skilled Warrior",color:"text-yellow-400",icon:"âš¡"}:{name:"Novice Explorer",color:"text-green-400",icon:"ðŸŒ±"};var y;return Te.jsxs("div",{className:"flex flex-col h-full",children:[Te.jsx("div",{className:"bg-gradient-to-r from-blue-900/50 to-purple-900/50 rounded-lg p-4 mb-4 border border-white/20",children:Te.jsxs("div",{className:"flex items-center space-x-4",children:[Te.jsx("img",{src:e.photoURL,alt:"avatar",className:"w-16 h-16 rounded-full border-2 border-blue-400"}),Te.jsxs("div",{className:"flex-1",children:[Te.jsx("div",{className:"text-white font-bold text-lg",children:e.displayName}),Te.jsx("div",{className:"text-blue-200 text-sm",children:e.email}),Te.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[Te.jsx("span",{className:"text-2xl",children:x.icon}),Te.jsx("span",{className:`font-semibold ${x.color}`,children:x.name}),Te.jsxs("span",{className:"text-gray-300",children:["â€¢ Level ",g]})]})]}),Te.jsx("button",{onClick:async()=>{i(!0);try{await ba.signOut()}catch(ko){alert("Logout failed: "+ko)}i(!1)},className:"px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-all",children:"Sign out"})]})}),Te.jsx("div",{className:"flex space-x-1 mb-4",children:[{key:"overview",label:"Overview",icon:Te.jsx(V,{size:16})},{key:"achievements",label:"Achievements",icon:Te.jsx(Y,{size:16})},{key:"stats",label:"Statistics",icon:Te.jsx(G,{size:16})},{key:"characters",label:"Characters",icon:Te.jsx(J,{size:16})}].map(e=>Te.jsxs("button",{onClick:()=>l(e.key),className:"flex items-center space-x-2 px-4 py-2 rounded-lg transition-all "+(o===e.key?"bg-blue-600 text-white":"bg-white/10 text-blue-200 hover:bg-white/20"),children:[e.icon,Te.jsx("span",{className:"hidden sm:inline",children:e.label})]},e.key))}),Te.jsxs("div",{className:"flex-1 overflow-y-auto",children:["overview"===o&&Te.jsxs("div",{className:"space-y-4",children:[Te.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[Te.jsxs("div",{className:"bg-white/10 rounded-lg p-4 text-center border border-white/20",children:[Te.jsx(K,{className:"w-6 h-6 text-blue-400 mx-auto mb-2"}),Te.jsx("div",{className:"text-white font-bold",children:p((null==u?void 0:u.totalPlayTime)||0)}),Te.jsx("div",{className:"text-blue-200 text-sm",children:"Play Time"})]}),Te.jsxs("div",{className:"bg-white/10 rounded-lg p-4 text-center border border-white/20",children:[Te.jsx(X,{className:"w-6 h-6 text-yellow-400 mx-auto mb-2"}),Te.jsx("div",{className:"text-white font-bold",children:(null==u?void 0:u.achievementsUnlocked)||0}),Te.jsx("div",{className:"text-blue-200 text-sm",children:"Achievements"})]}),Te.jsxs("div",{className:"bg-white/10 rounded-lg p-4 text-center border border-white/20",children:[Te.jsx(J,{className:"w-6 h-6 text-green-400 mx-auto mb-2"}),Te.jsx("div",{className:"text-white font-bold",children:(null==u?void 0:u.campaignsJoined)||0}),Te.jsx("div",{className:"text-blue-200 text-sm",children:"Campaigns"})]}),Te.jsxs("div",{className:"bg-white/10 rounded-lg p-4 text-center border border-white/20",children:[Te.jsx(Q,{className:"w-6 h-6 text-red-400 mx-auto mb-2"}),Te.jsx("div",{className:"text-white font-bold",children:(null==u?void 0:u.questsCompleted)||0}),Te.jsx("div",{className:"text-blue-200 text-sm",children:"Quests"})]})]}),Te.jsxs("div",{className:"bg-white/10 rounded-lg p-4 border border-white/20",children:[Te.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Recent Activity"}),Te.jsxs("div",{className:"space-y-2 text-sm",children:[Te.jsxs("div",{className:"flex items-center space-x-3 text-blue-200",children:[Te.jsx(Z,{size:16}),Te.jsxs("span",{children:["Joined MythSeeker ",(null==u?void 0:u.joinDate)?new Date(u.joinDate).toLocaleDateString():"recently"]})]}),Te.jsxs("div",{className:"flex items-center space-x-3 text-blue-200",children:[Te.jsx(K,{size:16}),Te.jsxs("span",{children:["Last active ",(null==u?void 0:u.lastActive)?new Date(u.lastActive).toLocaleDateString():"recently"]})]})]})]}),Te.jsxs("div",{className:"bg-white/10 rounded-lg p-4 border border-white/20",children:[Te.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Level Progress"}),Te.jsxs("div",{className:"space-y-2",children:[Te.jsxs("div",{className:"flex justify-between text-sm",children:[Te.jsxs("span",{className:"text-blue-200",children:["Level ",g]}),Te.jsxs("span",{className:"text-blue-200",children:["Level ",g+1]})]}),Te.jsx("div",{className:"w-full bg-white/20 rounded-full h-2",children:Te.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full transition-all",style:{width:((null==u?void 0:u.totalXP)||0)%1e3/10+"%"}})}),Te.jsxs("div",{className:"text-center text-sm text-blue-200",children:[(null==u?void 0:u.totalXP)||0," / ",1e3*(g+1)," XP"]})]})]})]}),"achievements"===o&&Te.jsx("div",{className:"space-y-4",children:Te.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.map(e=>Te.jsx("div",{className:"bg-white/10 rounded-lg p-4 border border-white/20",children:Te.jsxs("div",{className:"flex items-start space-x-3",children:[Te.jsx("div",{className:"text-3xl",children:e.icon}),Te.jsxs("div",{className:"flex-1",children:[Te.jsx("h4",{className:"text-white font-medium",children:e.name}),Te.jsx("p",{className:"text-gray-300 text-sm mb-2",children:e.description}),Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("span",{className:"text-xs text-yellow-400",children:["+",e.points," points"]}),Te.jsx("span",{className:"text-xs text-gray-400",children:e.unlockedAt?new Date(e.unlockedAt).toLocaleDateString():"Unlocked"})]})]})]})},e.id)),0===c.length&&Te.jsxs("div",{className:"col-span-full text-center py-8",children:[Te.jsx(Y,{size:48,className:"text-gray-400 mx-auto mb-4"}),Te.jsx("p",{className:"text-gray-400",children:"No achievements unlocked yet"}),Te.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Complete quests and challenges to earn achievements!"})]})]})}),"stats"===o&&Te.jsxs("div",{className:"space-y-4",children:[Te.jsxs("div",{className:"bg-white/10 rounded-lg p-4 border border-white/20",children:[Te.jsxs("h3",{className:"text-lg font-semibold text-white mb-3 flex items-center space-x-2",children:[Te.jsx(ee,{size:20,className:"text-red-400"}),Te.jsx("span",{children:"Combat Statistics"})]}),Te.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-white font-bold text-xl",children:(null==u?void 0:u.combatWins)||0}),Te.jsx("div",{className:"text-blue-200 text-sm",children:"Combat Wins"})]}),Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-white font-bold text-xl",children:(null==u?void 0:u.totalXP)||0}),Te.jsx("div",{className:"text-blue-200 text-sm",children:"Total XP"})]}),Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-white font-bold text-xl",children:(null==u?void 0:u.charactersCreated)||0}),Te.jsx("div",{className:"text-blue-200 text-sm",children:"Characters"})]}),Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-white font-bold text-xl",children:(null==u?void 0:u.campaignsHosted)||0}),Te.jsx("div",{className:"text-blue-200 text-sm",children:"Campaigns Hosted"})]})]})]}),Te.jsxs("div",{className:"bg-white/10 rounded-lg p-4 border border-white/20",children:[Te.jsxs("h3",{className:"text-lg font-semibold text-white mb-3 flex items-center space-x-2",children:[Te.jsx(Q,{size:20,className:"text-green-400"}),Te.jsx("span",{children:"Exploration Statistics"})]}),Te.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-white font-bold text-xl",children:(null==u?void 0:u.questsCompleted)||0}),Te.jsx("div",{className:"text-blue-200 text-sm",children:"Quests Completed"})]}),Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-white font-bold text-xl",children:(null==u?void 0:u.locationsDiscovered)||0}),Te.jsx("div",{className:"text-blue-200 text-sm",children:"Locations Found"})]}),Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-white font-bold text-xl",children:(null==u?void 0:u.npcsInteracted)||0}),Te.jsx("div",{className:"text-blue-200 text-sm",children:"NPCs Met"})]})]})]}),Te.jsxs("div",{className:"bg-white/10 rounded-lg p-4 border border-white/20",children:[Te.jsxs("h3",{className:"text-lg font-semibold text-white mb-3 flex items-center space-x-2",children:[Te.jsx(K,{size:20,className:"text-blue-400"}),Te.jsx("span",{children:"Time Statistics"})]}),Te.jsxs("div",{className:"space-y-2 text-sm",children:[Te.jsxs("div",{className:"flex justify-between",children:[Te.jsx("span",{className:"text-blue-200",children:"Total Play Time:"}),Te.jsx("span",{className:"text-white",children:p((null==u?void 0:u.totalPlayTime)||0)})]}),Te.jsxs("div",{className:"flex justify-between",children:[Te.jsx("span",{className:"text-blue-200",children:"Average Session:"}),Te.jsx("span",{className:"text-white",children:(null==u?void 0:u.campaignsJoined)?p(Math.floor((u.totalPlayTime||0)/u.campaignsJoined)):"0m"})]}),Te.jsxs("div",{className:"flex justify-between",children:[Te.jsx("span",{className:"text-blue-200",children:"Member Since:"}),Te.jsx("span",{className:"text-white",children:(null==u?void 0:u.joinDate)?new Date(u.joinDate).toLocaleDateString():"Recently"})]})]})]})]}),"characters"===o&&Te.jsx("div",{className:"space-y-4",children:Te.jsxs("div",{className:"bg-white/10 rounded-lg p-4 border border-white/20",children:[Te.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Character Gallery"}),Te.jsx("p",{className:"text-blue-200 text-sm mb-4",children:"Your created characters and their achievements will appear here."}),Te.jsxs("div",{className:"text-center py-8",children:[Te.jsx(J,{size:48,className:"text-gray-400 mx-auto mb-4"}),Te.jsx("p",{className:"text-gray-400",children:"Character management coming soon!"}),Te.jsx("p",{className:"text-gray-500 text-sm mt-2",children:"Create characters to see them here"})]})]})})]})]})},va=o({apiKey:"AIzaSyAVJvau3Hit06q1pNYCTOF-pVuutmk4oNQ",authDomain:"mythseekers-rpg.firebaseapp.com",databaseURL:"https://mythseekers-rpg-default-rtdb.firebaseio.com",projectId:"mythseekers-rpg",storageBucket:"mythseekers-rpg.firebasestorage.app",messagingSenderId:"659018227506",appId:"1:659018227506:web:82425e7adaf80c2e3c412b",measurementId:"G-E3T1V81ZX3"});q(va);const ja=xe(va),Na=new class{constructor(){t(this,"aiDungeonMaster",ye(ja,"aiDungeonMaster"))}async complete(e,t){var a,n;try{if(!t||!t.isMultiplayer)return await new Promise(e=>setTimeout(e,1e3+2e3*Math.random())),this.generateLocalResponse(e);const s=new Promise((e,t)=>{setTimeout(()=>{t(new Error("Firebase function timeout"))},15e3)}),i=this.aiDungeonMaster({prompt:e,campaignId:t.id,playerName:(null==(n=null==(a=t.players)?void 0:a[0])?void 0:n.name)||t.playerName||"Player"});try{return(await Promise.race([i,s])).data}catch(r){return await new Promise(e=>setTimeout(e,1e3+2e3*Math.random())),this.generateLocalResponse(e)}}catch(s){return JSON.stringify(this.generateFallbackResponse())}}generateLocalResponse(e){try{const t=this.parsePromptContext(e),a=e.includes("INITIAL SCENE REQUIREMENTS")?this.generateInitialScene(t):this.generateDynamicResponse(t);return JSON.stringify(a)}catch(t){return JSON.stringify(this.generateFallbackResponse())}}parsePromptContext(e){const t=e.match(/Player Level: (\d+) ([^,\n]+)/),a=e.match(/Player Stats: STR (\d+), DEX (\d+), INT (\d+), CHA (\d+)/),n=e.match(/Location: ([^\n]+)/),r=e.match(/Time: ([^\n]+)/),s=e.match(/Weather: ([^\n]+)/),i=e.match(/\*\*PLAYER INPUT:\*\* "([^"]+)"/),o=i?i[1]:"",l=e.match(/for a ([^ ]+) campaign/),c=l?l[1]:"fantasy",d=e.match(/\*\*CUSTOM CAMPAIGN PROMPT:\*\*\n([^*]+?)(?=\*\*|$)/),u=d?d[1].trim():"";return{character:{level:t?parseInt(t[1]):1,class:t?t[2]:"Adventurer",stats:a?{strength:parseInt(a[1]),dexterity:parseInt(a[2]),intelligence:parseInt(a[3]),charisma:parseInt(a[4])}:{strength:10,dexterity:10,intelligence:10,charisma:10}},worldState:{location:n?n[1].trim():"unknown",time:r?r[1].trim():"day",weather:s?s[1].trim():"clear"},playerInput:o,theme:c,customPrompt:u}}generateInitialScene(e){const{character:t,worldState:a,theme:n,customPrompt:r}=e,s=this.generateLocation(a.location,n),i=this.generateNPC(t,n),o=this.generateConflict(n,r),l=[`You find yourself in ${s.name}, where ${s.atmosphere}. ${i.name}, a ${i.role.toLowerCase()}, approaches you with ${i.mood} in their eyes. "${i.greeting}" they say, their voice ${i.voice}.`,`As you enter ${s.name}, ${s.description}. ${i.name} spots you and immediately makes their way over. "${i.greeting}" they ${i.action}, their ${i.personality} nature evident in every gesture.`,`${s.name} ${s.activity}. ${i.name} rushes toward you, their face ${i.expression}. "${i.greeting}" they ${i.action}, clearly ${i.motivation}.`],c=[`Accept ${i.name}'s request and ask for details`,"Express skepticism and demand more information",`Ask about the local situation and ${i.name}'s background`,"Request to see the area and gather your own intelligence"];return{narrative:l[Math.floor(Math.random()*l.length)],choices:c,environment:s.id,worldStateUpdates:{newLocation:s.id,newNPCs:[{name:i.name,role:i.role,personality:i.personality,currentMood:i.mood,currentAction:i.action}],consequences:[{type:"immediate",description:`You've been approached by ${i.name} about ${o.name}`,affectedAreas:[s.id]}]},atmosphere:{mood:s.mood,tension:"medium",environmentalDetails:s.details}}}generateDynamicResponse(e){const{character:t,worldState:a,playerInput:n,theme:r}=e,s=n.toLowerCase();return this.isCombatAction(s)?this.generateCombatResponse(e):this.isExplorationAction(s)?this.generateExplorationResponse(e):this.isSocialAction(s)?this.generateSocialResponse(e):this.isRestAction(s)?this.generateRestResponse(e):this.generateGeneralResponse(e)}isCombatAction(e){return["attack","fight","combat","battle","strike","slash","stab","shoot","cast","spell"].some(t=>e.includes(t))}isExplorationAction(e){return["explore","search","investigate","examine","look","check","find","discover"].some(t=>e.includes(t))}isSocialAction(e){return["talk","ask","tell","speak","negotiate","persuade","intimidate","charm","say","reply","respond","answer","question","stare","look","glance","nod","shake","smile","frown","laugh","cry","whisper","shout","greet","introduce","meet","converse","discuss","debate","argue","agree","disagree","accept","refuse","promise","threaten","warn","advise","suggest","propose","offer","request","demand","beg","apologize","thank","congratulate","comfort","encourage","scold"].some(t=>e.includes(t))}isRestAction(e){return["rest","sleep","heal","recover","meditate","camp"].some(t=>e.includes(t))}generateCombatResponse(e){const{character:t,worldState:a,theme:n}=e,r=this.generateEnemies(n,t.level,a.location),s=[`The tension erupts into violence! ${r.length>1?"Your enemies":"Your enemy"} ${r.length>1?"surround":"positions"} you, weapons drawn and eyes filled with determination. The ${t.class.toLowerCase()} in you recognizes this moment - it's time to prove your worth in battle.`,`Suddenly, ${r.length>1?"multiple figures":"a figure"} emerges from the shadows, ${r.length,"their"} intentions clear. Your ${t.class.toLowerCase()} instincts kick in as you prepare for combat.`,`The air crackles with anticipation as ${r.length>1?"your opponents":"your opponent"} ${r.length>1?"take":"takes"} up ${r.length,"their"} fighting stance. Your ${t.class.toLowerCase()} training prepares you for what comes next.`];return{narrative:s[Math.floor(Math.random()*s.length)],choices:["Engage in tactical combat using your class abilities","Attempt to intimidate or bluff your way out","Look for tactical advantages in the environment","Call for reinforcements or help"],combatEncounter:{active:!0,enemies:r},atmosphere:{mood:"tense",tension:"high",environmentalDetails:"The air is thick with the promise of violence and the sound of steel being drawn"}}}generateEnemies(e,t,a){var n;const r={fantasy:{tavern:["Drunken Brawler","Thief","Mercenary"],forest:["Bandit","Wolf","Goblin Scout"],dungeon:["Skeleton","Goblin Warrior","Dark Elf"],city:["City Guard","Thug","Assassin"]},scifi:{tavern:["Rogue Android","Space Pirate","Mutant"],forest:["Alien Scout","Rogue Drone","Wild Creature"],dungeon:["Security Bot","Alien Warrior","Mutant Beast"],city:["Security Officer","Gang Member","Rogue AI"]},horror:{tavern:["Cursed Patron","Shadow Creature","Undead"],forest:["Dark Entity","Cursed Beast","Shadow Walker"],dungeon:["Undead Warrior","Dark Spirit","Cursed Guardian"],city:["Corrupted Citizen","Shadow Stalker","Dark Entity"]}},s=(null==(n=r[e])?void 0:n[a])||r.fantasy.tavern,i=Math.min(t,3);return Array.from({length:i},(e,a)=>({name:s[a%s.length],health:20+5*t+Math.floor(10*Math.random()),attack:3+t+Math.floor(3*Math.random()),strength:12+Math.floor(6*Math.random()),dexterity:10+Math.floor(6*Math.random()),intelligence:8+Math.floor(6*Math.random()),armorClass:12+Math.floor(4*Math.random())}))}generateExplorationResponse(e){const{character:t,worldState:a,theme:n}=e,r=["You discover ancient markings that seem to tell a story of the area's history","A hidden passage reveals itself behind a loose stone, leading to unknown depths","You find evidence of recent activity - footprints, disturbed earth, or discarded items","The environment reveals subtle clues about what happened here recently","Your investigation uncovers a hidden cache or secret compartment","You notice environmental details that others might have missed"],s=[`Your careful investigation pays off! ${r[Math.floor(Math.random()*r.length)]}. Your ${t.class.toLowerCase()} instincts tell you this could be important.`,`Your ${t.class.toLowerCase()} training guides your search. ${r[Math.floor(Math.random()*r.length)]}, and you sense this discovery could change everything.`,`Your methodical approach reveals secrets others might miss. ${r[Math.floor(Math.random()*r.length)]}, and your ${t.class.toLowerCase()} experience helps you understand its significance.`];return{narrative:s[Math.floor(Math.random()*s.length)],choices:["Examine the discovery more closely for additional details","Document your findings and search for related clues","Investigate the surrounding area for more context","Report your discovery to relevant NPCs or allies"],atmosphere:{mood:"curious",tension:"low",environmentalDetails:"The area reveals its secrets to your careful observation and expertise"}}}generateSocialResponse(e){const{character:t,playerInput:a}=e,n=a.toLowerCase();if(n.includes("how dire")||n.includes("serious")||n.includes("dangerous"))return{narrative:`Captain Thorne's expression darkens as they lean in closer, their voice dropping to a grave whisper. "More dire than you can imagine. The ancient seals are weakening, and if they break completely, the entire region will be overrun. We've already lost three villages to the north. I need someone with your ${t.class.toLowerCase()} skills to help us investigate the source before it's too late."`,choices:["Accept the mission and ask for more details about the ancient seals","Request proof of the threat before committing","Ask about the rewards and support you'll receive","Decline politely, citing other pressing matters"],atmosphere:{mood:"urgent",tension:"high",environmentalDetails:"The tavern seems to grow quieter as Captain Thorne speaks, as if the very air holds its breath"}};if(n.includes("stare")||n.includes("look")||n.includes("glance"))return{narrative:`Your ${t.class.toLowerCase()} instincts tell you that Captain Thorne is genuine in their concern. Their weathered face shows the strain of someone who has seen too much, and their eyes carry the weight of responsibility. "I can see you're assessing the situation," they say, nodding approvingly. "That's exactly the kind of careful thinking we need right now."`,choices:["Ask about their military background and experience","Inquire about the specific nature of the threat","Request to see any evidence or reports they have","Ask about the political situation and who else is involved"],atmosphere:{mood:"respectful",tension:"medium",environmentalDetails:"The firelight casts dancing shadows that seem to emphasize the gravity of the situation"}};if(n.includes("why me")||n.includes("choose")||n.includes("select"))return{narrative:`"Why you?" Captain Thorne chuckles, but there's no humor in it. "I've been watching you since you walked in. The way you carry yourself, the way you observe your surroundings - you have the bearing of someone who knows how to handle themselves in dangerous situations. Plus, your ${t.class.toLowerCase()} background gives you skills we desperately need right now."`,choices:["Ask about what specific skills they think you can offer","Inquire about other potential allies or resources","Request more information about the mission parameters","Ask about the risks and potential consequences"],atmosphere:{mood:"analytical",tension:"medium",environmentalDetails:"The captain's assessment seems to carry the weight of experience and the urgency of someone who has seen too much"}};const r=[`Your diplomatic approach opens new possibilities. The person you're speaking with seems to respond well to your ${t.class.toLowerCase()} manner and ${t.stats.charisma>=14?"natural charisma":"earnest approach"}. They share information that could prove valuable.`,`Your ${t.class.toLowerCase()} background helps you connect with the person. They seem to trust your ${t.stats.charisma>=14?"charming":"honest"} nature and share insights about the local situation.`,`Your conversation reveals unexpected depths. Your ${t.class.toLowerCase()} experience and ${t.stats.intelligence>=14?"sharp mind":"practical knowledge"} help you understand the nuances of what they're telling you.`];return{narrative:r[Math.floor(Math.random()*r.length)],choices:["Ask for more specific details about their concerns","Offer assistance in return for their help","Request an introduction to other important people","Thank them and use this information strategically"],atmosphere:{mood:"cooperative",tension:"low",environmentalDetails:"The conversation creates a more relaxed and open atmosphere"}}}generateRestResponse(e){const{character:t,worldState:a}=e,n=[`You take a moment to rest and recover. The ${t.class.toLowerCase()} in you knows the value of preparation and recuperation. You feel your strength returning and your mind clearing.`,`Your ${t.class.toLowerCase()} training emphasizes the importance of rest. As you take this time to recover, you feel your energy returning and your focus sharpening.`,`The ${t.class.toLowerCase()} way teaches patience and preparation. This rest allows you to recover your strength and plan your next move with renewed clarity.`];return{narrative:n[Math.floor(Math.random()*n.length)],choices:["Continue resting to fully recover your strength","Use this time to plan your next move carefully","Check your equipment and supplies while resting","Resume your journey with renewed energy"],characterUpdates:[{playerId:"current",xpGain:5,xpReason:"Wise use of rest time and strategic thinking",statChanges:{health:10,mana:5}}],atmosphere:{mood:"peaceful",tension:"low",environmentalDetails:"The area provides a safe haven for rest and recovery"}}}generateGeneralResponse(e){const{character:t,worldState:a,theme:n,recentActions:r}=e,s=[`Your actions have consequences in this ${n} world. The story continues to unfold based on your choices, and your ${t.class.toLowerCase()} skills and level ${t.level} experience guide your path forward.`,`The world responds to your presence and actions. Your ${t.class.toLowerCase()} background and recent decisions shape how events unfold around you.`,`Your ${t.class.toLowerCase()} instincts serve you well as you navigate this situation. Your level ${t.level} experience and recent actions influence the world's response to your presence.`];return{narrative:s[Math.floor(Math.random()*s.length)],choices:["Continue with your current approach and see where it leads","Try a different strategy based on what you've learned","Seek advice from others who might have relevant experience","Take time to reflect on your options and their implications"],atmosphere:{mood:"neutral",tension:"low",environmentalDetails:"The world responds to your presence and actions in subtle ways"}}}generateLocation(e,t){const a={tavern:{fantasy:{name:"The Prancing Pony Tavern",atmosphere:"warm firelight dances across weathered faces",description:"bustles with activity and the sound of laughter",activity:"hums with the energy of travelers and locals",mood:"cozy",details:"The air is thick with the scent of ale and wood smoke"},scifi:{name:"The Stellar Lounge",atmosphere:"neon lights pulse to the rhythm of distant engines",description:"buzzes with the energy of space travelers",activity:"vibrates with the hum of technology and conversation",mood:"futuristic",details:"The air hums with the subtle energy of advanced life support systems"},horror:{name:"The Shadowed Inn",atmosphere:"flickering candles cast dancing shadows on the walls",description:"echoes with whispered conversations",activity:"pulses with an uneasy energy",mood:"foreboding",details:"The air is thick with the scent of old wood and something else, something older"},urban:{name:"The Midnight Bar",atmosphere:"dim lighting creates intimate corners for private conversations",description:"buzzes with the energy of city nightlife",activity:"throbs with the pulse of urban life",mood:"mysterious",details:"The air carries the mingled scents of coffee, alcohol, and urban mystery"},apocalypse:{name:"The Last Stop",atmosphere:"makeshift barricades and dim emergency lighting",description:"echoes with the sounds of survivors sharing stories",activity:"hums with the quiet desperation of those who remain",mood:"grim",details:"The air is thick with the scent of survival and the weight of lost civilization"},pirate:{name:"The Salty Dog",atmosphere:"lanterns swing gently with the rhythm of the sea",description:"roars with the laughter of sailors and adventurers",activity:"bustles with tales of treasure and adventure",mood:"adventurous",details:"The air carries the salty tang of the ocean and the promise of fortune"}},forest:{fantasy:{name:"The Enchanted Grove",atmosphere:"ancient trees whisper secrets to the wind",description:"shimmers with magical energy and natural beauty",activity:"pulses with the life force of the forest",mood:"mystical",details:"The air is alive with the scent of earth, magic, and ancient wisdom"},scifi:{name:"The Bio-Dome Forest",atmosphere:"artificial sunlight filters through genetically enhanced foliage",description:"buzzes with the energy of engineered ecosystems",activity:"throbs with the pulse of controlled nature",mood:"synthetic",details:"The air carries the scent of purified oxygen and technological harmony"},horror:{name:"The Twisted Woods",atmosphere:"malformed trees reach like skeletal fingers toward the sky",description:"echoes with unnatural sounds and distant screams",activity:"pulses with dark energy and malevolent presence",mood:"terrifying",details:"The air is thick with the scent of decay and something far worse"}},dungeon:{fantasy:{name:"The Ancient Crypts",atmosphere:"torchlight flickers against ancient stone walls",description:"echoes with the whispers of forgotten souls",activity:"pulses with the energy of ancient magic",mood:"mysterious",details:"The air is thick with the dust of ages and the weight of history"},scifi:{name:"The Abandoned Facility",atmosphere:"emergency lighting casts eerie shadows on metal walls",description:"buzzes with the remnants of advanced technology",activity:"throbs with the pulse of malfunctioning systems",mood:"technological",details:"The air hums with the energy of dormant machines and lost knowledge"},horror:{name:"The Cursed Catacombs",atmosphere:"darkness seems to swallow the light whole",description:"echoes with the sounds of things that should not exist",activity:"pulses with malevolent energy and dark magic",mood:"horrifying",details:"The air is thick with the scent of death and the presence of evil"}},city:{fantasy:{name:"The Grand Bazaar",atmosphere:"colorful stalls and the sounds of commerce fill the air",description:"bustles with merchants, travelers, and city life",activity:"hums with the energy of trade and opportunity",mood:"lively",details:"The air carries the scent of spices, goods, and the promise of fortune"},scifi:{name:"The Mega-City District",atmosphere:"neon lights and holographic advertisements create a dazzling display",description:"buzzes with the energy of advanced civilization",activity:"throbs with the pulse of technological progress",mood:"futuristic",details:"The air hums with the energy of countless machines and digital life"},horror:{name:"The Forgotten Quarter",atmosphere:"abandoned buildings and broken streetlights create an eerie silence",description:"echoes with the sounds of things that lurk in the shadows",activity:"pulses with the energy of fear and desperation",mood:"terrifying",details:"The air is thick with the scent of decay and the weight of forgotten lives"},urban:{name:"The Midnight Bar",atmosphere:"dim lighting creates intimate corners for private conversations",description:"buzzes with the energy of city nightlife",activity:"throbs with the pulse of urban life",mood:"mysterious",details:"The air carries the mingled scents of coffee, alcohol, and urban mystery"},apocalypse:{name:"The Last Stop",atmosphere:"makeshift barricades and dim emergency lighting",description:"echoes with the sounds of survivors sharing stories",activity:"hums with the quiet desperation of those who remain",mood:"grim",details:"The air is thick with the scent of survival and the weight of lost civilization"},pirate:{name:"The Salty Dog",atmosphere:"lanterns swing gently with the rhythm of the sea",description:"roars with the laughter of sailors and adventurers",activity:"bustles with tales of treasure and adventure",mood:"adventurous",details:"The air carries the salty tang of the ocean and the promise of fortune"}}},n=a[e];return{...(null==n?void 0:n[t])||a.tavern.fantasy,id:e}}generateNPC(e,t){const a={fantasy:[{name:"Eldric the Sage",role:"Wise Scholar",personality:"scholarly and contemplative",mood:"concerned wisdom",action:"approaches you thoughtfully",greeting:"I have been studying the ancient texts, and I believe I have found something that requires your attention",voice:"carries the weight of centuries of knowledge",expression:"lined with the wisdom of age",motivation:"desperate to share their discovery"},{name:"Captain Thorne",role:"Veteran Warrior",personality:"battle-hardened but honorable",mood:"urgent determination",action:"strides toward you with purpose",greeting:"We need someone with your skills. The situation is more dire than most realize",voice:"carries the authority of command",expression:"marked by years of conflict",motivation:"seeking a capable ally for a dangerous mission"},{name:"Lady Seraphina",role:"Noble Diplomat",personality:"graceful and politically savvy",mood:"calculated concern",action:"glides toward you with practiced elegance",greeting:"Your reputation precedes you. I believe we may be able to help each other in these troubled times",voice:"carries the refinement of noble breeding",expression:"shows the careful control of one used to court intrigue",motivation:"seeking a trustworthy agent for delicate matters"}],scifi:[{name:"Commander Nova",role:"AI Coordinator",personality:"logical and efficient",mood:"digital urgency",action:"approaches with calculated precision",greeting:"My sensors have detected an anomaly that requires immediate attention",voice:"carries the precision of advanced algorithms",expression:"displays subtle digital patterns",motivation:"programmed to seek assistance for critical situations"},{name:"Dr. Zara Chen",role:"Research Scientist",personality:"brilliant but socially awkward",mood:"scientific excitement mixed with concern",action:"approaches with the energy of one who has made a breakthrough",greeting:"You won't believe what I've discovered! But we need someone with your skills to investigate further",voice:"carries the enthusiasm of scientific discovery",expression:"shows the intensity of someone who has been working too long",motivation:"desperate to share their findings and get help"},{name:"Captain Vega",role:"Space Fleet Commander",personality:"disciplined and strategic",mood:"military urgency",action:"marches toward you with purpose",greeting:"We have a situation that requires immediate action. Your skills are exactly what we need",voice:"carries the authority of military command",expression:"shows the stress of someone carrying heavy responsibility",motivation:"seeking a capable operative for a critical mission"}],horror:[{name:"Father Marcus",role:"Local Priest",personality:"haunted but determined",mood:"desperate hope",action:"emerges from the shadows",greeting:"The darkness has returned, and we need someone who can face it",voice:"carries the weight of terrible knowledge",expression:"haunted by what they have seen",motivation:"seeking someone to help fight the darkness"},{name:"Dr. Sarah Blackwood",role:"Paranormal Investigator",personality:"obsessive and driven",mood:"frantic determination",action:"rushes toward you with barely contained energy",greeting:"I've been tracking this for months! The signs are all there, and now it's happening again",voice:"carries the intensity of someone who has seen too much",expression:"shows the strain of someone who hasn't slept in days",motivation:"desperate to stop the cycle of horror"},{name:"The Caretaker",role:"Groundskeeper",personality:"mysterious and knowing",mood:"ominous warning",action:"materializes from the darkness",greeting:"You shouldn't be here. But since you are, perhaps you can help with what's coming",voice:"carries the weight of ancient secrets",expression:"shows the wisdom of one who has seen generations pass",motivation:"seeking someone to break an ancient curse"}],urban:[{name:"Detective Mike Torres",role:"Homicide Detective",personality:"world-weary but determined",mood:"professional concern",action:"approaches with the practiced ease of a cop",greeting:"I've got a case that's got me stumped. I think you might be able to help",voice:"carries the gravel of too many late nights",expression:"shows the weariness of someone who has seen too much",motivation:"seeking help with an unsolvable case"},{name:"Madame Celeste",role:"Fortune Teller",personality:"mysterious and theatrical",mood:"prophetic urgency",action:"emerges from behind her curtain with dramatic flair",greeting:"The cards have been trying to tell me something about you. There's danger ahead",voice:"carries the mystery of the unknown",expression:"shows the intensity of someone who sees beyond the veil",motivation:"seeking to prevent a terrible fate"},{name:'Marcus "The Fixer"',role:"Information Broker",personality:"smooth and calculating",mood:"businesslike interest",action:"approaches with the confidence of someone who knows everyone",greeting:"I hear you're looking for work. I might have something that pays well",voice:"carries the smooth confidence of a dealmaker",expression:"shows the careful calculation of a businessman",motivation:"seeking a reliable operative for a lucrative job"}],apocalypse:[{name:"Commander Hayes",role:"Survival Leader",personality:"pragmatic and protective",mood:"urgent concern",action:"approaches with the authority of someone used to making life-or-death decisions",greeting:"We're running out of time and supplies. I need someone who can handle themselves",voice:"carries the weight of leadership in desperate times",expression:"shows the stress of someone responsible for others' survival",motivation:"seeking help to protect the community"},{name:"Dr. Elena Rodriguez",role:"Medical Researcher",personality:"desperate but hopeful",mood:"scientific urgency",action:"approaches with the energy of someone who has made a breakthrough",greeting:"I think I've found a way to help, but I need someone to get the supplies",voice:"carries the hope of someone who refuses to give up",expression:"shows the determination of someone fighting against impossible odds",motivation:"seeking help to save lives"},{name:"Scout",role:"Wasteland Scout",personality:"cautious and observant",mood:"warning concern",action:"emerges from the shadows with practiced stealth",greeting:"You need to know what's coming. It's worse than we thought",voice:"carries the urgency of someone who has seen terrible things",expression:"shows the alertness of someone who lives by their wits",motivation:"seeking to warn others of impending danger"}],pirate:[{name:"Captain Blackbeard",role:"Pirate Captain",personality:"charismatic and ruthless",mood:"adventurous excitement",action:"swaggers toward you with the confidence of a legend",greeting:"Ahoy there! I've got a tale of treasure that'll make your eyes sparkle",voice:"carries the rum-soaked authority of a sea captain",expression:"shows the cunning of someone who has survived countless battles",motivation:"seeking a crew for a legendary treasure hunt"},{name:"Madame Fortune",role:"Port Town Proprietor",personality:"shrewd and well-connected",mood:"businesslike interest",action:"approaches with the practiced grace of a successful merchant",greeting:"I hear you're looking for adventure. I might have just the thing",voice:"carries the smooth confidence of someone who knows every secret",expression:"shows the wisdom of someone who has seen fortunes made and lost",motivation:"seeking a reliable partner for a profitable venture"},{name:"The Navigator",role:"Mysterious Seafarer",personality:"enigmatic and knowledgeable",mood:"prophetic warning",action:"emerges from the shadows with the grace of one who knows the sea",greeting:"The tides are changing, and not for the better. You'll need a guide",voice:"carries the mystery of one who has sailed to the edge of the world",expression:"shows the wisdom of someone who has seen things beyond mortal ken",motivation:"seeking someone to help prevent a maritime disaster"}]},n=a[t]||a.fantasy;return n[Math.floor(Math.random()*n.length)]}generateConflict(e,t){const a={fantasy:[{name:"Ancient Prophecy",description:"A prophecy foretells great danger"},{name:"Missing Artifact",description:"A powerful artifact has disappeared"},{name:"Political Intrigue",description:"Noble houses vie for power"},{name:"Monster Threat",description:"Creatures threaten the realm"},{name:"Dark Magic",description:"Forbidden magic has been unleashed"},{name:"Dragon Awakening",description:"An ancient dragon has stirred from its slumber"}],scifi:[{name:"System Malfunction",description:"Critical systems are failing"},{name:"Alien Invasion",description:"Unknown forces approach"},{name:"Resource Shortage",description:"Essential supplies are running low"},{name:"Political Crisis",description:"Factions struggle for control"},{name:"AI Rebellion",description:"Artificial intelligences have become hostile"},{name:"Space Anomaly",description:"A mysterious phenomenon threatens the sector"}],horror:[{name:"Supernatural Threat",description:"Dark forces have awakened"},{name:"Dark Ritual",description:"An ancient ritual has begun"},{name:"Missing People",description:"Citizens are disappearing"},{name:"Ancient Curse",description:"A curse has been unleashed"},{name:"Cult Activity",description:"A sinister cult is growing in power"},{name:"Haunted Location",description:"A place has become possessed by evil"}],urban:[{name:"Criminal Syndicate",description:"A powerful crime organization is expanding"},{name:"Corrupt Officials",description:"Government officials are involved in illegal activities"},{name:"Supernatural Crime",description:"Supernatural forces are behind recent crimes"},{name:"Urban Legend",description:"A local legend has become real"},{name:"Corporate Conspiracy",description:"A corporation is hiding dangerous secrets"},{name:"Underground Network",description:"A secret network operates beneath the city"}],apocalypse:[{name:"Resource Crisis",description:"Essential resources are running out"},{name:"Hostile Faction",description:"A dangerous group threatens the community"},{name:"Environmental Hazard",description:"A new environmental threat has emerged"},{name:"Disease Outbreak",description:"A deadly disease is spreading"},{name:"Radiation Zone",description:"A radioactive area is expanding"},{name:"Mutant Threat",description:"Mutated creatures are becoming more aggressive"}],pirate:[{name:"Treasure Hunt",description:"A legendary treasure has been discovered"},{name:"Naval Conflict",description:"Pirate fleets are at war"},{name:"Cursed Island",description:"An island holds dark secrets"},{name:"Sea Monster",description:"A sea creature threatens shipping lanes"},{name:"Navy Pursuit",description:"The navy is hunting pirates"},{name:"Lost Fleet",description:"A fleet has disappeared in mysterious circumstances"}]},n=a[e]||a.fantasy;return n[Math.floor(Math.random()*n.length)]}async generateEnhancedDynamicResponse(e){var t;try{const a=ye(ja,"geminiAIFunction"),n=`\n${e}\n\nRESPONSE GUIDELINES:\n- Write in an engaging, natural DM voice\n- Use vivid sensory details and immersive descriptions  \n- Include appropriate character reactions and consequences\n- Balance narrative flow with player agency\n- Incorporate humor and personality as specified\n- If dice rolls are needed, mention them naturally\n- End with a clear situation for player response\n\nRESPONSE FORMAT:\nNARRATIVE: [Your main story response with rich details and character]\nNPC_DIALOGUE: [Any NPC speech in quotes, showing personality]\nSYSTEM_ACTION: [Any dice rolls, stat changes, or game mechanics needed]\nMOOD: [How this affects scene tension: +1 for more intense, 0 for same, -1 for less intense]\n\nGenerate an immersive, personalized response that makes the player feel like they're at a table with the best human DM:\n`,r=null==(t=(await a({prompt:n,context:{maxTokens:800,temperature:.8,systemRole:"dynamic_dm"}})).data)?void 0:t.response;if(!r)throw new Error("No response from AI service");return r}catch(a){return'\nNARRATIVE: The mystical energies around you shimmer and shift as your action resonates through the fabric of reality. Though the path ahead seems uncertain, your determination guides you forward into the unknown.\n\nNPC_DIALOGUE: "Interesting..." murmurs a nearby figure. "The threads of fate are weaving around you in unexpected ways."\n\nSYSTEM_ACTION: Continue with current action, maintain story flow\n\nMOOD: 0\n'}}generateFallbackResponse(){return{narrative:"The adventure begins... (AI temporarily unavailable)",choices:["Explore ahead","Gather information","Prepare equipment"],atmosphere:{mood:"mysterious",tension:"medium",environmentalDetails:"The path ahead is shrouded in uncertainty."},worldStateUpdates:{newLocation:"Starting Point",consequences:[]}}}};function ka(e,t,{checkForDefaultPrevented:a=!0}={}){return function(n){if(null==e||e(n),!1===a||!n.defaultPrevented)return null==t?void 0:t(n)}}function Ca(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function Sa(...e){return t=>{let a=!1;const n=e.map(e=>{const n=Ca(e,t);return a||"function"!=typeof n||(a=!0),n});if(a)return()=>{for(let t=0;t<n.length;t++){const a=n[t];"function"==typeof a?a():Ca(e[t],null)}}}}function Aa(...e){return a.useCallback(Sa(...e),e)}function Ta(e,t=[]){let n=[];const r=()=>{const t=n.map(e=>a.createContext(e));return function(n){const r=(null==n?void 0:n[e])||t;return a.useMemo(()=>({[`__scope${e}`]:{...n,[e]:r}}),[n,r])}};return r.scopeName=e,[function(t,r){const s=a.createContext(r),i=n.length;n=[...n,r];const o=t=>{var n;const{scope:r,children:o,...l}=t,c=(null==(n=null==r?void 0:r[e])?void 0:n[i])||s,d=a.useMemo(()=>l,Object.values(l));return Te.jsx(c.Provider,{value:d,children:o})};return o.displayName=t+"Provider",[o,function(n,o){var l;const c=(null==(l=null==o?void 0:o[e])?void 0:l[i])||s,d=a.useContext(c);if(d)return d;if(void 0!==r)return r;throw new Error(`\`${n}\` must be used within \`${t}\``)}]},Ea(r,...t)]}function Ea(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){const r=n.reduce((t,{useScope:a,scopeName:n})=>({...t,...a(e)[`__scope${n}`]}),{});return a.useMemo(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}function Pa(e){const t=Ma(e),n=a.forwardRef((e,n)=>{const{children:r,...s}=e,i=a.Children.toArray(r),o=i.find(Ra);if(o){const e=o.props.children,r=i.map(t=>t===o?a.Children.count(e)>1?a.Children.only(null):a.isValidElement(e)?e.props.children:null:t);return Te.jsx(t,{...s,ref:n,children:a.isValidElement(e)?a.cloneElement(e,void 0,r):null})}return Te.jsx(t,{...s,ref:n,children:r})});return n.displayName=`${e}.Slot`,n}function Ma(e){const t=a.forwardRef((e,t)=>{const{children:n,...r}=e;if(a.isValidElement(n)){const e=function(e){var t,a;let n=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,r=n&&"isReactWarning"in n&&n.isReactWarning;return r?e.ref:(n=null==(a=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:a.get,r=n&&"isReactWarning"in n&&n.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}(n),s=function(e,t){const a={...t};for(const n in t){const r=e[n],s=t[n];/^on[A-Z]/.test(n)?r&&s?a[n]=(...e)=>{const t=s(...e);return r(...e),t}:r&&(a[n]=r):"style"===n?a[n]={...r,...s}:"className"===n&&(a[n]=[r,s].filter(Boolean).join(" "))}return{...e,...a}}(r,n.props);return n.type!==a.Fragment&&(s.ref=t?Sa(t,e):e),a.cloneElement(n,s)}return a.Children.count(n)>1?a.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}"undefined"!=typeof window&&(window.claude={complete:e=>Na.complete(e)});var Ia=Symbol("radix.slottable");function Da(e){const t=({children:e})=>Te.jsx(Te.Fragment,{children:e});return t.displayName=`${e}.Slottable`,t.__radixId=Ia,t}function Ra(e){return a.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===Ia}var $a=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{const n=Pa(`Primitive.${t}`),r=a.forwardRef((e,a)=>{const{asChild:r,...s}=e,i=r?n:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),Te.jsx(i,{...s,ref:a})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function La(e){const t=a.useRef(e);return a.useEffect(()=>{t.current=e}),a.useMemo(()=>(...e)=>{var a;return null==(a=t.current)?void 0:a.call(t,...e)},[])}var Oa,_a="dismissableLayer.update",Ua=a.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Fa=a.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:s,onFocusOutside:i,onInteractOutside:o,onDismiss:l,...c}=e,d=a.useContext(Ua),[u,h]=a.useState(null),m=(null==u?void 0:u.ownerDocument)??(null==globalThis?void 0:globalThis.document),[,p]=a.useState({}),g=Aa(t,e=>h(e)),f=Array.from(d.layers),[x]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),y=f.indexOf(x),b=u?f.indexOf(u):-1,w=d.layersWithOutsidePointerEventsDisabled.size>0,v=b>=y,j=function(e,t=(null==globalThis?void 0:globalThis.document)){const n=La(e),r=a.useRef(!1),s=a.useRef(()=>{});return a.useEffect(()=>{const e=e=>{if(e.target&&!r.current){let a=function(){Wa("dismissableLayer.pointerDownOutside",n,r,{discrete:!0})};const r={originalEvent:e};"touch"===e.pointerType?(t.removeEventListener("click",s.current),s.current=a,t.addEventListener("click",s.current,{once:!0})):a()}else t.removeEventListener("click",s.current);r.current=!1},a=window.setTimeout(()=>{t.addEventListener("pointerdown",e)},0);return()=>{window.clearTimeout(a),t.removeEventListener("pointerdown",e),t.removeEventListener("click",s.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}(e=>{const t=e.target,a=[...d.branches].some(e=>e.contains(t));v&&!a&&(null==s||s(e),null==o||o(e),e.defaultPrevented||null==l||l())},m),N=function(e,t=(null==globalThis?void 0:globalThis.document)){const n=La(e),r=a.useRef(!1);return a.useEffect(()=>{const e=e=>{e.target&&!r.current&&Wa("dismissableLayer.focusOutside",n,{originalEvent:e},{discrete:!1})};return t.addEventListener("focusin",e),()=>t.removeEventListener("focusin",e)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}(e=>{const t=e.target;[...d.branches].some(e=>e.contains(t))||(null==i||i(e),null==o||o(e),e.defaultPrevented||null==l||l())},m);return function(e,t=(null==globalThis?void 0:globalThis.document)){const n=La(e);a.useEffect(()=>{const e=e=>{"Escape"===e.key&&n(e)};return t.addEventListener("keydown",e,{capture:!0}),()=>t.removeEventListener("keydown",e,{capture:!0})},[n,t])}(e=>{b===d.layers.size-1&&(null==r||r(e),!e.defaultPrevented&&l&&(e.preventDefault(),l()))},m),a.useEffect(()=>{if(u)return n&&(0===d.layersWithOutsidePointerEventsDisabled.size&&(Oa=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),za(),()=>{n&&1===d.layersWithOutsidePointerEventsDisabled.size&&(m.body.style.pointerEvents=Oa)}},[u,m,n,d]),a.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),za())},[u,d]),a.useEffect(()=>{const e=()=>p({});return document.addEventListener(_a,e),()=>document.removeEventListener(_a,e)},[]),Te.jsx($a.div,{...c,ref:g,style:{pointerEvents:w?v?"auto":"none":void 0,...e.style},onFocusCapture:ka(e.onFocusCapture,N.onFocusCapture),onBlurCapture:ka(e.onBlurCapture,N.onBlurCapture),onPointerDownCapture:ka(e.onPointerDownCapture,j.onPointerDownCapture)})});function za(){const e=new CustomEvent(_a);document.dispatchEvent(e)}function Wa(e,t,a,{discrete:r}){const s=a.originalEvent.target,i=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:a});t&&s.addEventListener(e,t,{once:!0}),r?function(e,t){e&&n.flushSync(()=>e.dispatchEvent(t))}(s,i):s.dispatchEvent(i)}Fa.displayName="DismissableLayer",a.forwardRef((e,t)=>{const n=a.useContext(Ua),r=a.useRef(null),s=Aa(t,r);return a.useEffect(()=>{const e=r.current;if(e)return n.branches.add(e),()=>{n.branches.delete(e)}},[n.branches]),Te.jsx($a.div,{...e,ref:s})}).displayName="DismissableLayerBranch";var Ha=(null==globalThis?void 0:globalThis.document)?a.useLayoutEffect:()=>{},Ba=r[" useId ".trim().toString()]||(()=>{}),qa=0;const Va=["top","right","bottom","left"],Ya=Math.min,Ga=Math.max,Ja=Math.round,Ka=Math.floor,Xa=e=>({x:e,y:e}),Qa={left:"right",right:"left",bottom:"top",top:"bottom"},Za={start:"end",end:"start"};function en(e,t,a){return Ga(e,Ya(t,a))}function tn(e,t){return"function"==typeof e?e(t):e}function an(e){return e.split("-")[0]}function nn(e){return e.split("-")[1]}function rn(e){return"x"===e?"y":"x"}function sn(e){return"y"===e?"height":"width"}const on=new Set(["top","bottom"]);function ln(e){return on.has(an(e))?"y":"x"}function cn(e){return rn(ln(e))}function dn(e){return e.replace(/start|end/g,e=>Za[e])}const un=["left","right"],hn=["right","left"],mn=["top","bottom"],pn=["bottom","top"];function gn(e){return e.replace(/left|right|bottom|top/g,e=>Qa[e])}function fn(e){return"number"!=typeof e?function(e){return{top:0,right:0,bottom:0,left:0,...e}}(e):{top:e,right:e,bottom:e,left:e}}function xn(e){const{x:t,y:a,width:n,height:r}=e;return{width:n,height:r,top:a,left:t,right:t+n,bottom:a+r,x:t,y:a}}function yn(e,t,a){let{reference:n,floating:r}=e;const s=ln(t),i=cn(t),o=sn(i),l=an(t),c="y"===s,d=n.x+n.width/2-r.width/2,u=n.y+n.height/2-r.height/2,h=n[o]/2-r[o]/2;let m;switch(l){case"top":m={x:d,y:n.y-r.height};break;case"bottom":m={x:d,y:n.y+n.height};break;case"right":m={x:n.x+n.width,y:u};break;case"left":m={x:n.x-r.width,y:u};break;default:m={x:n.x,y:n.y}}switch(nn(t)){case"start":m[i]-=h*(a&&c?-1:1);break;case"end":m[i]+=h*(a&&c?-1:1)}return m}async function bn(e,t){var a;void 0===t&&(t={});const{x:n,y:r,platform:s,rects:i,elements:o,strategy:l}=e,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:h=!1,padding:m=0}=tn(t,e),p=fn(m),g=o[h?"floating"===u?"reference":"floating":u],f=xn(await s.getClippingRect({element:null==(a=await(null==s.isElement?void 0:s.isElement(g)))||a?g:g.contextElement||await(null==s.getDocumentElement?void 0:s.getDocumentElement(o.floating)),boundary:c,rootBoundary:d,strategy:l})),x="floating"===u?{x:n,y:r,width:i.floating.width,height:i.floating.height}:i.reference,y=await(null==s.getOffsetParent?void 0:s.getOffsetParent(o.floating)),b=await(null==s.isElement?void 0:s.isElement(y))&&await(null==s.getScale?void 0:s.getScale(y))||{x:1,y:1},w=xn(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:x,offsetParent:y,strategy:l}):x);return{top:(f.top-w.top+p.top)/b.y,bottom:(w.bottom-f.bottom+p.bottom)/b.y,left:(f.left-w.left+p.left)/b.x,right:(w.right-f.right+p.right)/b.x}}function wn(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function vn(e){return Va.some(t=>e[t]>=0)}const jn=new Set(["left","top"]);function Nn(){return"undefined"!=typeof window}function kn(e){return An(e)?(e.nodeName||"").toLowerCase():"#document"}function Cn(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function Sn(e){var t;return null==(t=(An(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function An(e){return!!Nn()&&(e instanceof Node||e instanceof Cn(e).Node)}function Tn(e){return!!Nn()&&(e instanceof Element||e instanceof Cn(e).Element)}function En(e){return!!Nn()&&(e instanceof HTMLElement||e instanceof Cn(e).HTMLElement)}function Pn(e){return!(!Nn()||"undefined"==typeof ShadowRoot)&&(e instanceof ShadowRoot||e instanceof Cn(e).ShadowRoot)}const Mn=new Set(["inline","contents"]);function In(e){const{overflow:t,overflowX:a,overflowY:n,display:r}=Bn(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+a)&&!Mn.has(r)}const Dn=new Set(["table","td","th"]);function Rn(e){return Dn.has(kn(e))}const $n=[":popover-open",":modal"];function Ln(e){return $n.some(t=>{try{return e.matches(t)}catch(a){return!1}})}const On=["transform","translate","scale","rotate","perspective"],_n=["transform","translate","scale","rotate","perspective","filter"],Un=["paint","layout","strict","content"];function Fn(e){const t=zn(),a=Tn(e)?Bn(e):e;return On.some(e=>!!a[e]&&"none"!==a[e])||!!a.containerType&&"normal"!==a.containerType||!t&&!!a.backdropFilter&&"none"!==a.backdropFilter||!t&&!!a.filter&&"none"!==a.filter||_n.some(e=>(a.willChange||"").includes(e))||Un.some(e=>(a.contain||"").includes(e))}function zn(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}const Wn=new Set(["html","body","#document"]);function Hn(e){return Wn.has(kn(e))}function Bn(e){return Cn(e).getComputedStyle(e)}function qn(e){return Tn(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Vn(e){if("html"===kn(e))return e;const t=e.assignedSlot||e.parentNode||Pn(e)&&e.host||Sn(e);return Pn(t)?t.host:t}function Yn(e){const t=Vn(e);return Hn(t)?e.ownerDocument?e.ownerDocument.body:e.body:En(t)&&In(t)?t:Yn(t)}function Gn(e,t,a){var n;void 0===t&&(t=[]),void 0===a&&(a=!0);const r=Yn(e),s=r===(null==(n=e.ownerDocument)?void 0:n.body),i=Cn(r);if(s){const e=Jn(i);return t.concat(i,i.visualViewport||[],In(r)?r:[],e&&a?Gn(e):[])}return t.concat(r,Gn(r,[],a))}function Jn(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function Kn(e){const t=Bn(e);let a=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const r=En(e),s=r?e.offsetWidth:a,i=r?e.offsetHeight:n,o=Ja(a)!==s||Ja(n)!==i;return o&&(a=s,n=i),{width:a,height:n,$:o}}function Xn(e){return Tn(e)?e:e.contextElement}function Qn(e){const t=Xn(e);if(!En(t))return Xa(1);const a=t.getBoundingClientRect(),{width:n,height:r,$:s}=Kn(t);let i=(s?Ja(a.width):a.width)/n,o=(s?Ja(a.height):a.height)/r;return i&&Number.isFinite(i)||(i=1),o&&Number.isFinite(o)||(o=1),{x:i,y:o}}const Zn=Xa(0);function er(e){const t=Cn(e);return zn()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:Zn}function tr(e,t,a,n){void 0===t&&(t=!1),void 0===a&&(a=!1);const r=e.getBoundingClientRect(),s=Xn(e);let i=Xa(1);t&&(n?Tn(n)&&(i=Qn(n)):i=Qn(e));const o=function(e,t,a){return void 0===t&&(t=!1),!(!a||t&&a!==Cn(e))&&t}(s,a,n)?er(s):Xa(0);let l=(r.left+o.x)/i.x,c=(r.top+o.y)/i.y,d=r.width/i.x,u=r.height/i.y;if(s){const e=Cn(s),t=n&&Tn(n)?Cn(n):n;let a=e,r=Jn(a);for(;r&&n&&t!==a;){const e=Qn(r),t=r.getBoundingClientRect(),n=Bn(r),s=t.left+(r.clientLeft+parseFloat(n.paddingLeft))*e.x,i=t.top+(r.clientTop+parseFloat(n.paddingTop))*e.y;l*=e.x,c*=e.y,d*=e.x,u*=e.y,l+=s,c+=i,a=Cn(r),r=Jn(a)}}return xn({width:d,height:u,x:l,y:c})}function ar(e,t){const a=qn(e).scrollLeft;return t?t.left+a:tr(Sn(e)).left+a}function nr(e,t,a){void 0===a&&(a=!1);const n=e.getBoundingClientRect();return{x:n.left+t.scrollLeft-(a?0:ar(e,n)),y:n.top+t.scrollTop}}const rr=new Set(["absolute","fixed"]);function sr(e,t,a){let n;if("viewport"===t)n=function(e,t){const a=Cn(e),n=Sn(e),r=a.visualViewport;let s=n.clientWidth,i=n.clientHeight,o=0,l=0;if(r){s=r.width,i=r.height;const e=zn();(!e||e&&"fixed"===t)&&(o=r.offsetLeft,l=r.offsetTop)}return{width:s,height:i,x:o,y:l}}(e,a);else if("document"===t)n=function(e){const t=Sn(e),a=qn(e),n=e.ownerDocument.body,r=Ga(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),s=Ga(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let i=-a.scrollLeft+ar(e);const o=-a.scrollTop;return"rtl"===Bn(n).direction&&(i+=Ga(t.clientWidth,n.clientWidth)-r),{width:r,height:s,x:i,y:o}}(Sn(e));else if(Tn(t))n=function(e,t){const a=tr(e,!0,"fixed"===t),n=a.top+e.clientTop,r=a.left+e.clientLeft,s=En(e)?Qn(e):Xa(1);return{width:e.clientWidth*s.x,height:e.clientHeight*s.y,x:r*s.x,y:n*s.y}}(t,a);else{const a=er(e);n={x:t.x-a.x,y:t.y-a.y,width:t.width,height:t.height}}return xn(n)}function ir(e,t){const a=Vn(e);return!(a===t||!Tn(a)||Hn(a))&&("fixed"===Bn(a).position||ir(a,t))}function or(e,t,a){const n=En(t),r=Sn(t),s="fixed"===a,i=tr(e,!0,s,t);let o={scrollLeft:0,scrollTop:0};const l=Xa(0);function c(){l.x=ar(r)}if(n||!n&&!s)if(("body"!==kn(t)||In(r))&&(o=qn(t)),n){const e=tr(t,!0,s,t);l.x=e.x+t.clientLeft,l.y=e.y+t.clientTop}else r&&c();s&&!n&&r&&c();const d=!r||n||s?Xa(0):nr(r,o);return{x:i.left+o.scrollLeft-l.x-d.x,y:i.top+o.scrollTop-l.y-d.y,width:i.width,height:i.height}}function lr(e){return"static"===Bn(e).position}function cr(e,t){if(!En(e)||"fixed"===Bn(e).position)return null;if(t)return t(e);let a=e.offsetParent;return Sn(e)===a&&(a=a.ownerDocument.body),a}function dr(e,t){const a=Cn(e);if(Ln(e))return a;if(!En(e)){let t=Vn(e);for(;t&&!Hn(t);){if(Tn(t)&&!lr(t))return t;t=Vn(t)}return a}let n=cr(e,t);for(;n&&Rn(n)&&lr(n);)n=cr(n,t);return n&&Hn(n)&&lr(n)&&!Fn(n)?a:n||function(e){let t=Vn(e);for(;En(t)&&!Hn(t);){if(Fn(t))return t;if(Ln(t))return null;t=Vn(t)}return null}(e)||a}const ur={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{elements:t,rect:a,offsetParent:n,strategy:r}=e;const s="fixed"===r,i=Sn(n),o=!!t&&Ln(t.floating);if(n===i||o&&s)return a;let l={scrollLeft:0,scrollTop:0},c=Xa(1);const d=Xa(0),u=En(n);if((u||!u&&!s)&&(("body"!==kn(n)||In(i))&&(l=qn(n)),En(n))){const e=tr(n);c=Qn(n),d.x=e.x+n.clientLeft,d.y=e.y+n.clientTop}const h=!i||u||s?Xa(0):nr(i,l,!0);return{width:a.width*c.x,height:a.height*c.y,x:a.x*c.x-l.scrollLeft*c.x+d.x+h.x,y:a.y*c.y-l.scrollTop*c.y+d.y+h.y}},getDocumentElement:Sn,getClippingRect:function(e){let{element:t,boundary:a,rootBoundary:n,strategy:r}=e;const s=[..."clippingAncestors"===a?Ln(t)?[]:function(e,t){const a=t.get(e);if(a)return a;let n=Gn(e,[],!1).filter(e=>Tn(e)&&"body"!==kn(e)),r=null;const s="fixed"===Bn(e).position;let i=s?Vn(e):e;for(;Tn(i)&&!Hn(i);){const t=Bn(i),a=Fn(i);a||"fixed"!==t.position||(r=null),(s?!a&&!r:!a&&"static"===t.position&&r&&rr.has(r.position)||In(i)&&!a&&ir(e,i))?n=n.filter(e=>e!==i):r=t,i=Vn(i)}return t.set(e,n),n}(t,this._c):[].concat(a),n],i=s[0],o=s.reduce((e,a)=>{const n=sr(t,a,r);return e.top=Ga(n.top,e.top),e.right=Ya(n.right,e.right),e.bottom=Ya(n.bottom,e.bottom),e.left=Ga(n.left,e.left),e},sr(t,i,r));return{width:o.right-o.left,height:o.bottom-o.top,x:o.left,y:o.top}},getOffsetParent:dr,getElementRects:async function(e){const t=this.getOffsetParent||dr,a=this.getDimensions,n=await a(e.floating);return{reference:or(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}},getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){const{width:t,height:a}=Kn(e);return{width:t,height:a}},getScale:Qn,isElement:Tn,isRTL:function(e){return"rtl"===Bn(e).direction}};function hr(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}const mr=function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){var a,n;const{x:r,y:s,placement:i,middlewareData:o}=t,l=await async function(e,t){const{placement:a,platform:n,elements:r}=e,s=await(null==n.isRTL?void 0:n.isRTL(r.floating)),i=an(a),o=nn(a),l="y"===ln(a),c=jn.has(i)?-1:1,d=s&&l?-1:1,u=tn(t,e);let{mainAxis:h,crossAxis:m,alignmentAxis:p}="number"==typeof u?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return o&&"number"==typeof p&&(m="end"===o?-1*p:p),l?{x:m*d,y:h*c}:{x:h*c,y:m*d}}(t,e);return i===(null==(a=o.offset)?void 0:a.placement)&&null!=(n=o.arrow)&&n.alignmentOffset?{}:{x:r+l.x,y:s+l.y,data:{...l,placement:i}}}}},pr=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){const{x:a,y:n,placement:r}=t,{mainAxis:s=!0,crossAxis:i=!1,limiter:o={fn:e=>{let{x:t,y:a}=e;return{x:t,y:a}}},...l}=tn(e,t),c={x:a,y:n},d=await bn(t,l),u=ln(an(r)),h=rn(u);let m=c[h],p=c[u];if(s){const e="y"===h?"bottom":"right";m=en(m+d["y"===h?"top":"left"],m,m-d[e])}if(i){const e="y"===u?"bottom":"right";p=en(p+d["y"===u?"top":"left"],p,p-d[e])}const g=o.fn({...t,[h]:m,[u]:p});return{...g,data:{x:g.x-a,y:g.y-n,enabled:{[h]:s,[u]:i}}}}}},gr=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var a,n;const{placement:r,middlewareData:s,rects:i,initialPlacement:o,platform:l,elements:c}=t,{mainAxis:d=!0,crossAxis:u=!0,fallbackPlacements:h,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:g=!0,...f}=tn(e,t);if(null!=(a=s.arrow)&&a.alignmentOffset)return{};const x=an(r),y=ln(o),b=an(o)===o,w=await(null==l.isRTL?void 0:l.isRTL(c.floating)),v=h||(b||!g?[gn(o)]:function(e){const t=gn(e);return[dn(e),t,dn(t)]}(o)),j="none"!==p;!h&&j&&v.push(...function(e,t,a,n){const r=nn(e);let s=function(e,t,a){switch(e){case"top":case"bottom":return a?t?hn:un:t?un:hn;case"left":case"right":return t?mn:pn;default:return[]}}(an(e),"start"===a,n);return r&&(s=s.map(e=>e+"-"+r),t&&(s=s.concat(s.map(dn)))),s}(o,g,p,w));const N=[o,...v],k=await bn(t,f),C=[];let S=(null==(n=s.flip)?void 0:n.overflows)||[];if(d&&C.push(k[x]),u){const e=function(e,t,a){void 0===a&&(a=!1);const n=nn(e),r=cn(e),s=sn(r);let i="x"===r?n===(a?"end":"start")?"right":"left":"start"===n?"bottom":"top";return t.reference[s]>t.floating[s]&&(i=gn(i)),[i,gn(i)]}(r,i,w);C.push(k[e[0]],k[e[1]])}if(S=[...S,{placement:r,overflows:C}],!C.every(e=>e<=0)){var A,T;const e=((null==(A=s.flip)?void 0:A.index)||0)+1,t=N[e];if(t&&("alignment"!==u||y===ln(t)||S.every(e=>e.overflows[0]>0&&ln(e.placement)===y)))return{data:{index:e,overflows:S},reset:{placement:t}};let a=null==(T=S.filter(e=>e.overflows[0]<=0).sort((e,t)=>e.overflows[1]-t.overflows[1])[0])?void 0:T.placement;if(!a)switch(m){case"bestFit":{var E;const e=null==(E=S.filter(e=>{if(j){const t=ln(e.placement);return t===y||"y"===t}return!0}).map(e=>[e.placement,e.overflows.filter(e=>e>0).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0])?void 0:E[0];e&&(a=e);break}case"initialPlacement":a=o}if(r!==a)return{reset:{placement:a}}}return{}}}},fr=function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(t){var a,n;const{placement:r,rects:s,platform:i,elements:o}=t,{apply:l=()=>{},...c}=tn(e,t),d=await bn(t,c),u=an(r),h=nn(r),m="y"===ln(r),{width:p,height:g}=s.floating;let f,x;"top"===u||"bottom"===u?(f=u,x=h===(await(null==i.isRTL?void 0:i.isRTL(o.floating))?"start":"end")?"left":"right"):(x=u,f="end"===h?"top":"bottom");const y=g-d.top-d.bottom,b=p-d.left-d.right,w=Ya(g-d[f],y),v=Ya(p-d[x],b),j=!t.middlewareData.shift;let N=w,k=v;if(null!=(a=t.middlewareData.shift)&&a.enabled.x&&(k=b),null!=(n=t.middlewareData.shift)&&n.enabled.y&&(N=y),j&&!h){const e=Ga(d.left,0),t=Ga(d.right,0),a=Ga(d.top,0),n=Ga(d.bottom,0);m?k=p-2*(0!==e||0!==t?e+t:Ga(d.left,d.right)):N=g-2*(0!==a||0!==n?a+n:Ga(d.top,d.bottom))}await l({...t,availableWidth:k,availableHeight:N});const C=await i.getDimensions(o.floating);return p!==C.width||g!==C.height?{reset:{rects:!0}}:{}}}},xr=function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(t){const{rects:a}=t,{strategy:n="referenceHidden",...r}=tn(e,t);switch(n){case"referenceHidden":{const e=wn(await bn(t,{...r,elementContext:"reference"}),a.reference);return{data:{referenceHiddenOffsets:e,referenceHidden:vn(e)}}}case"escaped":{const e=wn(await bn(t,{...r,altBoundary:!0}),a.floating);return{data:{escapedOffsets:e,escaped:vn(e)}}}default:return{}}}}},yr=e=>({name:"arrow",options:e,async fn(t){const{x:a,y:n,placement:r,rects:s,platform:i,elements:o,middlewareData:l}=t,{element:c,padding:d=0}=tn(e,t)||{};if(null==c)return{};const u=fn(d),h={x:a,y:n},m=cn(r),p=sn(m),g=await i.getDimensions(c),f="y"===m,x=f?"top":"left",y=f?"bottom":"right",b=f?"clientHeight":"clientWidth",w=s.reference[p]+s.reference[m]-h[m]-s.floating[p],v=h[m]-s.reference[m],j=await(null==i.getOffsetParent?void 0:i.getOffsetParent(c));let N=j?j[b]:0;N&&await(null==i.isElement?void 0:i.isElement(j))||(N=o.floating[b]||s.floating[p]);const k=w/2-v/2,C=N/2-g[p]/2-1,S=Ya(u[x],C),A=Ya(u[y],C),T=S,E=N-g[p]-A,P=N/2-g[p]/2+k,M=en(T,P,E),I=!l.arrow&&null!=nn(r)&&P!==M&&s.reference[p]/2-(P<T?S:A)-g[p]/2<0,D=I?P<T?P-T:P-E:0;return{[m]:h[m]+D,data:{[m]:M,centerOffset:P-M-D,...I&&{alignmentOffset:D}},reset:I}}}),br=function(e){return void 0===e&&(e={}),{options:e,fn(t){const{x:a,y:n,placement:r,rects:s,middlewareData:i}=t,{offset:o=0,mainAxis:l=!0,crossAxis:c=!0}=tn(e,t),d={x:a,y:n},u=ln(r),h=rn(u);let m=d[h],p=d[u];const g=tn(o,t),f="number"==typeof g?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(l){const e="y"===h?"height":"width",t=s.reference[h]-s.floating[e]+f.mainAxis,a=s.reference[h]+s.reference[e]-f.mainAxis;m<t?m=t:m>a&&(m=a)}if(c){var x,y;const e="y"===h?"width":"height",t=jn.has(an(r)),a=s.reference[u]-s.floating[e]+(t&&(null==(x=i.offset)?void 0:x[u])||0)+(t?0:f.crossAxis),n=s.reference[u]+s.reference[e]+(t?0:(null==(y=i.offset)?void 0:y[u])||0)-(t?f.crossAxis:0);p<a?p=a:p>n&&(p=n)}return{[h]:m,[u]:p}}}};var wr="undefined"!=typeof document?a.useLayoutEffect:function(){};function vr(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;let a,n,r;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if(a=e.length,a!==t.length)return!1;for(n=a;0!==n--;)if(!vr(e[n],t[n]))return!1;return!0}if(r=Object.keys(e),a=r.length,a!==Object.keys(t).length)return!1;for(n=a;0!==n--;)if(!{}.hasOwnProperty.call(t,r[n]))return!1;for(n=a;0!==n--;){const a=r[n];if(!("_owner"===a&&e.$$typeof||vr(e[a],t[a])))return!1}return!0}return e!=e&&t!=t}function jr(e){return"undefined"==typeof window?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function Nr(e,t){const a=jr(e);return Math.round(t*a)/a}function kr(e){const t=a.useRef(e);return wr(()=>{t.current=e}),t}const Cr=e=>({name:"arrow",options:e,fn(t){const{element:a,padding:n}="function"==typeof e?e(t):e;return a&&(r=a,{}.hasOwnProperty.call(r,"current"))?null!=a.current?yr({element:a.current,padding:n}).fn(t):{}:a?yr({element:a,padding:n}).fn(t):{};var r}}),Sr=(e,t)=>({...pr(e),options:[e,t]}),Ar=(e,t)=>({...br(e),options:[e,t]}),Tr=(e,t)=>({...gr(e),options:[e,t]}),Er=(e,t)=>({...fr(e),options:[e,t]}),Pr=(e,t)=>({...xr(e),options:[e,t]}),Mr=(e,t)=>({...Cr(e),options:[e,t]});var Ir=a.forwardRef((e,t)=>{const{children:a,width:n=10,height:r=5,...s}=e;return Te.jsx($a.svg,{...s,ref:t,width:n,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?a:Te.jsx("polygon",{points:"0,0 30,0 15,10"})})});Ir.displayName="Arrow";var Dr=Ir,Rr="Popper",[$r,Lr]=Ta(Rr),[Or,_r]=$r(Rr),Ur=e=>{const{__scopePopper:t,children:n}=e,[r,s]=a.useState(null);return Te.jsx(Or,{scope:t,anchor:r,onAnchorChange:s,children:n})};Ur.displayName=Rr;var Fr="PopperAnchor",zr=a.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:r,...s}=e,i=_r(Fr,n),o=a.useRef(null),l=Aa(t,o);return a.useEffect(()=>{i.onAnchorChange((null==r?void 0:r.current)||o.current)}),r?null:Te.jsx($a.div,{...s,ref:l})});zr.displayName=Fr;var Wr="PopperContent",[Hr,Br]=$r(Wr),qr=a.forwardRef((e,t)=>{var r,s,i,o,l,c;const{__scopePopper:d,side:u="bottom",sideOffset:h=0,align:m="center",alignOffset:p=0,arrowPadding:g=0,avoidCollisions:f=!0,collisionBoundary:x=[],collisionPadding:y=0,sticky:b="partial",hideWhenDetached:w=!1,updatePositionStrategy:v="optimized",onPlaced:j,...N}=e,k=_r(Wr,d),[C,S]=a.useState(null),A=Aa(t,e=>S(e)),[T,E]=a.useState(null),P=function(e){const[t,n]=a.useState(void 0);return Ha(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const t=new ResizeObserver(t=>{if(!Array.isArray(t))return;if(!t.length)return;const a=t[0];let r,s;if("borderBoxSize"in a){const e=a.borderBoxSize,t=Array.isArray(e)?e[0]:e;r=t.inlineSize,s=t.blockSize}else r=e.offsetWidth,s=e.offsetHeight;n({width:r,height:s})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}n(void 0)},[e]),t}(T),M=(null==P?void 0:P.width)??0,I=(null==P?void 0:P.height)??0,D=u+("center"!==m?"-"+m:""),R="number"==typeof y?y:{top:0,right:0,bottom:0,left:0,...y},$=Array.isArray(x)?x:[x],L=$.length>0,O={padding:R,boundary:$.filter(Jr),altBoundary:L},{refs:_,floatingStyles:U,placement:F,isPositioned:z,middlewareData:W}=function(e){void 0===e&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:s=[],platform:i,elements:{reference:o,floating:l}={},transform:c=!0,whileElementsMounted:d,open:u}=e,[h,m]=a.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[p,g]=a.useState(s);vr(p,s)||g(s);const[f,x]=a.useState(null),[y,b]=a.useState(null),w=a.useCallback(e=>{e!==k.current&&(k.current=e,x(e))},[]),v=a.useCallback(e=>{e!==C.current&&(C.current=e,b(e))},[]),j=o||f,N=l||y,k=a.useRef(null),C=a.useRef(null),S=a.useRef(h),A=null!=d,T=kr(d),E=kr(i),P=kr(u),M=a.useCallback(()=>{if(!k.current||!C.current)return;const e={placement:t,strategy:r,middleware:p};E.current&&(e.platform=E.current),((e,t,a)=>{const n=new Map,r={platform:ur,...a},s={...r.platform,_c:n};return(async(e,t,a)=>{const{placement:n="bottom",strategy:r="absolute",middleware:s=[],platform:i}=a,o=s.filter(Boolean),l=await(null==i.isRTL?void 0:i.isRTL(t));let c=await i.getElementRects({reference:e,floating:t,strategy:r}),{x:d,y:u}=yn(c,n,l),h=n,m={},p=0;for(let g=0;g<o.length;g++){const{name:a,fn:s}=o[g],{x:f,y:x,data:y,reset:b}=await s({x:d,y:u,initialPlacement:n,placement:h,strategy:r,middlewareData:m,rects:c,platform:i,elements:{reference:e,floating:t}});d=null!=f?f:d,u=null!=x?x:u,m={...m,[a]:{...m[a],...y}},b&&p<=50&&(p++,"object"==typeof b&&(b.placement&&(h=b.placement),b.rects&&(c=!0===b.rects?await i.getElementRects({reference:e,floating:t,strategy:r}):b.rects),({x:d,y:u}=yn(c,h,l))),g=-1)}return{x:d,y:u,placement:h,strategy:r,middlewareData:m}})(e,t,{...r,platform:s})})(k.current,C.current,e).then(e=>{const t={...e,isPositioned:!1!==P.current};I.current&&!vr(S.current,t)&&(S.current=t,n.flushSync(()=>{m(t)}))})},[p,t,r,E,P]);wr(()=>{!1===u&&S.current.isPositioned&&(S.current.isPositioned=!1,m(e=>({...e,isPositioned:!1})))},[u]);const I=a.useRef(!1);wr(()=>(I.current=!0,()=>{I.current=!1}),[]),wr(()=>{if(j&&(k.current=j),N&&(C.current=N),j&&N){if(T.current)return T.current(j,N,M);M()}},[j,N,M,T,A]);const D=a.useMemo(()=>({reference:k,floating:C,setReference:w,setFloating:v}),[w,v]),R=a.useMemo(()=>({reference:j,floating:N}),[j,N]),$=a.useMemo(()=>{const e={position:r,left:0,top:0};if(!R.floating)return e;const t=Nr(R.floating,h.x),a=Nr(R.floating,h.y);return c?{...e,transform:"translate("+t+"px, "+a+"px)",...jr(R.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:t,top:a}},[r,c,R.floating,h.x,h.y]);return a.useMemo(()=>({...h,update:M,refs:D,elements:R,floatingStyles:$}),[h,M,D,R,$])}({strategy:"fixed",placement:D,whileElementsMounted:(...e)=>function(e,t,a,n){void 0===n&&(n={});const{ancestorScroll:r=!0,ancestorResize:s=!0,elementResize:i="function"==typeof ResizeObserver,layoutShift:o="function"==typeof IntersectionObserver,animationFrame:c=!1}=n,d=Xn(e),u=r||s?[...d?Gn(d):[],...Gn(t)]:[];u.forEach(e=>{r&&e.addEventListener("scroll",a,{passive:!0}),s&&e.addEventListener("resize",a)});const h=d&&o?function(e,t){let a,n=null;const r=Sn(e);function s(){var e;clearTimeout(a),null==(e=n)||e.disconnect(),n=null}return function i(o,c){void 0===o&&(o=!1),void 0===c&&(c=1),s();const d=e.getBoundingClientRect(),{left:u,top:h,width:m,height:p}=d;if(o||t(),!m||!p)return;const g={rootMargin:-Ka(h)+"px "+-Ka(r.clientWidth-(u+m))+"px "+-Ka(r.clientHeight-(h+p))+"px "+-Ka(u)+"px",threshold:Ga(0,Ya(1,c))||1};let f=!0;function x(t){const n=t[0].intersectionRatio;if(n!==c){if(!f)return i();n?i(!1,n):a=setTimeout(()=>{i(!1,1e-7)},1e3)}1!==n||hr(d,e.getBoundingClientRect())||i(),f=!1}try{n=new IntersectionObserver(x,{...g,root:r.ownerDocument})}catch(l){n=new IntersectionObserver(x,g)}n.observe(e)}(!0),s}(d,a):null;let m,p=-1,g=null;i&&(g=new ResizeObserver(e=>{let[n]=e;n&&n.target===d&&g&&(g.unobserve(t),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{var e;null==(e=g)||e.observe(t)})),a()}),d&&!c&&g.observe(d),g.observe(t));let f=c?tr(e):null;return c&&function t(){const n=tr(e);f&&!hr(f,n)&&a(),f=n,m=requestAnimationFrame(t)}(),a(),()=>{var e;u.forEach(e=>{r&&e.removeEventListener("scroll",a),s&&e.removeEventListener("resize",a)}),null==h||h(),null==(e=g)||e.disconnect(),g=null,c&&cancelAnimationFrame(m)}}(...e,{animationFrame:"always"===v}),elements:{reference:k.anchor},middleware:[(H={mainAxis:h+I,alignmentAxis:p},{...mr(H),options:[H,undefined]}),f&&Sr({mainAxis:!0,crossAxis:!1,limiter:"partial"===b?Ar():void 0,...O}),f&&Tr({...O}),Er({...O,apply:({elements:e,rects:t,availableWidth:a,availableHeight:n})=>{const{width:r,height:s}=t.reference,i=e.floating.style;i.setProperty("--radix-popper-available-width",`${a}px`),i.setProperty("--radix-popper-available-height",`${n}px`),i.setProperty("--radix-popper-anchor-width",`${r}px`),i.setProperty("--radix-popper-anchor-height",`${s}px`)}}),T&&Mr({element:T,padding:g}),Kr({arrowWidth:M,arrowHeight:I}),w&&Pr({strategy:"referenceHidden",...O})]});var H;const[B,q]=Xr(F),V=La(j);Ha(()=>{z&&(null==V||V())},[z,V]);const Y=null==(r=W.arrow)?void 0:r.x,G=null==(s=W.arrow)?void 0:s.y,J=0!==(null==(i=W.arrow)?void 0:i.centerOffset),[K,X]=a.useState();return Ha(()=>{C&&X(window.getComputedStyle(C).zIndex)},[C]),Te.jsx("div",{ref:_.setFloating,"data-radix-popper-content-wrapper":"",style:{...U,transform:z?U.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:K,"--radix-popper-transform-origin":[null==(o=W.transformOrigin)?void 0:o.x,null==(l=W.transformOrigin)?void 0:l.y].join(" "),...(null==(c=W.hide)?void 0:c.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:Te.jsx(Hr,{scope:d,placedSide:B,onArrowChange:E,arrowX:Y,arrowY:G,shouldHideArrow:J,children:Te.jsx($a.div,{"data-side":B,"data-align":q,...N,ref:A,style:{...N.style,animation:z?void 0:"none"}})})})});qr.displayName=Wr;var Vr="PopperArrow",Yr={top:"bottom",right:"left",bottom:"top",left:"right"},Gr=a.forwardRef(function(e,t){const{__scopePopper:a,...n}=e,r=Br(Vr,a),s=Yr[r.placedSide];return Te.jsx("span",{ref:r.onArrowChange,style:{position:"absolute",left:r.arrowX,top:r.arrowY,[s]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[r.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[r.placedSide],visibility:r.shouldHideArrow?"hidden":void 0},children:Te.jsx(Dr,{...n,ref:t,style:{...n.style,display:"block"}})})});function Jr(e){return null!==e}Gr.displayName=Vr;var Kr=e=>({name:"transformOrigin",options:e,fn(t){var a,n,r;const{placement:s,rects:i,middlewareData:o}=t,l=0!==(null==(a=o.arrow)?void 0:a.centerOffset),c=l?0:e.arrowWidth,d=l?0:e.arrowHeight,[u,h]=Xr(s),m={start:"0%",center:"50%",end:"100%"}[h],p=((null==(n=o.arrow)?void 0:n.x)??0)+c/2,g=((null==(r=o.arrow)?void 0:r.y)??0)+d/2;let f="",x="";return"bottom"===u?(f=l?m:`${p}px`,x=-d+"px"):"top"===u?(f=l?m:`${p}px`,x=`${i.floating.height+d}px`):"right"===u?(f=-d+"px",x=l?m:`${g}px`):"left"===u&&(f=`${i.floating.width+d}px`,x=l?m:`${g}px`),{data:{x:f,y:x}}}});function Xr(e){const[t,a="center"]=e.split("-");return[t,a]}var Qr=Ur,Zr=zr,es=qr,ts=Gr,as=a.forwardRef((e,t)=>{var n;const{container:r,...i}=e,[o,l]=a.useState(!1);Ha(()=>l(!0),[]);const c=r||o&&(null==(n=null==globalThis?void 0:globalThis.document)?void 0:n.body);return c?s.createPortal(Te.jsx($a.div,{...i,ref:t}),c):null});as.displayName="Portal";var ns=e=>{const{present:t,children:n}=e,r=function(e){const[t,n]=a.useState(),r=a.useRef(null),s=a.useRef(e),i=a.useRef("none"),o=e?"mounted":"unmounted",[l,c]=function(e,t){return a.useReducer((e,a)=>t[e][a]??e,e)}(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return a.useEffect(()=>{const e=rs(r.current);i.current="mounted"===l?e:"none"},[l]),Ha(()=>{const t=r.current,a=s.current;if(a!==e){const n=i.current,r=rs(t);e?c("MOUNT"):"none"===r||"none"===(null==t?void 0:t.display)?c("UNMOUNT"):c(a&&n!==r?"ANIMATION_OUT":"UNMOUNT"),s.current=e}},[e,c]),Ha(()=>{if(t){let e;const a=t.ownerDocument.defaultView??window,n=n=>{const i=rs(r.current).includes(n.animationName);if(n.target===t&&i&&(c("ANIMATION_END"),!s.current)){const n=t.style.animationFillMode;t.style.animationFillMode="forwards",e=a.setTimeout(()=>{"forwards"===t.style.animationFillMode&&(t.style.animationFillMode=n)})}},o=e=>{e.target===t&&(i.current=rs(r.current))};return t.addEventListener("animationstart",o),t.addEventListener("animationcancel",n),t.addEventListener("animationend",n),()=>{a.clearTimeout(e),t.removeEventListener("animationstart",o),t.removeEventListener("animationcancel",n),t.removeEventListener("animationend",n)}}c("ANIMATION_END")},[t,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:a.useCallback(e=>{r.current=e?getComputedStyle(e):null,n(e)},[])}}(t),s="function"==typeof n?n({present:r.isPresent}):a.Children.only(n),i=Aa(r.ref,function(e){var t,a;let n=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,r=n&&"isReactWarning"in n&&n.isReactWarning;return r?e.ref:(n=null==(a=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:a.get,r=n&&"isReactWarning"in n&&n.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}(s));return"function"==typeof n||r.isPresent?a.cloneElement(s,{ref:i}):null};function rs(e){return(null==e?void 0:e.animationName)||"none"}ns.displayName="Presence";var ss=r[" useInsertionEffect ".trim().toString()]||Ha;var is=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),os=a.forwardRef((e,t)=>Te.jsx($a.span,{...e,ref:t,style:{...is,...e.style}}));os.displayName="VisuallyHidden";var ls=os,[cs,ds]=Ta("Tooltip",[Lr]),us=Lr(),hs="TooltipProvider",ms=700,ps="tooltip.open",[gs,fs]=cs(hs),xs=e=>{const{__scopeTooltip:t,delayDuration:n=ms,skipDelayDuration:r=300,disableHoverableContent:s=!1,children:i}=e,o=a.useRef(!0),l=a.useRef(!1),c=a.useRef(0);return a.useEffect(()=>{const e=c.current;return()=>window.clearTimeout(e)},[]),Te.jsx(gs,{scope:t,isOpenDelayedRef:o,delayDuration:n,onOpen:a.useCallback(()=>{window.clearTimeout(c.current),o.current=!1},[]),onClose:a.useCallback(()=>{window.clearTimeout(c.current),c.current=window.setTimeout(()=>o.current=!0,r)},[r]),isPointerInTransitRef:l,onPointerInTransitChange:a.useCallback(e=>{l.current=e},[]),disableHoverableContent:s,children:i})};xs.displayName=hs;var ys="Tooltip",[bs,ws]=cs(ys),vs=e=>{const{__scopeTooltip:t,children:n,open:r,defaultOpen:s,onOpenChange:i,disableHoverableContent:o,delayDuration:l}=e,c=fs(ys,e.__scopeTooltip),d=us(t),[u,h]=a.useState(null),m=function(e){const[t,n]=a.useState(Ba());return Ha(()=>{n(e=>e??String(qa++))},[e]),t?`radix-${t}`:""}(),p=a.useRef(0),g=o??c.disableHoverableContent,f=l??c.delayDuration,x=a.useRef(!1),[y,b]=function({prop:e,defaultProp:t,onChange:n=()=>{},caller:r}){const[s,i,o]=function({defaultProp:e,onChange:t}){const[n,r]=a.useState(e),s=a.useRef(n),i=a.useRef(t);return ss(()=>{i.current=t},[t]),a.useEffect(()=>{var e;s.current!==n&&(null==(e=i.current)||e.call(i,n),s.current=n)},[n,s]),[n,r,i]}({defaultProp:t,onChange:n}),l=void 0!==e,c=l?e:s;{const t=a.useRef(void 0!==e);a.useEffect(()=>{t.current,t.current=l},[l,r])}const d=a.useCallback(t=>{var a;if(l){const n=function(e){return"function"==typeof e}(t)?t(e):t;n!==e&&(null==(a=o.current)||a.call(o,n))}else i(t)},[l,e,i,o]);return[c,d]}({prop:r,defaultProp:s??!1,onChange:e=>{e?(c.onOpen(),document.dispatchEvent(new CustomEvent(ps))):c.onClose(),null==i||i(e)},caller:ys}),w=a.useMemo(()=>y?x.current?"delayed-open":"instant-open":"closed",[y]),v=a.useCallback(()=>{window.clearTimeout(p.current),p.current=0,x.current=!1,b(!0)},[b]),j=a.useCallback(()=>{window.clearTimeout(p.current),p.current=0,b(!1)},[b]),N=a.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{x.current=!0,b(!0),p.current=0},f)},[f,b]);return a.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),Te.jsx(Qr,{...d,children:Te.jsx(bs,{scope:t,contentId:m,open:y,stateAttribute:w,trigger:u,onTriggerChange:h,onTriggerEnter:a.useCallback(()=>{c.isOpenDelayedRef.current?N():v()},[c.isOpenDelayedRef,N,v]),onTriggerLeave:a.useCallback(()=>{g?j():(window.clearTimeout(p.current),p.current=0)},[j,g]),onOpen:v,onClose:j,disableHoverableContent:g,children:n})})};vs.displayName=ys;var js="TooltipTrigger",Ns=a.forwardRef((e,t)=>{const{__scopeTooltip:n,...r}=e,s=ws(js,n),i=fs(js,n),o=us(n),l=Aa(t,a.useRef(null),s.onTriggerChange),c=a.useRef(!1),d=a.useRef(!1),u=a.useCallback(()=>c.current=!1,[]);return a.useEffect(()=>()=>document.removeEventListener("pointerup",u),[u]),Te.jsx(Zr,{asChild:!0,...o,children:Te.jsx($a.button,{"aria-describedby":s.open?s.contentId:void 0,"data-state":s.stateAttribute,...r,ref:l,onPointerMove:ka(e.onPointerMove,e=>{"touch"!==e.pointerType&&(d.current||i.isPointerInTransitRef.current||(s.onTriggerEnter(),d.current=!0))}),onPointerLeave:ka(e.onPointerLeave,()=>{s.onTriggerLeave(),d.current=!1}),onPointerDown:ka(e.onPointerDown,()=>{s.open&&s.onClose(),c.current=!0,document.addEventListener("pointerup",u,{once:!0})}),onFocus:ka(e.onFocus,()=>{c.current||s.onOpen()}),onBlur:ka(e.onBlur,s.onClose),onClick:ka(e.onClick,s.onClose)})})});Ns.displayName=js;var ks="TooltipPortal",[Cs,Ss]=cs(ks,{forceMount:void 0}),As=e=>{const{__scopeTooltip:t,forceMount:a,children:n,container:r}=e,s=ws(ks,t);return Te.jsx(Cs,{scope:t,forceMount:a,children:Te.jsx(ns,{present:a||s.open,children:Te.jsx(as,{asChild:!0,container:r,children:n})})})};As.displayName=ks;var Ts="TooltipContent",Es=a.forwardRef((e,t)=>{const a=Ss(Ts,e.__scopeTooltip),{forceMount:n=a.forceMount,side:r="top",...s}=e,i=ws(Ts,e.__scopeTooltip);return Te.jsx(ns,{present:n||i.open,children:i.disableHoverableContent?Te.jsx(Rs,{side:r,...s,ref:t}):Te.jsx(Ps,{side:r,...s,ref:t})})}),Ps=a.forwardRef((e,t)=>{const n=ws(Ts,e.__scopeTooltip),r=fs(Ts,e.__scopeTooltip),s=a.useRef(null),i=Aa(t,s),[o,l]=a.useState(null),{trigger:c,onClose:d}=n,u=s.current,{onPointerInTransitChange:h}=r,m=a.useCallback(()=>{l(null),h(!1)},[h]),p=a.useCallback((e,t)=>{const a=e.currentTarget,n={x:e.clientX,y:e.clientY},r=function(e,t,a=5){const n=[];switch(t){case"top":n.push({x:e.x-a,y:e.y+a},{x:e.x+a,y:e.y+a});break;case"bottom":n.push({x:e.x-a,y:e.y-a},{x:e.x+a,y:e.y-a});break;case"left":n.push({x:e.x+a,y:e.y-a},{x:e.x+a,y:e.y+a});break;case"right":n.push({x:e.x-a,y:e.y-a},{x:e.x-a,y:e.y+a})}return n}(n,function(e,t){const a=Math.abs(t.top-e.y),n=Math.abs(t.bottom-e.y),r=Math.abs(t.right-e.x),s=Math.abs(t.left-e.x);switch(Math.min(a,n,r,s)){case s:return"left";case r:return"right";case a:return"top";case n:return"bottom";default:throw new Error("unreachable")}}(n,a.getBoundingClientRect())),s=function(e){const t=e.slice();return t.sort((e,t)=>e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0),function(e){if(e.length<=1)return e.slice();const t=[];for(let n=0;n<e.length;n++){const a=e[n];for(;t.length>=2;){const e=t[t.length-1],n=t[t.length-2];if(!((e.x-n.x)*(a.y-n.y)>=(e.y-n.y)*(a.x-n.x)))break;t.pop()}t.push(a)}t.pop();const a=[];for(let n=e.length-1;n>=0;n--){const t=e[n];for(;a.length>=2;){const e=a[a.length-1],n=a[a.length-2];if(!((e.x-n.x)*(t.y-n.y)>=(e.y-n.y)*(t.x-n.x)))break;a.pop()}a.push(t)}return a.pop(),1===t.length&&1===a.length&&t[0].x===a[0].x&&t[0].y===a[0].y?t:t.concat(a)}(t)}([...r,...function(e){const{top:t,right:a,bottom:n,left:r}=e;return[{x:r,y:t},{x:a,y:t},{x:a,y:n},{x:r,y:n}]}(t.getBoundingClientRect())]);l(s),h(!0)},[h]);return a.useEffect(()=>()=>m(),[m]),a.useEffect(()=>{if(c&&u){const e=e=>p(e,u),t=e=>p(e,c);return c.addEventListener("pointerleave",e),u.addEventListener("pointerleave",t),()=>{c.removeEventListener("pointerleave",e),u.removeEventListener("pointerleave",t)}}},[c,u,p,m]),a.useEffect(()=>{if(o){const e=e=>{const t=e.target,a={x:e.clientX,y:e.clientY},n=(null==c?void 0:c.contains(t))||(null==u?void 0:u.contains(t)),r=!function(e,t){const{x:a,y:n}=e;let r=!1;for(let s=0,i=t.length-1;s<t.length;i=s++){const e=t[s],o=t[i],l=e.x,c=e.y,d=o.x,u=o.y;c>n!=u>n&&a<(d-l)*(n-c)/(u-c)+l&&(r=!r)}return r}(a,o);n?m():r&&(m(),d())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}},[c,u,o,d,m]),Te.jsx(Rs,{...e,ref:i})}),[Ms,Is]=cs(ys,{isInside:!1}),Ds=Da("TooltipContent"),Rs=a.forwardRef((e,t)=>{const{__scopeTooltip:n,children:r,"aria-label":s,onEscapeKeyDown:i,onPointerDownOutside:o,...l}=e,c=ws(Ts,n),d=us(n),{onClose:u}=c;return a.useEffect(()=>(document.addEventListener(ps,u),()=>document.removeEventListener(ps,u)),[u]),a.useEffect(()=>{if(c.trigger){const e=e=>{const t=e.target;(null==t?void 0:t.contains(c.trigger))&&u()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}},[c.trigger,u]),Te.jsx(Fa,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:e=>e.preventDefault(),onDismiss:u,children:Te.jsxs(es,{"data-state":c.stateAttribute,...d,...l,ref:t,style:{...l.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[Te.jsx(Ds,{children:r}),Te.jsx(Ms,{scope:n,isInside:!0,children:Te.jsx(ls,{id:c.contentId,role:"tooltip",children:s||r})})]})})});Es.displayName=Ts;var $s="TooltipArrow",Ls=a.forwardRef((e,t)=>{const{__scopeTooltip:a,...n}=e,r=us(a);return Is($s,a).isInside?null:Te.jsx(ts,{...r,...n,ref:t})});Ls.displayName=$s;var Os=xs,_s=vs,Us=Ns,Fs=As,zs=Es,Ws=Ls;const Hs=({children:e,content:t,side:a="top",align:n="center",delayDuration:r=500,className:s="",ariaLabel:i})=>Te.jsx(Os,{children:Te.jsxs(_s,{delayDuration:r,children:[Te.jsx(Us,{asChild:!0,children:Te.jsx("div",{className:s,tabIndex:0,role:"button","aria-label":i||t,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||e.preventDefault()},children:e})}),Te.jsx(Fs,{children:Te.jsxs(zs,{side:a,align:n,sideOffset:5,className:"z-50 px-3 py-2 text-sm text-white bg-gray-900/95 backdrop-blur-sm rounded-lg shadow-xl border border-gray-700/50 max-w-xs break-words animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 md:max-w-sm lg:max-w-md","aria-describedby":"tooltip-content",children:[Te.jsx("span",{id:"tooltip-content",className:"leading-relaxed",children:t}),Te.jsx(Ws,{className:"fill-gray-900/95"})]})})]})});class Bs extends i.Component{constructor(e){super(e),t(this,"resetError",()=>{this.setState({hasError:!1,error:null,errorInfo:null})}),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e,errorInfo:null}}componentDidCatch(e,t){"undefined"!=typeof window&&window.gtag&&window.gtag("event","exception",{description:e.message,fatal:!0}),this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?this.props.fallback?Te.jsx(this.props.fallback,{error:this.state.error,resetError:this.resetError}):Te.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-950 via-red-900 to-red-800 flex items-center justify-center p-4",children:Te.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-3xl p-8 max-w-md w-full border border-white/20 text-center",children:[Te.jsx("div",{className:"text-red-400 mb-6",children:Te.jsx(te,{size:64,className:"mx-auto"})}),Te.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:"Oops! Something went wrong"}),Te.jsx("p",{className:"text-red-200 mb-6",children:"We encountered an unexpected error. Don't worry, your progress is safe!"}),!1,Te.jsxs("div",{className:"space-y-3",children:[Te.jsxs("button",{onClick:this.resetError,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-all flex items-center justify-center space-x-2",children:[Te.jsx(ae,{size:20}),Te.jsx("span",{children:"Try Again"})]}),Te.jsxs("button",{onClick:()=>window.location.href="/",className:"w-full px-6 py-3 bg-white/20 text-white rounded-xl font-semibold hover:bg-white/30 transition-all flex items-center justify-center space-x-2",children:[Te.jsx(ne,{size:20}),Te.jsx("span",{children:"Go Home"})]})]}),Te.jsx("p",{className:"text-red-300 text-sm mt-6",children:"If this problem persists, please contact support."})]})}):this.props.children}}const qs=({messages:e,onDismiss:t})=>Te.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:e.map(e=>Te.jsx(Vs,{toast:e,onDismiss:t},e.id))}),Vs=({toast:e,onDismiss:t})=>{const[n,r]=a.useState(!1);return a.useEffect(()=>{r(!0);const a=setTimeout(()=>{r(!1),setTimeout(()=>t(e.id),300)},e.duration||4e3);return()=>clearTimeout(a)},[e.id,e.duration,t]),Te.jsx("div",{className:`${(()=>{switch(e.type){case"achievement":return"bg-gradient-to-r from-yellow-600 to-orange-600";case"success":return"bg-gradient-to-r from-green-600 to-emerald-600";case"warning":return"bg-gradient-to-r from-orange-600 to-red-600";case"fun":return"bg-gradient-to-r from-purple-600 to-pink-600";default:return"bg-gradient-to-r from-blue-600 to-indigo-600"}})()} text-white rounded-lg shadow-lg border border-white/20 backdrop-blur-sm transform transition-all duration-300 ${n?"translate-x-0 opacity-100":"translate-x-full opacity-0"}`,style:{minWidth:"300px",maxWidth:"400px"},children:Te.jsx("div",{className:"p-4",children:Te.jsxs("div",{className:"flex items-start space-x-3",children:[Te.jsx("div",{className:"flex-shrink-0 mt-0.5",children:(()=>{if(e.icon)return e.icon;switch(e.type){case"achievement":return Te.jsx(Y,{className:"w-5 h-5 text-yellow-400"});case"success":return Te.jsx(V,{className:"w-5 h-5 text-green-400"});case"warning":return Te.jsx(oe,{className:"w-5 h-5 text-orange-400"});case"fun":return Te.jsx(ie,{className:"w-5 h-5 text-purple-400"});default:return Te.jsx(se,{className:"w-5 h-5 text-blue-400"})}})()}),Te.jsxs("div",{className:"flex-1 min-w-0",children:[Te.jsx("h4",{className:"text-sm font-semibold mb-1",children:e.title}),Te.jsx("p",{className:"text-xs text-white/90 leading-relaxed",children:e.message}),e.action&&Te.jsx("button",{onClick:e.action.onClick,className:"mt-2 px-3 py-1 bg-white/20 hover:bg-white/30 rounded text-xs font-medium transition-colors",children:e.action.label})]}),Te.jsx("button",{onClick:()=>{r(!1),setTimeout(()=>t(e.id),300)},className:"flex-shrink-0 text-white/70 hover:text-white transition-colors",children:Te.jsx(re,{className:"w-4 h-4"})})]})})})},Ys=new class{constructor(){t(this,"unsubscribeFunctions",[]),t(this,"currentUser",null),t(this,"currentCampaignId",null),t(this,"listeners",new Map),t(this,"isFirebaseAvailable"),this.isFirebaseAvailable=!(!ya||!xa),this.isFirebaseAvailable&&this.initializeAuth()}initializeAuth(){xa&&P(xa,e=>{this.currentUser=e,e||this.cleanup()})}async createCampaign(e){if(!this.isFirebaseAvailable)return"demo-"+Date.now();if(!this.currentUser)throw new Error("User not authenticated");if(!ya)throw new Error("Firebase not initialized");const t=D(O(ya,"campaigns")),a={};e.players&&e.players.forEach(e=>{e.id&&(a[e.id]=!0)}),a[this.currentUser.uid]=!0;const n={...e,id:t.id,participants:a,createdAt:B(),lastActivity:B()};return await I(t,n),t.id}async joinCampaign(e,t){if(!this.currentUser)throw new Error("User not authenticated");const a=O(ya,"campaigns");_(a,U("code","==",e.toUpperCase()));const n=D(O(ya,"campaigns")),r={id:n.id,code:e.toUpperCase(),theme:"Classic Fantasy",background:"fantasy",players:[{...t,id:this.currentUser.uid,lastSeen:B()}],messages:[],systemMessages:[],started:!1,customPrompt:"",isMultiplayer:!0,maxPlayers:6,createdAt:B(),lastActivity:B(),participants:{}};return await I(n,r),n.id}subscribeToCampaign(e,t){if(!this.isFirebaseAvailable)return()=>{};if(this.currentCampaignId===e)return()=>{};if(!ya)return()=>{};this.currentCampaignId=e;const a=D(ya,"campaigns",e),n=H(a,e=>{if(e.exists()){const a={id:e.id,...e.data()};t(a)}},e=>{});return this.unsubscribeFunctions.push(n),n}async sendMessage(e,t){if(!this.isFirebaseAvailable)return;if(!this.currentUser)throw new Error("User not authenticated");if(!ya)throw new Error("Firebase not initialized");const a={...t,id:Date.now().toString(),timestamp:B(),campaignId:e},n=D(ya,"campaigns",e),r=await this.getCampaignMessages(e);await $(n,{messages:[...r,a],lastActivity:B()})}async updatePlayerStatus(e,t,a){if(!this.currentUser)throw new Error("User not authenticated");const n=D(ya,"campaigns",e),r={isOnline:!0,lastSeen:B(),status:t};a&&(r.position=a),await $(n,{[`players.${this.currentUser.uid}`]:r,lastActivity:B()})}async addPlayerToCampaign(e,t){if(!this.currentUser)throw new Error("User not authenticated");const a=D(ya,"campaigns",e),n={...t,id:this.currentUser.uid,lastSeen:B()};await $(a,{[`players.${this.currentUser.uid}`]:n,lastActivity:B()})}async removePlayerFromCampaign(e){if(!this.currentUser)throw new Error("User not authenticated");const t=D(ya,"campaigns",e);await $(t,{[`players.${this.currentUser.uid}`]:null,lastActivity:B()})}async getCampaignMessages(e){var t;const a=D(ya,"campaigns",e);return(null==(t=(await R(a)).data())?void 0:t.messages)||[]}async updateCampaignState(e,t){if(!this.currentUser)throw new Error("User not authenticated");if(!ya)throw new Error("Firebase not initialized");try{const a=D(ya,"campaigns",e);if(!(await R(a)).exists())throw new Error(`Campaign ${e} does not exist in Firestore`);const n={...t,lastActivity:B()};await $(a,n)}catch(a){throw a}}async startCampaign(e){await this.updateCampaignState(e,{started:!0})}async endCampaign(e){await this.updateCampaignState(e,{started:!1})}async updateWorldState(e,t){await this.updateCampaignState(e,{worldState:t})}async updateEnvironment(e,t){await this.updateCampaignState(e,{currentEnvironment:t})}async updateCombatState(e,t){await this.updateCampaignState(e,{combatState:t})}isHost(e){var t;return this.currentUser&&e.players&&Array.isArray(e.players)&&(null==(t=e.players.find(e=>{var t;return e.id===(null==(t=this.currentUser)?void 0:t.uid)}))?void 0:t.isHost)||!1}getCurrentPlayer(e){if(this.currentUser&&e.players&&Array.isArray(e.players))return e.players.find(e=>{var t;return e.id===(null==(t=this.currentUser)?void 0:t.uid)})}getOnlinePlayers(e){return e.players&&Array.isArray(e.players)?e.players.filter(e=>e.isOnline):[]}async getUserCampaigns(){if(!this.isFirebaseAvailable||!this.currentUser)return[];if(!ya)return[];try{const e=O(ya,"campaigns"),t=_(e,U("players","array-contains",{id:this.currentUser.uid})),a=await F(t),n=[];return a.forEach(e=>{n.push({id:e.id,...e.data()})}),n}catch(e){return[]}}async getCampaign(e){if(!this.isFirebaseAvailable)return null;if(!ya)return null;try{const t=D(ya,"campaigns",e),a=await R(t);return a.exists()?{id:a.id,...a.data()}:null}catch(t){return null}}async deleteCampaign(e){if(this.isFirebaseAvailable){if(!this.currentUser)throw new Error("User not authenticated");if(ya)try{const t=await this.getCampaign(e);if(!t)return;if(!this.isHost(t))throw new Error("Only the campaign host can delete the campaign");const a=D(ya,"campaigns",e);await W(a)}catch(t){throw t}}}cleanup(){this.unsubscribeFunctions.forEach(e=>e()),this.unsubscribeFunctions=[],this.currentCampaignId=null,this.listeners.clear()}startHeartbeat(e){if(!this.isFirebaseAvailable)return()=>{};const t=setInterval(async()=>{try{await this.updatePlayerStatus(e,"in-game")}catch(t){}},3e4);return()=>clearInterval(t)}},Gs=e=>"string"!=typeof e?"":e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,"").replace(/<object\b[^<]*(?:(?!<\/object>)<[^<]*)*<\/object>/gi,"").replace(/<embed\b[^<]*(?:(?!<\/embed>)<[^<]*)*<\/embed>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"").replace(/<[^>]*>/g,"").trim(),Js=["badword1","badword2","badword3","spam","scam","hack","crack"];class Ks{constructor(e=5,a=6e4){t(this,"attempts",new Map),this.maxAttempts=e,this.windowMs=a}isAllowed(e){const t=Date.now(),a=this.attempts.get(e);return!a||t>a.resetTime?(this.attempts.set(e,{count:1,resetTime:t+this.windowMs}),!0):!(a.count>=this.maxAttempts||(a.count++,0))}reset(e){this.attempts.delete(e)}getRemainingAttempts(e){const t=this.attempts.get(e);return t?Math.max(0,this.maxAttempts-t.count):this.maxAttempts}getTimeUntilReset(e){const t=this.attempts.get(e);return t?Math.max(0,t.resetTime-Date.now()):0}}const Xs="@firebase/installations",Qs="0.6.9",Zs=`w:${Qs}`,ei="FIS_v2",ti=new h("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function ai(e){return e instanceof m&&e.code.includes("request-failed")}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ni({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function ri(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function si(e,t){const a=(await t.json()).error;return ti.create("request-failed",{requestName:e,serverCode:a.code,serverMessage:a.message,serverStatus:a.status})}function ii({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function oi(e){const t=await e();return t.status>=500&&t.status<600?e():t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function li(e){return new Promise(t=>{setTimeout(t,e)})}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ci=/^[cdef][\w-]{21}$/;function di(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e);return ci.test(t)?t:""}catch(e){return""}}function ui(e){return`${e.appName}!${e.appId}`}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hi=new Map;function mi(e,t){const a=ui(e);pi(a,t),function(e,t){const a=(!gi&&"BroadcastChannel"in self&&(gi=new BroadcastChannel("[Firebase] FID Change"),gi.onmessage=e=>{pi(e.data.key,e.data.fid)}),gi);a&&a.postMessage({key:e,fid:t}),0===hi.size&&gi&&(gi.close(),gi=null)}(a,t)}function pi(e,t){const a=hi.get(e);if(a)for(const n of a)n(t)}let gi=null;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const fi="firebase-installations-store";let xi=null;function yi(){return xi||(xi=p("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(fi)}})),xi}async function bi(e,t){const a=ui(e),n=(await yi()).transaction(fi,"readwrite"),r=n.objectStore(fi),s=await r.get(a);return await r.put(t,a),await n.done,s&&s.fid===t.fid||mi(e,t.fid),t}async function wi(e){const t=ui(e),a=(await yi()).transaction(fi,"readwrite");await a.objectStore(fi).delete(t),await a.done}async function vi(e,t){const a=ui(e),n=(await yi()).transaction(fi,"readwrite"),r=n.objectStore(fi),s=await r.get(a),i=t(s);return void 0===i?await r.delete(a):await r.put(i,a),await n.done,!i||s&&s.fid===i.fid||mi(e,i.fid),i}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ji(e){let t;const a=await vi(e.appConfig,a=>{const n=function(e){return Ci(e||{fid:di(),registrationStatus:0})}(a),r=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(ti.create("app-offline"))};const a={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},n=async function(e,t){try{const a=
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */await async function({appConfig:e,heartbeatServiceProvider:t},{fid:a}){const n=ni(e),r=ii(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const i={fid:a,authVersion:ei,appId:e.appId,sdkVersion:Zs},o={method:"POST",headers:r,body:JSON.stringify(i)},l=await oi(()=>fetch(n,o));if(l.ok){const e=await l.json();return{fid:e.fid||a,registrationStatus:2,refreshToken:e.refreshToken,authToken:ri(e.authToken)}}throw await si("Create Installation",l)}(e,t);return bi(e.appConfig,a)}catch(ko){throw ai(ko)&&409===ko.customData.serverCode?await wi(e.appConfig):await bi(e.appConfig,{fid:t.fid,registrationStatus:0}),ko}}(e,a);return{installationEntry:a,registrationPromise:n}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:Ni(e)}:{installationEntry:t}}(e,n);return t=r.registrationPromise,r.installationEntry});return""===a.fid?{installationEntry:await t}:{installationEntry:a,registrationPromise:t}}async function Ni(e){let t=await ki(e.appConfig);for(;1===t.registrationStatus;)await li(100),t=await ki(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:a}=await ji(e);return a||t}return t}function ki(e){return vi(e,e=>{if(!e)throw ti.create("installation-not-found");return Ci(e)})}function Ci(e){return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}async function Si({appConfig:e,heartbeatServiceProvider:t},a){const n=function(e,{fid:t}){return`${ni(e)}/${t}/authTokens:generate`}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e,a),r=function(e,{refreshToken:t}){const a=ii(e);return a.append("Authorization",function(e){return`${ei} ${e}`}(t)),a}(e,a),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const i={installation:{sdkVersion:Zs,appId:e.appId}},o={method:"POST",headers:r,body:JSON.stringify(i)},l=await oi(()=>fetch(n,o));if(l.ok)return ri(await l.json());throw await si("Generate Auth Token",l)}async function Ai(e,t=!1){let a;const n=await vi(e.appConfig,n=>{if(!Ei(n))throw ti.create("not-registered");const r=n.authToken;if(!t&&(2===(s=r).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(s)))return n;var s;if(1===r.requestStatus)return a=async function(e,t){let a=await Ti(e.appConfig);for(;1===a.authToken.requestStatus;)await li(100),a=await Ti(e.appConfig);const n=a.authToken;return 0===n.requestStatus?Ai(e,t):n}(e,t),n;{if(!navigator.onLine)throw ti.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(n);return a=async function(e,t){try{const a=await Si(e,t),n=Object.assign(Object.assign({},t),{authToken:a});return await bi(e.appConfig,n),a}catch(ko){if(!ai(ko)||401!==ko.customData.serverCode&&404!==ko.customData.serverCode){const a=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await bi(e.appConfig,a)}else await wi(e.appConfig);throw ko}}(e,t),t}});return a?await a:n.authToken}function Ti(e){return vi(e,e=>{if(!Ei(e))throw ti.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */})}function Ei(e){return void 0!==e&&2===e.registrationStatus}function Pi(e){return ti.create("missing-app-config-values",{valueName:e})}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mi="installations";c(new d(Mi,e=>{const t=e.getProvider("app").getImmediate(),a=
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e){if(!e||!e.options)throw Pi("App Configuration");if(!e.name)throw Pi("App Name");const t=["projectId","apiKey","appId"];for(const a of t)if(!e.options[a])throw Pi(a);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:a,heartbeatServiceProvider:u(t,"heartbeat"),_delete:()=>Promise.resolve()}},"PUBLIC")),c(new d("installations-internal",e=>{const t=e.getProvider("app").getImmediate(),a=u(t,Mi).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:a,registrationPromise:n}=await ji(t);return n?n.catch(console.error):Ai(t).catch(console.error),a.fid}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(a),getToken:e=>async function(e,t=!1){const a=e;return await async function(e){const{registrationPromise:t}=await ji(e);t&&await t}(a),(await Ai(a,t)).token}(a,e)}},"PRIVATE")),l(Xs,Qs),l(Xs,Qs,"esm2017");
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Ii="analytics",Di="https://www.googletagmanager.com/gtag/js",Ri=new y("@firebase/analytics"),$i=new h("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Li(e){if(!e.startsWith(Di)){const t=$i.create("invalid-gtag-resource",{gtagURL:e});return Ri.warn(t.message),""}return e}function Oi(e){return Promise.all(e.map(e=>e.catch(e=>e)))}const _i=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function Ui(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function Fi(e,t=_i,a){const{appId:n,apiKey:r,measurementId:s}=e.options;if(!n)throw $i.create("no-app-id");if(!r){if(s)return{measurementId:s,appId:n};throw $i.create("no-api-key")}const i=t.getThrottleMetadata(n)||{backoffCount:0,throttleEndTimeMillis:Date.now()},o=new Wi;return setTimeout(async()=>{o.abort()},void 0!==a?a:6e4),zi({appId:n,apiKey:r,measurementId:s},i,o,t)}async function zi(e,{throttleEndTimeMillis:t,backoffCount:a},n,r=_i){var s;const{appId:i,measurementId:o}=e;try{await function(e,t){return new Promise((a,n)=>{const r=Math.max(t-Date.now(),0),s=setTimeout(a,r);e.addEventListener(()=>{clearTimeout(s),n($i.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}(n,t)}catch(ko){if(o)return Ri.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${null==ko?void 0:ko.message}]`),{appId:i,measurementId:o};throw ko}try{const t=await async function(e){var t;const{appId:a,apiKey:n}=e,r={method:"GET",headers:Ui(n)},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",a),i=await fetch(s,r);if(200!==i.status&&304!==i.status){let e="";try{const a=await i.json();(null===(t=a.error)||void 0===t?void 0:t.message)&&(e=a.error.message)}catch(o){}throw $i.create("config-fetch-failed",{httpStatus:i.status,responseMessage:e})}return i.json()}(e);return r.deleteThrottleMetadata(i),t}catch(ko){const l=ko;if(!function(e){if(!(e instanceof m&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(l)){if(r.deleteThrottleMetadata(i),o)return Ri.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${null==l?void 0:l.message}]`),{appId:i,measurementId:o};throw ko}const c=503===Number(null===(s=null==l?void 0:l.customData)||void 0===s?void 0:s.httpStatus)?w(a,r.intervalMillis,30):w(a,r.intervalMillis),d={throttleEndTimeMillis:Date.now()+c,backoffCount:a+1};return r.setThrottleMetadata(i,d),Ri.debug(`Calling attemptFetch again in ${c} millis`),zi(e,d,n,r)}}class Wi{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Hi(e,t,a,n,r,s,i){var o;const l=Fi(e);l.then(t=>{a[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&Ri.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>Ri.error(e)),t.push(l);const c=
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function(){if(!v())return Ri.warn($i.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await j()}catch(ko){return Ri.warn($i.create("indexeddb-unavailable",{errorInfo:null==ko?void 0:ko.toString()}).message),!1}return!0}().then(e=>e?n.getId():void 0),[d,u]=await Promise.all([l,c]);(function(e){const t=window.document.getElementsByTagName("script");for(const a of Object.values(t))if(a.src&&a.src.includes(Di)&&a.src.includes(e))return a;return null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */)(s)||function(e,t){const a=function(e,t){let a;return window.trustedTypes&&(a=window.trustedTypes.createPolicy("firebase-js-sdk-policy",t)),a}(0,{createScriptURL:Li}),n=document.createElement("script"),r=`${Di}?l=${e}&id=${t}`;n.src=a?null==a?void 0:a.createScriptURL(r):r,n.async=!0,document.head.appendChild(n)}(s,d.measurementId),r("js",new Date);const h=null!==(o=null==i?void 0:i.config)&&void 0!==o?o:{};return h.origin="firebase",h.update=!0,null!=u&&(h.firebase_id=u),r("config",d.measurementId,h),d.measurementId}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bi=class{constructor(e){this.app=e}_delete(){return delete qi[this.app.options.appId],Promise.resolve()}},qi={},Vi=[];const Yi={};let Gi,Ji,Ki="dataLayer",Xi=!1;function Qi(e,t,a){!function(){const e=[];if(b()&&e.push("This is a browser extension environment."),N()||e.push("Cookies are not available."),e.length>0){const t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),a=$i.create("invalid-analytics-context",{errorInfo:t});Ri.warn(a.message)}}();const n=e.options.appId;if(!n)throw $i.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw $i.create("no-api-key");Ri.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=qi[n])throw $i.create("already-exists",{id:n});if(!Xi){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(Ki);const{wrappedGtag:e,gtagCore:t}=function(e,t,a,n,r){let s=function(...e){window[n].push(arguments)};return window[r]&&"function"==typeof window[r]&&(s=window[r]),window[r]=function(e,t,a,n){return async function(r,...s){try{if("event"===r){const[n,r]=s;await async function(e,t,a,n,r){try{let s=[];if(r&&r.send_to){let e=r.send_to;Array.isArray(e)||(e=[e]);const n=await Oi(a);for(const a of e){const e=n.find(e=>e.measurementId===a),r=e&&t[e.appId];if(!r){s=[];break}s.push(r)}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",n,r||{})}catch(ko){Ri.error(ko)}}(e,t,a,n,r)}else if("config"===r){const[r,i]=s;await async function(e,t,a,n,r,s){const i=n[r];try{if(i)await t[i];else{const e=(await Oi(a)).find(e=>e.measurementId===r);e&&await t[e.appId]}}catch(ko){Ri.error(ko)}e("config",r,s)}(e,t,a,n,r,i)}else if("consent"===r){const[t,a]=s;e("consent",t,a)}else if("get"===r){const[t,a,n]=s;e("get",t,a,n)}else if("set"===r){const[t]=s;e("set",t)}else e(r,...s)}catch(ko){Ri.error(ko)}}}(s,e,t,a),{gtagCore:s,wrappedGtag:window[r]}}(qi,Vi,Yi,Ki,"gtag");Ji=e,Gi=t,Xi=!0}return qi[n]=Hi(e,Vi,Yi,t,Gi,Ki,a),new Bi(e)}function Zi(e,t,a,n){e=g(e),async function(e,t,a,n,r){if(r&&r.global)e("event",a,n);else{const r=await t;e("event",a,Object.assign(Object.assign({},n),{send_to:r}))}}(Ji,qi[e.app.options.appId],t,a,n).catch(e=>Ri.error(e))}const eo="@firebase/analytics",to="0.10.8";c(new d(Ii,(e,{options:t})=>Qi(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),c(new d("analytics-internal",function(e){try{const t=e.getProvider(Ii).getImmediate();return{logEvent:(e,a,n)=>Zi(t,e,a,n)}}catch(ko){throw $i.create("interop-component-reg-failed",{reason:ko})}},"PRIVATE")),l(eo,to),l(eo,to,"esm2017");const ao=o({apiKey:"AIzaSyAVJvau3Hit06q1pNYCTOF-pVuutmk4oNQ",authDomain:"mythseekers-rpg.firebaseapp.com",databaseURL:"https://mythseekers-rpg-default-rtdb.firebaseio.com",projectId:"mythseekers-rpg",storageBucket:"mythseekers-rpg.firebasestorage.app",messagingSenderId:"659018227506",appId:"1:659018227506:web:82425e7adaf80c2e3c412b",measurementId:"G-E3T1V81ZX3"}),no=new class{constructor(){t(this,"analytics",null),t(this,"isInitialized",!1),this.initializeAnalytics()}initializeAnalytics(){try{"undefined"!=typeof window&&ao&&(this.analytics=function(e=f()){e=g(e);const t=u(e,Ii);return t.isInitialized()?t.getImmediate():function(e,t={}){const a=u(e,Ii);if(a.isInitialized()){const e=a.getImmediate();if(x(t,a.getOptions()))return e;throw $i.create("already-initialized")}return a.initialize({options:t})}(e)}(ao),this.isInitialized=!0)}catch(e){}}setUserId(e){if(this.analytics&&this.isInitialized)try{t=this.analytics,a=e,t=g(t),async function(e,t,a,n){if(n&&n.global)return e("set",{user_id:a}),Promise.resolve();e("config",await t,{update:!0,user_id:a})}(Ji,qi[t.app.options.appId],a,n).catch(e=>Ri.error(e))}catch(r){}var t,a,n}setUserProperties(e){if(this.analytics&&this.isInitialized)try{!function(e,t,a){e=g(e),async function(e,t,a,n){if(n&&n.global){const t={};for(const e of Object.keys(a))t[`user_properties.${e}`]=a[e];return e("set",t),Promise.resolve()}e("config",await t,{update:!0,user_properties:a})}(Ji,qi[e.app.options.appId],t,a).catch(e=>Ri.error(e))}(this.analytics,e)}catch(t){}}trackPageView(e,t){this.logEvent("page_view",{page_name:e,page_title:t||e,timestamp:Date.now()})}trackUserAction(e,t){this.logEvent("user_action",{action:e,...t,timestamp:Date.now()})}trackGameEvent(e,t){this.logEvent("game_event",{event:e,...t,timestamp:Date.now()})}trackPerformance(e,t,a){this.logEvent("performance",{metric:e,value:t,...a,timestamp:Date.now()})}trackError(e,t){this.logEvent("error",{error_message:e.message,error_stack:e.stack,error_name:e.name,...t,timestamp:Date.now()})}trackFeatureUsage(e,t,a){this.logEvent("feature_usage",{feature:e,action:t,...a,timestamp:Date.now()})}trackConversion(e,t,a){this.logEvent("conversion",{conversion_type:e,value:t,currency:a||"USD",timestamp:Date.now()})}trackEngagement(e,t,a){this.logEvent("engagement",{metric:e,value:t,...a,timestamp:Date.now()})}logEvent(e,t){if(this.analytics&&this.isInitialized)try{Zi(this.analytics,e,t)}catch(a){}}trackCoreWebVitals(e,t){this.trackPerformance(`web_vital_${e.toLowerCase()}`,t)}trackBundleLoad(e,t,a){this.trackPerformance("bundle_load",t,{bundle_name:e,bundle_size:a})}trackAPIPerformance(e,t,a){this.trackPerformance("api_response_time",t,{endpoint:e,status_code:a})}trackOnboardingStep(e,t,a){this.trackUserAction("onboarding_step",{step:e,completed:t,time_spent:a})}trackCharacterCreation(e,t){this.trackGameEvent("character_created",{character_class:e,time_spent:t})}trackCampaignEvent(e,t,a){this.trackGameEvent(e,{campaign_id:t,...a})}trackCombatEvent(e,t){this.trackGameEvent(`combat_${e}`,t)}trackAIInteraction(e,t,a){this.trackPerformance("ai_response_time",t,{interaction_type:e,success:a})}trackMultiplayerEvent(e,t){this.trackGameEvent(`multiplayer_${e}`,t)}trackAccessibilityUsage(e,t){this.trackFeatureUsage("accessibility",e,{enabled:t})}trackDeviceInfo(){if("undefined"!=typeof window){const e=navigator.userAgent,t=`${screen.width}x${screen.height}`,a=`${window.innerWidth}x${window.innerHeight}`;this.setUserProperties({device_type:this.getDeviceType(),browser:this.getBrowserInfo(),screen_resolution:t,viewport_size:a,user_agent:e.substring(0,100)})}}getDeviceType(){if("undefined"==typeof window)return"unknown";const e=navigator.userAgent.toLowerCase();return/mobile|android|iphone|ipad|phone/i.test(e)?"mobile":/tablet|ipad/i.test(e)?"tablet":"desktop"}getBrowserInfo(){if("undefined"==typeof window)return"unknown";const e=navigator.userAgent;return e.includes("Chrome")?"chrome":e.includes("Firefox")?"firefox":e.includes("Safari")?"safari":e.includes("Edge")?"edge":"other"}trackSessionStart(){this.trackUserAction("session_start",{session_id:this.generateSessionId(),referrer:document.referrer||"direct"})}trackSessionEnd(e){this.trackUserAction("session_end",{session_duration:e})}generateSessionId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}trackUserPreference(e,t){this.trackUserAction("preference_changed",{preference:e,value:String(t)})}trackSearch(e,t){this.trackUserAction("search",{query:e.substring(0,50),results_count:t})}trackHelpUsage(e,t){this.trackFeatureUsage("help",t,{topic:e})}trackTutorialCompletion(e,t,a){this.trackUserAction("tutorial_completion",{tutorial_name:e,completed:t,steps_completed:a})}};class ro{constructor(){t(this,"state"),this.state={isActive:!1,currentTurn:0,turnOrder:[],currentCombatantIndex:0,combatants:[],battleMap:this.createDefaultBattleMap(),combatLog:[],round:1,lineOfSightCache:{}}}createDefaultBattleMap(){const e=[];for(let t=0;t<8;t++){const a=[];for(let e=0;e<12;e++){let n="floor";0===e||11===e||0===t||7===t?n="wall":Math.random()<.1&&(n="difficult"),a.push({type:n,elevation:0,cover:0,occupied:!1})}e.push(a)}return{width:12,height:8,tiles:e}}startCombat(e,t){const a=this.assignStartingPositions(e,t||this.state.battleMap),n=this.calculateInitiativeOrder(a),r=a.map(e=>({...e,currentActionPoints:{...e.actionPoints},isActive:!1,hasActed:!1}));return this.state={isActive:!0,currentTurn:0,turnOrder:n,currentCombatantIndex:0,combatants:r,battleMap:t||this.state.battleMap,combatLog:[],round:1,lineOfSightCache:{}},this.setActiveCombatant(0),this.getState()}assignStartingPositions(e,t){const a=[...e],n=Math.floor(t.width/2),r=Math.floor(t.height/2);return a.filter(e=>"player"===e.type).forEach((e,t)=>{e.position={x:Math.max(1,n-3+t),y:r}}),a.filter(e=>"enemy"===e.type).forEach((e,a)=>{e.position={x:Math.min(t.width-2,n+3-a),y:r}}),a}calculateInitiativeOrder(e){return e.map(e=>({id:e.id,initiative:this.rollInitiative(e)})).sort((e,t)=>t.initiative-e.initiative).map(e=>e.id)}rollInitiative(e){const t=Math.floor((e.stats.dexterity-10)/2);return Math.floor(20*Math.random())+1+t}getState(){return{...this.state}}getActiveCombatant(){if(!this.state.isActive||0===this.state.turnOrder.length)return null;const e=this.state.turnOrder[this.state.currentCombatantIndex];return this.state.combatants.find(t=>t.id===e)||null}isPlayerTurn(){const e=this.getActiveCombatant();return"player"===(null==e?void 0:e.type)}executeAction(e){const t=this.getActiveCombatant();if(!t)return{success:!1,message:"No active combatant"};switch(e.type){case"move":return this.executeMove(t,e);case"attack":return this.executeAttack(t,e);case"skill":return this.executeSkill(t,e);case"end-turn":return this.endTurn();default:return{success:!1,message:"Unknown action type"}}}executeMove(e,t){if(e.currentActionPoints.move<=0)return{success:!1,message:"No movement points remaining"};if(!t.target||"string"==typeof t.target)return{success:!1,message:"Invalid move target"};const a=t.target.x,n=t.target.y;if(a<0||a>=this.state.battleMap.width||n<0||n>=this.state.battleMap.height)return{success:!1,message:"Target position out of bounds"};const r=this.state.battleMap.tiles[n][a];if("wall"===r.type||r.occupied)return{success:!1,message:"Cannot move to occupied or wall tile"};const s=Math.abs(a-e.position.x)+Math.abs(n-e.position.y),i="difficult"===r.type?2*s:s;if(i>e.currentActionPoints.move)return{success:!1,message:"Not enough movement points"};const o=this.state.combatants.map(t=>t.id===e.id?{...t,position:{x:a,y:n},currentActionPoints:{...t.currentActionPoints,move:t.currentActionPoints.move-i}}:t);return this.state.combatants=o,this.addCombatLog(e.id,"move",`${e.name} moved to (${a}, ${n})`),{success:!0,message:`${e.name} moved to (${a}, ${n})`,newState:this.getState()}}calculateLineOfSight(e,t){const a=`${e.x},${e.y}-${t.x},${t.y}`;if(this.state.lineOfSightCache[a])return this.state.lineOfSightCache[a].has("visible");const n=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y),s=e.x<t.x?1:-1,i=e.y<t.y?1:-1;let o=n-r,l=e.x,c=e.y;for(;l!==t.x||c!==t.y;){if(l>=0&&l<this.state.battleMap.width&&c>=0&&c<this.state.battleMap.height){const e=this.state.battleMap.tiles[c][l];if("wall"===e.type||e.cover>=3)return this.state.lineOfSightCache[a]=new Set(["blocked"]),!1}const e=2*o;e>-r&&(o-=r,l+=s),e<n&&(o+=n,c+=i)}return this.state.lineOfSightCache[a]=new Set(["visible"]),!0}getVisibleTargets(e){return this.state.combatants.filter(t=>!(t.id===e.id||t.health<=0)&&this.calculateLineOfSight(e.position,t.position))}calculateFlankingBonus(e,t){const a=this.state.combatants.filter(t=>t.type===e.type&&t.id!==e.id&&t.health>0);for(const n of a){const a=Math.abs(n.position.x-t.position.x)+Math.abs(n.position.y-t.position.y),r=Math.abs(e.position.x-t.position.x)+Math.abs(e.position.y-t.position.y);if(a<=1&&r<=1){const a=n.position.x-t.position.x,r=n.position.y-t.position.y,s=e.position.x-t.position.x,i=e.position.y-t.position.y;if((a*s<0||r*i<0)&&(0!==a||0!==s)&&(0!==r||0!==i))return 2}}return 0}getEnemyAIAction(e){const t=this.getVisibleTargets(e);if(0===t.length)return this.getMovementTowardsPlayers(e);const a={personality:"aggressive",preferredRange:"melee",targetPriority:"closest",retreatThreshold:.3,flankingBonus:!0};if(e.health/e.maxHealth<a.retreatThreshold)return this.getRetreatAction(e);const n=this.selectTarget(t,a.targetPriority,e);switch(a.personality){case"aggressive":default:return this.getAggressiveAction(e,n,a);case"defensive":return this.getDefensiveAction(e,n,a);case"tactical":return this.getTacticalAction(e,n,a);case"cowardly":return this.getCowardlyAction(e,n,a)}}selectTarget(e,t,a){switch(t){case"weakest":return e.reduce((e,t)=>t.health<e.health?t:e);case"strongest":return e.reduce((e,t)=>t.health>e.health?t:e);case"closest":return e.reduce((e,t)=>{const n=Math.abs(e.position.x-a.position.x)+Math.abs(e.position.y-a.position.y);return Math.abs(t.position.x-a.position.x)+Math.abs(t.position.y-a.position.y)<n?t:e});case"threat":return e.reduce((e,t)=>2*(t.maxHealth-t.health)+t.stats.strength>2*(e.maxHealth-e.health)+e.stats.strength?t:e);default:return e[0]}}getAggressiveAction(e,t,a){if(Math.abs(t.position.x-e.position.x)+Math.abs(t.position.y-e.position.y)<=e.reach&&e.currentActionPoints.action>0)return{type:"attack",target:t.position};if(e.currentActionPoints.move>0){const a=this.findPathToTarget(e,t);if(a.length>1)return{type:"move",target:a[1],path:a}}return{type:"end-turn"}}getDefensiveAction(e,t,a){const n=Math.abs(t.position.x-e.position.x)+Math.abs(t.position.y-e.position.y);if(n<=1&&e.currentActionPoints.move>0){const a=this.findRetreatPosition(e,t);if(a)return{type:"move",target:a}}else if(n<=e.reach&&e.currentActionPoints.action>0)return{type:"attack",target:t.position};return{type:"end-turn"}}getTacticalAction(e,t,a){if(this.calculateFlankingBonus(e,t)>0&&e.currentActionPoints.action>0)return{type:"attack",target:t.position};const n=this.findTacticalPosition(e,t);return n&&e.currentActionPoints.move>0?{type:"move",target:n}:this.getAggressiveAction(e,t,a)}getCowardlyAction(e,t,a){if(Math.abs(t.position.x-e.position.x)+Math.abs(t.position.y-e.position.y)<=2){const a=this.findRetreatPosition(e,t);if(a&&e.currentActionPoints.move>0)return{type:"move",target:a}}return t.health/t.maxHealth<.3&&e.currentActionPoints.action>0?{type:"attack",target:t.position}:{type:"end-turn"}}findPathToTarget(e,t){const a=[{x:e.position.x,y:e.position.y,g:0,h:0,f:0,parent:null}],n=new Set,r=new Map,s=new Map,i=new Map;for(s.set(`${e.position.x},${e.position.y}`,0),i.set(`${e.position.x},${e.position.y}`,this.heuristic(e.position,t.position));a.length>0;){a.sort((e,t)=>e.f-t.f);const o=a.shift(),l=`${o.x},${o.y}`;if(o.x===t.position.x&&o.y===t.position.y){const t=[];let a={x:o.x,y:o.y};for(;r.has(`${a.x},${a.y}`);)t.unshift(a),a=r.get(`${a.x},${a.y}`);return t.unshift({x:e.position.x,y:e.position.y}),t}n.add(l);const c=[{dx:-1,dy:0},{dx:1,dy:0},{dx:0,dy:-1},{dx:0,dy:1}];for(const e of c){const c={x:o.x+e.dx,y:o.y+e.dy},d=`${c.x},${c.y}`;if(c.x<0||c.x>=this.state.battleMap.width||c.y<0||c.y>=this.state.battleMap.height||n.has(d))continue;const u=this.state.battleMap.tiles[c.y][c.x];if("wall"===u.type||u.occupied)continue;const h=s.get(l)+("difficult"===u.type?2:1);(!s.has(d)||h<s.get(d))&&(r.set(d,{x:o.x,y:o.y}),s.set(d,h),i.set(d,h+this.heuristic(c,t.position)),a.find(e=>e.x===c.x&&e.y===c.y)||a.push({x:c.x,y:c.y,g:h,h:this.heuristic(c,t.position),f:h+this.heuristic(c,t.position),parent:null}))}}return[{x:e.position.x,y:e.position.y}]}heuristic(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}findRetreatPosition(e,t){const a=[{dx:-1,dy:0},{dx:1,dy:0},{dx:0,dy:-1},{dx:0,dy:1}];for(const n of a){const a=e.position.x+n.dx,r=e.position.y+n.dy;if(a>=0&&a<this.state.battleMap.width&&r>=0&&r<this.state.battleMap.height){const e=this.state.battleMap.tiles[r][a];if("wall"!==e.type&&!e.occupied&&Math.abs(a-t.position.x)+Math.abs(r-t.position.y)>1)return{x:a,y:r}}}return null}findTacticalPosition(e,t){const a=[{dx:-1,dy:0},{dx:1,dy:0},{dx:0,dy:-1},{dx:0,dy:1}];for(const n of a){const a=e.position.x+n.dx,r=e.position.y+n.dy;if(a>=0&&a<this.state.battleMap.width&&r>=0&&r<this.state.battleMap.height){const n=this.state.battleMap.tiles[r][a];if("wall"!==n.type&&!n.occupied){const s={x:a,y:r};if(this.calculateFlankingBonus({...e,position:s},t)>0||n.cover>0)return s}}}return null}getMovementTowardsPlayers(e){const t=this.state.combatants.filter(e=>"player"===e.type&&e.health>0);if(0===t.length)return{type:"end-turn"};const a=t.reduce((t,a)=>{const n=Math.abs(t.position.x-e.position.x)+Math.abs(t.position.y-e.position.y);return Math.abs(a.position.x-e.position.x)+Math.abs(a.position.y-e.position.y)<n?a:t}),n=this.findPathToTarget(e,a);return n.length>1&&e.currentActionPoints.move>0?{type:"move",target:n[1],path:n}:{type:"end-turn"}}executeAttack(e,t){if(e.currentActionPoints.action<=0)return{success:!1,message:"No action points remaining"};if(!t.target||"string"==typeof t.target)return{success:!1,message:"Invalid attack target"};const a=t.target.x,n=t.target.y,r=this.state.combatants.find(t=>t.position.x===a&&t.position.y===n&&t.id!==e.id);if(!r)return{success:!1,message:"No target at specified position"};if(!this.calculateLineOfSight(e.position,r.position))return{success:!1,message:"Target not in line of sight"};if(Math.abs(a-e.position.x)+Math.abs(n-e.position.y)>e.reach)return{success:!1,message:"Target out of range"};const s=Math.floor(20*Math.random())+1,i=Math.floor((e.stats.strength-10)/2),o=this.calculateFlankingBonus(e,r);if(s+i+o>=r.stats.armorClass){const t=this.calculateDamage(e),a=this.state.combatants.map(e=>{if(e.id===r.id){const a=Math.max(0,e.health-t);return{...e,health:a}}return e});this.state.combatants=a;const n=o>0?" (flanking!)":"";this.addCombatLog(e.id,"attack",`${e.name} hit ${r.name} for ${t} damage${n}`),r.health-t<=0&&this.addCombatLog(r.id,"defeat",`${r.name} was defeated!`);const s=this.state.combatants.find(t=>t.id===e.id);return s&&s.currentActionPoints.action--,{success:!0,message:`${e.name} hit ${r.name} for ${t} damage${n}`,newState:this.getState()}}{this.addCombatLog(e.id,"attack",`${e.name} missed ${r.name}`);const t=this.state.combatants.find(t=>t.id===e.id);return t&&t.currentActionPoints.action--,{success:!0,message:`${e.name} missed ${r.name}`,newState:this.getState()}}}executeSkill(e,t){if(e.currentActionPoints.action<=0)return{success:!1,message:"No action points remaining"};if(!t.skillId)return{success:!1,message:"No skill specified"};const a=e.skills[t.skillId];if(!a)return{success:!1,message:"Skill not found"};this.addCombatLog(e.id,"skill",`${e.name} used ${a.name}`);const n=this.state.combatants.find(t=>t.id===e.id);return n&&n.currentActionPoints.action--,{success:!0,message:`${e.name} used ${a.name}`,newState:this.getState()}}endTurn(){var e;const t=this.getActiveCombatant();if(!t)return{success:!1,message:"No active combatant"};const a=this.state.combatants.map(e=>e.id===t.id?{...e,hasActed:!0}:e);return this.state.combatants=a,this.addCombatLog(t.id,"end-turn",`${t.name} ended their turn`),this.state.currentCombatantIndex=(this.state.currentCombatantIndex+1)%this.state.turnOrder.length,0===this.state.currentCombatantIndex&&(this.state.round++,this.startNewRound()),this.setActiveCombatant(this.state.currentCombatantIndex),{success:!0,message:`Turn ended. Next: ${(null==(e=this.getActiveCombatant())?void 0:e.name)||"Unknown"}`,newState:this.getState()}}startNewRound(){this.state.combatants=this.state.combatants.map(e=>({...e,currentActionPoints:{...e.actionPoints},hasActed:!1})),this.addCombatLog("system","round",`Round ${this.state.round} begins!`)}setActiveCombatant(e){this.state.combatants=this.state.combatants.map(e=>({...e,isActive:!1}));const t=this.state.turnOrder[e],a=this.state.combatants.find(e=>e.id===t);a&&(a.isActive=!0)}calculateDamage(e){const t=Math.floor((e.stats.strength-10)/2);return Math.max(1,Math.floor(6*Math.random())+1+t)}addCombatLog(e,t,a){const n={id:Date.now().toString(),turn:this.state.currentTurn,combatantId:e,action:t,result:a,timestamp:Date.now()};this.state.combatLog.push(n)}endCombat(){return this.state.isActive=!1,this.getState()}checkCombatEnd(){const e=this.state.combatants.filter(e=>"player"===e.type),t=this.state.combatants.filter(e=>"enemy"===e.type),a=e.filter(e=>e.health>0),n=t.filter(e=>e.health>0);return 0===a.length?{ended:!0,winner:"enemies"}:0===n.length?{ended:!0,winner:"players"}:{ended:!1}}executeAITurn(){const e=this.getActiveCombatant();if(!e||"enemy"!==e.type)return{success:!1,message:"No enemy combatant active"};const t=this.getEnemyAIAction(e);return t?this.executeAction(t):this.endTurn()}}const so=a.lazy(()=>Ie(()=>import("./NavBar-f7847767.js"),["assets/NavBar-f7847767.js","assets/ui-vendor-ea82f2ea.js","assets/react-vendor-132e4a4f.js","assets/firebase-core-8eeeb07d.js","assets/firebase-auth-1430596a.js","assets/firebase-firestore-534e8e51.js","assets/firebase-database-c7b0c40e.js","assets/firebase-functions-a61ddb80.js"])),io=a.lazy(()=>Ie(()=>import("./TopBar-afe8942e.js"),["assets/TopBar-afe8942e.js","assets/ui-vendor-ea82f2ea.js","assets/react-vendor-132e4a4f.js","assets/firebase-core-8eeeb07d.js","assets/firebase-auth-1430596a.js","assets/firebase-firestore-534e8e51.js","assets/firebase-database-c7b0c40e.js","assets/firebase-functions-a61ddb80.js"])),oo=a.lazy(()=>Ie(()=>import("./WelcomeOverlay-33956e2f.js"),["assets/WelcomeOverlay-33956e2f.js","assets/react-vendor-132e4a4f.js","assets/ui-vendor-ea82f2ea.js","assets/firebase-core-8eeeb07d.js","assets/firebase-auth-1430596a.js","assets/firebase-firestore-534e8e51.js","assets/firebase-database-c7b0c40e.js","assets/firebase-functions-a61ddb80.js"])),lo=a.lazy(()=>Ie(()=>import("./CombatSystem-562e60aa.js"),["assets/CombatSystem-562e60aa.js","assets/react-vendor-132e4a4f.js","assets/ui-vendor-ea82f2ea.js","assets/firebase-core-8eeeb07d.js","assets/firebase-auth-1430596a.js","assets/firebase-firestore-534e8e51.js","assets/firebase-database-c7b0c40e.js","assets/firebase-functions-a61ddb80.js"])),co=a.lazy(()=>Ie(()=>import("./RightDrawer-a5d3376c.js"),["assets/RightDrawer-a5d3376c.js","assets/react-vendor-132e4a4f.js","assets/ui-vendor-ea82f2ea.js","assets/firebase-core-8eeeb07d.js","assets/firebase-auth-1430596a.js","assets/firebase-firestore-534e8e51.js","assets/firebase-database-c7b0c40e.js","assets/firebase-functions-a61ddb80.js"])),uo=a.lazy(()=>Ie(()=>import("./FloatingActionButton-67eb8701.js"),["assets/FloatingActionButton-67eb8701.js","assets/react-vendor-132e4a4f.js","assets/ui-vendor-ea82f2ea.js","assets/firebase-core-8eeeb07d.js","assets/firebase-auth-1430596a.js","assets/firebase-firestore-534e8e51.js","assets/firebase-database-c7b0c40e.js","assets/firebase-functions-a61ddb80.js"])),ho=a.lazy(()=>Ie(()=>import("./SimpleHelp-192dc6c0.js"),["assets/SimpleHelp-192dc6c0.js","assets/react-vendor-132e4a4f.js","assets/ui-vendor-ea82f2ea.js","assets/firebase-core-8eeeb07d.js","assets/firebase-auth-1430596a.js","assets/firebase-firestore-534e8e51.js","assets/firebase-database-c7b0c40e.js","assets/firebase-functions-a61ddb80.js"])),mo=a.lazy(()=>Ie(()=>import("./HelpSystem-cb94e200.js"),["assets/HelpSystem-cb94e200.js","assets/react-vendor-132e4a4f.js","assets/ui-vendor-ea82f2ea.js","assets/firebase-core-8eeeb07d.js","assets/firebase-auth-1430596a.js","assets/firebase-firestore-534e8e51.js","assets/firebase-database-c7b0c40e.js","assets/firebase-functions-a61ddb80.js"])),po=a.lazy(()=>Ie(()=>import("./DMCenter-4a07a36d.js"),["assets/DMCenter-4a07a36d.js","assets/react-vendor-132e4a4f.js","assets/ui-vendor-ea82f2ea.js","assets/firebase-core-8eeeb07d.js","assets/firebase-auth-1430596a.js","assets/firebase-firestore-534e8e51.js","assets/firebase-database-c7b0c40e.js","assets/firebase-functions-a61ddb80.js"])),go=({currentScreen:e,currentCampaign:t,character:a,onNavigate:n})=>{const r=(()=>{const a=[{label:"Home",path:"/dashboard",icon:Te.jsx(ne,{size:16})}];switch(e){case"character-select":a.push({label:"Characters",path:"/characters",icon:Te.jsx(ue,{size:16})});break;case"character":a.push({label:"Characters",path:"/characters",icon:Te.jsx(ue,{size:16})}),a.push({label:"Create Character",path:"/characters/create",icon:Te.jsx(me,{size:16})});break;case"lobby":a.push({label:"Campaigns",path:"/campaigns",icon:Te.jsx(he,{size:16})});break;case"waiting":a.push({label:"Campaigns",path:"/campaigns",icon:Te.jsx(he,{size:16})}),t&&a.push({label:t.theme,path:`/campaigns/${t.id}/waiting`,icon:Te.jsx(J,{size:16})});break;case"game":a.push({label:"Campaigns",path:"/campaigns",icon:Te.jsx(he,{size:16})}),t&&a.push({label:t.theme,path:`/campaigns/${t.id}`,icon:Te.jsx(ce,{size:16})});break;case"party":a.push({label:"Party",path:"/party",icon:Te.jsx(J,{size:16})});break;case"world":a.push({label:"World",path:"/world",icon:Te.jsx(ce,{size:16})});break;case"combat":a.push({label:"Combat",path:"/combat",icon:Te.jsx(ee,{size:16})});break;case"magic":a.push({label:"Magic",path:"/magic",icon:Te.jsx(le,{size:16})});break;case"dm-center":a.push({label:"DM Center",path:"/dm-center",icon:Te.jsx(ue,{size:16})});break;case"profile":a.push({label:"Profile",path:"/profile",icon:Te.jsx(ue,{size:16})})}return a})();return Te.jsx("nav",{className:"flex items-center space-x-1 text-sm text-blue-200 mb-4 px-6 pt-4",children:r.map((e,t)=>Te.jsxs(i.Fragment,{children:[t>0&&Te.jsx(fe,{size:14,className:"text-blue-400"}),Te.jsxs("button",{onClick:()=>n(e.path),className:"flex items-center space-x-1 hover:text-white transition-colors "+(t===r.length-1?"text-white font-medium":"hover:underline"),disabled:t===r.length-1,children:[e.icon,Te.jsx("span",{children:e.label})]})]},e.path))})},fo=()=>Te.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-950 via-indigo-950 to-purple-950 flex items-center justify-center",children:Te.jsxs("div",{className:"text-center space-y-4",children:[Te.jsxs("div",{className:"relative",children:[Te.jsx("div",{className:"w-16 h-16 border-4 border-blue-300/30 border-t-blue-400 rounded-full animate-spin mx-auto"}),Te.jsx("div",{className:"w-12 h-12 border-4 border-purple-300/30 border-t-purple-400 rounded-full animate-spin absolute top-2 left-1/2 transform -translate-x-1/2 -rotate-45",style:{animationDuration:"1.5s"}})]}),Te.jsxs("div",{className:"space-y-2",children:[Te.jsx("h3",{className:"text-white font-semibold text-lg",children:"Loading MythSeeker"}),Te.jsx("p",{className:"text-blue-200 text-sm",children:"Preparing your adventure..."})]}),Te.jsxs("div",{className:"flex justify-center space-x-1",children:[Te.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-bounce"}),Te.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),Te.jsx("div",{className:"w-2 h-2 bg-indigo-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})}),xo=({onScreenChange:e,currentScreen:t})=>{Mt();const n=Tt(),r={"/":"welcome","/dashboard":"dashboard","/characters":"character-select","/characters/create":"character","/campaigns":"lobby","/campaigns/:id":"game","/campaigns/:id/waiting":"waiting","/party":"party","/world":"world","/combat":"combat","/magic":"magic","/dm-center":"dm-center","/profile":"profile"};return a.useEffect(()=>{const a=n.pathname;let s="dashboard";r[a]?s=r[a]:a.includes("/campaigns/")&&a.endsWith("/waiting")?s="waiting":a.includes("/campaigns/")&&"/campaigns"!==a&&(s="game"),s!==t&&e(s)},[n.pathname,t,e]),null},yo=()=>{const e=i.useMemo(()=>new ro,[]),[t,n]=a.useState(null),[r,s]=a.useState([]),[o,l]=a.useState(!1),[c,d]=a.useState(!1),[u,h]=a.useState("welcome"),[m,p]=a.useState(null),[g,f]=a.useState([]),[x,y]=a.useState(!0),[b,w]=a.useState(!1);a.useState(!1);const[v,j]=a.useState("dashboard");a.useState("gameplay");const[N,k]=a.useState(!1),[C,S]=a.useState(!1),[A,T]=a.useState(!1),[E,P]=a.useState("welcome"),[M,I]=a.useState(""),[D,R]=a.useState(null),[$,L]=a.useState(null),[O,_]=a.useState([]),[U,F]=a.useState([]),[z,W]=a.useState(""),[H,B]=a.useState(!1),[q,V]=a.useState("default");a.useState({});const[Y,K]=a.useState(null),[X,Q]=a.useState("");a.useState(null),a.useState(null);const[Z,ee]=a.useState(null);a.useState([]),a.useState(null),a.useState(null),a.useState(null),a.useState(null),a.useState({});const[te,ae]=a.useState({locations:{},npcs:{},factions:{},events:[],weather:"clear",timeOfDay:"day",currentLocation:null,playerReputation:{},discoveredSecrets:[],activeQuests:[],completedQuests:[],worldEvents:[]}),[ne,re]=a.useState({ruleSystem:"dnd5e",contentLibrary:{encounters:[],npcs:[],locations:[],plotHooks:[],customRules:[]},campaignTemplates:[],dmTools:{initiativeTracker:[],sessionNotes:"",playerAnalytics:{}}});a.useState(!1),a.useState([]);const[se,ie]=a.useState([]);a.useState(!1);const oe=a.useRef(null),me=a.useRef(null),[pe,ge]=a.useState(!1),[fe,xe]=a.useState({players:[],isHost:!1,lastSync:null}),[ye,be]=a.useState("chat"),[we,ve]=a.useState({playerActions:[],npcInteractions:{},combatHistory:[],explorationHistory:[],playerPreferences:{},storyThreads:[],consequences:[]}),[je,Ne]=a.useState(400),ke=e=>{Ce(e)},Ce=(e,t)=>{const a=(e=>{const t=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,a={characterCreated:{message:"Character created successfully!",type:"success"},campaignCreated:{message:"Campaign created successfully!",type:"success"},campaignPaused:{message:"Campaign paused",type:"info"},campaignResumed:{message:"Campaign resumed",type:"success"},welcomeBack:{message:"Welcome back to your adventure!",type:"success"},ftueSkipped:{message:"Tutorial skipped",type:"info"}}[e]||{message:"Action completed",type:"success"};return{id:t,message:a.message,type:a.type}})(e);s(e=>[...e,a]),setTimeout(()=>Se(a.id),5e3),"characterCreated"===e?ke("character"):"campaignCreated"===e?ke("campaign"):"campaignPaused"===e?ke("pause"):"campaignResumed"===e&&ke("resume")},Se=e=>{s(t=>t.filter(t=>t.id!==e))};a.useEffect(()=>{Y||K(Date.now().toString(36)+Math.random().toString(36).substr(2))},[Y]),a.useEffect(()=>{no.trackSessionStart(),no.trackDeviceInfo(),no.trackPageView("welcome","MythSeeker - Welcome");const e=performance.now(),t=()=>{const t=performance.now()-e;no.trackPerformance("app_load_time",t)};"complete"===document.readyState?t():window.addEventListener("load",t);const a=()=>{const t=Date.now()-e;no.trackSessionEnd(t)};window.addEventListener("beforeunload",a);const n=ba.onAuthStateChange(async e=>{var t;if(e)try{await new Promise(e=>setTimeout(e,500)),no.trackUserAction("user_authenticated",{user_id:e.uid,display_name:e.displayName}),no.setUserId(e.uid),no.setUserProperties({user_type:e.displayName?"authenticated":"anonymous",account_created:(null==(t=e.metadata)?void 0:t.creationTime)||"unknown"});let n=0,r=null;for(;n<3&&!r;)try{r=await ba.getUserProfile(e.uid);break}catch(a){n++,n<3&&await new Promise(e=>setTimeout(e,1e3*n))}if(r){p(r),I(r.displayName),w(!0);let t=[];for(n=0;n<3;)try{t=await ba.getUserCharacters(e.uid);break}catch(a){n++,n<3&&await new Promise(e=>setTimeout(e,1e3*n))}f(t),no.trackUserAction("profile_loaded",{characters_count:t.length,has_characters:t.length>0}),t.length>0?(P("character-select"),Ee("/characters"),no.trackPageView("character-select","MythSeeker - Character Selection")):(P("welcome"),Ee("/"),no.trackPageView("welcome","MythSeeker - Welcome"))}else P("welcome"),no.trackPageView("welcome","MythSeeker - Welcome")}catch(n){const e=JSON.parse(localStorage.getItem("mythseeker_characters")||"[]");e.length>0?(f(e),P("character-select"),no.trackPageView("character-select","MythSeeker - Character Selection")):(P("welcome"),no.trackPageView("welcome","MythSeeker - Welcome")),p(null),w(!1)}else{no.trackUserAction("user_signed_out");const e=JSON.parse(localStorage.getItem("mythseeker_characters")||"[]");e.length>0?(f(e),P("character-select"),no.trackPageView("character-select","MythSeeker - Character Selection")):(P("welcome"),no.trackPageView("welcome","MythSeeker - Welcome")),p(null),w(!1)}y(!1)});return()=>{window.removeEventListener("load",t),window.removeEventListener("beforeunload",a),n()}},[]),a.useEffect(()=>{(async()=>{try{await ba.handleRedirectSignIn()}catch(e){Ce("error")}})()},[]),a.useEffect(()=>{"undefined"==typeof window||window.claude||(window.claude={complete:e=>Na.complete(e)})},[]);const Ae=async()=>{try{y(!0),await ba.signInWithGoogle(),Ce("welcome",{message:"Welcome to MythSeeker!"})}catch(e){"auth/popup-blocked"===e.code?Ce("error"):"auth/popup-closed-by-user"===e.code?(Ce("info"),y(!1)):("auth/cancelled-popup-request"===e.code||Ce("error"),y(!1))}};a.useEffect(()=>{const e=()=>{T(window.innerWidth<1024)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),a.useEffect(()=>{if(null==$?void 0:$.id){const e=Ys.subscribeToCampaign($.id,e=>{L(e),F(e.messages||[]),xe({players:e.players||[],isHost:Ys.isHost(e),lastSync:new Date}),ge(!0)}),t=Ys.startHeartbeat($.id);return()=>{e(),t()}}},[null==$?void 0:$.id]),a.useEffect(()=>{var e;null==(e=oe.current)||e.scrollIntoView({behavior:"smooth"})},[U]),a.useEffect(()=>{!H&&me.current&&me.current.focus()},[H]);const Ee=Mt(),Pe=e=>{j(e);const t={dashboard:{screen:"dashboard",path:"/dashboard"},campaigns:{screen:"lobby",path:"/campaigns"},characters:{screen:"character-select",path:"/characters"},party:{screen:"party",path:"/party"},world:{screen:"world",path:"/world"},combat:{screen:"combat",path:"/combat"},magic:{screen:"magic",path:"/magic"},"dm-center":{screen:"dm-center",path:"/dm-center"}},a=t[e]||t.dashboard;P(a.screen),Ee(a.path),no.trackUserAction("navigation",{from:E,to:a.screen})},Me=e=>{Ee(e)},Ie=()=>{j("campaigns"),P("lobby")},De=async e=>{if(e.trim()&&(null==$?void 0:$.id))try{await Ys.sendMessage($.id,{type:"player",content:e,character:null==D?void 0:D.name,playerId:Y,playerName:M}),ke("messageSent")}catch(t){}},Re=async e=>{if(null==e?void 0:e.id)try{const a=JSON.parse(localStorage.getItem("mythseeker_campaigns")||"[]"),n=a.findIndex(t=>t.id===e.id);if(n>=0?a[n]=e:a.push(e),localStorage.setItem("mythseeker_campaigns",JSON.stringify(a)),_(t=>t.map(t=>t.id===e.id?e:t)),e.isMultiplayer&&b&&m)try{await Ys.updateCampaignState(e.id,{messages:e.messages||[],systemMessages:e.systemMessages||[],started:e.started,worldState:e.worldState,currentEnvironment:e.currentEnvironment,combatState:e.combatState,lastActivity:new Date})}catch(t){}}catch(a){try{const t=JSON.parse(localStorage.getItem("mythseeker_campaigns")||"[]"),a=t.findIndex(t=>t.id===e.id);a>=0?t[a]=e:t.push(e),localStorage.setItem("mythseeker_campaigns",JSON.stringify(t))}catch(n){}}};a.useEffect(()=>{if($&&$.started){const e=setTimeout(()=>{Re($)},3e4);return()=>clearTimeout(e)}},[$]),a.useEffect(()=>{(async()=>{try{const t=JSON.parse(localStorage.getItem("mythseeker_campaigns")||"[]"),a=t.map(e=>({...e,status:e.status||(e.started?"active":void 0)}));if(_(a),b&&m)try{const e=await Ys.getUserCampaigns(),a=t.map(t=>e.find(e=>e.id===t.id)||t);e.forEach(e=>{a.find(t=>t.id===e.id)||a.push(e)}),_(a),localStorage.setItem("mythseeker_campaigns",JSON.stringify(a))}catch(e){}}catch(t){_([])}})()},[D,b]),a.useEffect(()=>{const e=JSON.parse(localStorage.getItem("mythseeker_campaigns")||"[]");e.length>0&&_(e)},[]),a.useEffect(()=>{if($&&U.length>0){const e={...$,messages:U};Re(e)}},[U]);const $e=[{name:"Warrior",icon:"âš”ï¸",stats:{strength:16,dexterity:12,intelligence:10,charisma:8},actionPoints:{move:6,action:1,bonus:1,reaction:1},reach:1,skills:{1:{name:"Power Strike",description:"Deal +50% damage on next attack",cost:"Action",type:"attack",range:1},3:{name:"Shield Wall",description:"Reduce all damage by 3 for 3 turns",cost:"Action",type:"defense",range:0},5:{name:"Berserker Rage",description:"Double damage but take +50% damage for 3 turns",cost:"Bonus Action",type:"buff",range:0},7:{name:"Intimidating Shout",description:"Fear nearby enemies for 2 turns",cost:"Action",type:"control",range:3,aoe:!0},10:{name:"Legendary Strike",description:"Guaranteed critical hit",cost:"Action",type:"attack",range:1}}},{name:"Rogue",icon:"ðŸ—¡ï¸",stats:{strength:10,dexterity:16,intelligence:12,charisma:8},actionPoints:{move:8,action:1,bonus:1,reaction:1},reach:1,skills:{1:{name:"Sneak Attack",description:"Deal double damage if target is unaware",cost:"Free",type:"attack",range:1},3:{name:"Shadow Step",description:"Teleport behind enemy and gain advantage",cost:"Movement",type:"movement",range:6},5:{name:"Poison Blade",description:"Next 3 attacks apply poison (3 damage/turn)",cost:"Bonus Action",type:"buff",range:0},7:{name:"Smoke Bomb",description:"Become invisible for 2 turns",cost:"Action",type:"stealth",range:0,aoe:!0,radius:2},10:{name:"Assassinate",description:"Instant kill if target below 25% health",cost:"Action",type:"attack",range:1}}},{name:"Mage",icon:"ðŸ”®",stats:{strength:8,dexterity:10,intelligence:16,charisma:12},actionPoints:{move:5,action:1,bonus:1,reaction:1},reach:1,skills:{1:{name:"Magic Missile",description:"Deal 1d4+1 force damage, never misses",cost:"1 Spell Slot",type:"attack",range:8},3:{name:"Shield Spell",description:"Gain +5 AC until start of next turn",cost:"Reaction",type:"defense",range:0},5:{name:"Fireball",description:"Deal 3d6 fire damage in large area",cost:"1 Spell Slot",type:"aoe",range:10,radius:3},7:{name:"Counterspell",description:"Cancel enemy spell or ability",cost:"Reaction",type:"control",range:8},10:{name:"Meteor Storm",description:"Devastate entire battlefield",cost:"2 Spell Slots",type:"aoe",range:15,radius:5}}},{name:"Cleric",icon:"âš¡",stats:{strength:12,dexterity:8,intelligence:12,charisma:16},actionPoints:{move:5,action:1,bonus:1,reaction:1},reach:1,skills:{1:{name:"Healing Word",description:"Restore 1d4+CHA mod HP to ally",cost:"1 Spell Slot",type:"heal",range:8},3:{name:"Turn Undead",description:"Force undead creatures to flee",cost:"Action",type:"control",range:6,aoe:!0},5:{name:"Sacred Flame",description:"Divine damage that ignores armor",cost:"1 Spell Slot",type:"attack",range:8},7:{name:"Mass Healing",description:"Heal all allies for 2d4+CHA",cost:"2 Spell Slots",type:"heal",range:6,aoe:!0},10:{name:"Divine Intervention",description:"Call upon divine aid in dire situations",cost:"3 Spell Slots",type:"special",range:0}}},{name:"Ranger",icon:"ðŸ¹",stats:{strength:14,dexterity:14,intelligence:10,charisma:8},actionPoints:{move:7,action:1,bonus:1,reaction:1},reach:10,skills:{1:{name:"Hunter's Mark",description:"Mark target for +1d6 damage on attacks",cost:"Bonus Action",type:"buff",range:10},3:{name:"Multi-Shot",description:"Attack up to 3 enemies with ranged weapon",cost:"Action",type:"attack",range:10},5:{name:"Animal Companion",description:"Summon beast ally for entire combat",cost:"Action",type:"summon",range:3},7:{name:"Explosive Shot",description:"Ranged attack that damages nearby enemies",cost:"Action",type:"aoe",range:10,radius:2},10:{name:"Rain of Arrows",description:"Attack all enemies in large area",cost:"Action",type:"aoe",range:12,radius:4}}},{name:"Bard",icon:"ðŸŽµ",stats:{strength:8,dexterity:12,intelligence:10,charisma:16},actionPoints:{move:6,action:1,bonus:1,reaction:1},reach:1,skills:{1:{name:"Inspiration",description:"Give ally advantage on next roll",cost:"Bonus Action",type:"support",range:6},3:{name:"Cutting Words",description:"Reduce enemy attack/damage by 1d6",cost:"Reaction",type:"debuff",range:6},5:{name:"Song of Rest",description:"Party heals +1d6 HP during short rest",cost:"Short Rest",type:"heal",range:0},7:{name:"Mass Suggestion",description:"Control multiple enemies for 1 turn",cost:"Action",type:"control",range:8,aoe:!0},10:{name:"Power Word Kill",description:"Instantly kill enemy below 100 HP",cost:"Action",type:"attack",range:8}}}],Le=[{name:"Classic Fantasy",description:"Dragons, magic, and heroic quests in a medieval world",icon:"ðŸ°",bg:"fantasy"},{name:"Sci-Fi Adventure",description:"Space exploration, alien encounters, and futuristic technology",icon:"ðŸš€",bg:"scifi"},{name:"Horror Mystery",description:"Dark secrets, supernatural threats, and psychological tension",icon:"ðŸ‘»",bg:"horror"},{name:"Urban Fantasy",description:"Magic hidden in the modern world, supernatural creatures in cities",icon:"ðŸŒƒ",bg:"urban"},{name:"Post-Apocalyptic",description:"Surviving in a world after civilization has collapsed",icon:"â˜¢ï¸",bg:"apocalypse"},{name:"Pirate Adventure",description:"High seas, treasure hunting, and swashbuckling action",icon:"ðŸ´â€â˜ ï¸",bg:"pirate"}],Oe={default:"from-purple-900 via-blue-900 to-indigo-900",fantasy:"from-emerald-900 via-green-800 to-teal-900",dungeon:"from-gray-900 via-slate-800 to-stone-900",forest:"from-green-900 via-emerald-800 to-lime-900",tavern:"from-amber-900 via-orange-800 to-yellow-900",scifi:"from-cyan-900 via-blue-800 to-indigo-900",horror:"from-red-900 via-purple-900 to-black",urban:"from-slate-900 via-gray-800 to-zinc-900",apocalypse:"from-orange-900 via-red-800 to-yellow-900",pirate:"from-blue-900 via-teal-800 to-cyan-900"},_e=[{id:"first_steps",name:"First Steps",description:"Start your first adventure",points:5},{id:"dungeon_delver",name:"Dungeon Delver",description:"Explore 5 different dungeons",points:30},{id:"world_traveler",name:"World Traveler",description:"Visit 10 different locations",points:75},{id:"master_explorer",name:"Master Explorer",description:"Discover all secret areas",points:200}],Ue=e=>{const t=$e.find(t=>t.name===e.class);t?(async e=>{if(!m){const t={id:Date.now().toString(),userId:"local",name:e.name,class:e.class,level:1,experience:0,health:100,maxHealth:100,mana:50,maxMana:50,gold:100,inventory:{"Healing Potion":3,"Iron Ore":2,Herb:5},equipment:{weapon:{name:"Iron Sword",type:"weapon"},armor:{name:"Leather Armor",type:"armor"}},stats:e.baseStats,skills:e.skills||{},achievements:[],createdAt:Date.now(),lastPlayed:Date.now(),totalPlayTime:0},a=JSON.parse(localStorage.getItem("mythseeker_characters")||"[]");return a.push(t),localStorage.setItem("mythseeker_characters",JSON.stringify(a)),Ce("characterCreated"),f(e=>[t,...e]),R(t),void P("lobby")}const t={userId:m.uid,name:e.name,class:e.class,level:1,experience:0,health:100,maxHealth:100,mana:50,maxMana:50,gold:100,inventory:{"Healing Potion":3,"Iron Ore":2,Herb:5},equipment:{weapon:{name:"Iron Sword",type:"weapon"},armor:{name:"Leather Armor",type:"armor"}},stats:e.baseStats,skills:e.skills||{},achievements:[],createdAt:Date.now(),lastPlayed:Date.now(),totalPlayTime:0};try{const a=await ba.saveCharacter(t),n={...t,id:a};f(e=>[n,...e]),R(n),Ce("characterCreated",{character:e}),P("lobby")}catch(a){const e={...t,id:Date.now().toString(),userId:m.uid},n=JSON.parse(localStorage.getItem("mythseeker_characters")||"[]");n.push(e),localStorage.setItem("mythseeker_characters",JSON.stringify(n)),f(t=>[e,...t]),R(e),Ce("characterCreated"),Ce("warning"),P("lobby")}})({...e,baseStats:t.stats,skills:t.skills,health:100,maxHealth:100,mana:50,maxMana:50,level:1,experience:0,gold:100,inventory:{"Healing Potion":3,"Iron Ore":2,Herb:5},equipment:{weapon:{name:"Iron Sword",type:"weapon"},armor:{name:"Leather Armor",type:"armor"}},unlockedSkills:[1],id:Y,playerId:Y}):Ce("error")},Fe=async e=>{var t;if(e&&e.id){B(!0);try{const a=Le.find(t=>t.name===e.theme)||Le[0],n=`Begin the adventure. The party consists of: ${(null==(t=e.players)?void 0:t.map(e=>`${e.character.name} the ${e.character.class}`).join(", "))||"the party"}. Setting: ${a.description}. Present an immersive opening scene with 3 action choices.`,r=await dynamicDMService.processPlayerInput({message:n,playerId:Y,campaignId:e.id,character:D,timestamp:new Date}),s={id:Date.now(),type:"dm",content:r.narrative_text+(r.npc_dialogue?`\n\n${r.npc_dialogue}`:""),choices:r.choices||["Explore","Investigate","Ask questions"],timestamp:new Date,atmosphere:r.mood_adjustment||{mood:"dynamic",tension:"medium"}};r.game_state_updates&&Je(r.game_state_updates),F([s]);const i={...e,started:!0,status:"active"};L(i),_(t=>t.map(t=>t.id===e.id?i:t)),P("game"),Ee(`/campaigns/${e.id}`)}catch(a){Ce("error")}B(!1)}else Ce("error")},[ze,We]=a.useState(null),He=i.useMemo(()=>new Ks(10,6e4),[]),Be=async()=>{const e=(e=>{if(!e||0===e.trim().length)return{isValid:!1,error:"Message cannot be empty"};const t=Gs(e.trim());return t.length>500?{isValid:!1,error:"Message must be 500 characters or less"}:(e=>{const t=e.toLowerCase();return Js.some(e=>t.includes(e))})(t)?{isValid:!1,error:"Message contains inappropriate content"}:{isValid:!0}})(z);if(!e.isValid)return void We(e.error||"Invalid message");const t=Y||"anonymous";if(!He.isAllowed(t)){const e=He.getTimeUntilReset(t);return void We(`Please wait ${Math.ceil(e/1e3)} seconds before sending another message`)}if(We(null),H)return;const a=Gs(z),n={id:Date.now(),type:"player",content:a,character:D.name,playerId:Y,playerName:M,timestamp:new Date},r=[...U,n];F(r),W(""),B(!0);try{const e=await dynamicDMService.processPlayerInput({message:a,playerId:Y,campaignId:(null==$?void 0:$.id)||"single-player",character:D,timestamp:new Date}),t={narrative:e.narrative_text,choices:["Continue","Investigate","Ask questions","Take action"],atmosphere:{mood:"dynamic",tension:"medium",environmentalDetails:"The world responds to your actions"}};e.npc_dialogue&&(t.narrative+=`\n\n${e.npc_dialogue}`),e.system_actions&&e.system_actions.length>0&&e.system_actions.forEach(e=>{if("dice_roll"===e.type){const e=((e=20)=>Math.floor(Math.random()*e)+1)(20);t.narrative+=`\n\n[Roll: ${e}]`}}),t.worldStateUpdates&&Je(t.worldStateUpdates),t.environment&&V(t.environment),t.characterUpdates&&t.characterUpdates.forEach(e=>{e.playerId===Y&&(R(t=>{var a,n;return t?{...t,experience:t.experience+(e.xpGain||0),health:Math.max(1,Math.min(t.maxHealth,t.health+((null==(a=e.statChanges)?void 0:a.health)||0))),mana:Math.max(0,Math.min(t.maxMana,t.mana+((null==(n=e.statChanges)?void 0:n.mana)||0))),inventory:{...t.inventory,...e.newItems}}:null}),e.reputationChanges&&ae(t=>({...t,playerReputation:{...t.playerReputation,...e.reputationChanges}})))});const n={id:Date.now()+1,type:"dm",content:t.narrative,choices:t.choices,timestamp:new Date,atmosphere:t.atmosphere,worldStateUpdates:t.worldStateUpdates};F(e=>[...e,n]),t.combatEncounter&&Ve(t.combatEncounter.enemies)}catch(s){const e={id:Date.now()+1,type:"dm",content:"The story continues to unfold... (AI temporarily unavailable)",timestamp:new Date};F(t=>[...t,e])}B(!1)},qe=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Be())},Ve=t=>{var a,n,r,s;if(!D)return;const i=[{id:D.id||Y||"player",name:D.name,type:"player",character:D,position:{x:0,y:0},health:D.health,maxHealth:D.maxHealth,mana:D.mana,maxMana:D.maxMana,actionPoints:D.actionPoints||{move:6,action:1,bonus:1,reaction:1},currentActionPoints:{move:6,action:1,bonus:1,reaction:1},stats:{strength:(null==(a=D.baseStats)?void 0:a.strength)||10,dexterity:(null==(n=D.baseStats)?void 0:n.dexterity)||10,intelligence:(null==(r=D.baseStats)?void 0:r.intelligence)||10,charisma:(null==(s=D.baseStats)?void 0:s.charisma)||10,armorClass:10},statusEffects:[],isActive:!1,hasActed:!1,reach:1,skills:D.skills||{}},...t.map((e,t)=>({id:`enemy-${t}`,name:e.name||`Enemy ${t+1}`,type:"enemy",position:{x:0,y:0},health:e.health||25,maxHealth:e.health||25,actionPoints:{move:4,action:1,bonus:0,reaction:1},currentActionPoints:{move:4,action:1,bonus:0,reaction:1},stats:{strength:e.strength||12,dexterity:e.dexterity||10,intelligence:e.intelligence||8,charisma:e.charisma||8,armorClass:e.armorClass||12},statusEffects:[],isActive:!1,hasActed:!1,reach:1,skills:{}}))],o=e.startCombat(i);ee(o),P("combat")},Ye=t=>{const a=e.executeAction(t);if(a.success&&a.newState){ee(a.newState);const t=e.checkCombatEnd();t.ended&&("players"===t.winner?(alert("Victory! You have defeated your enemies!"),R(e=>e?{...e,experience:e.experience+50,health:Math.min(e.maxHealth,e.health+20)}:null)):(alert("Defeat! Your party has been defeated..."),R(e=>e?{...e,health:Math.max(1,e.health-10)}:null)),e.endCombat(),ee(null),P("game"))}else alert(a.message)},Ge=()=>{e.endCombat(),ee(null),P("game")},Je=e=>{e&&(ae(t=>{const a={...t};return e.newLocation&&(a.currentLocation=e.newLocation),e.newNPCs&&e.newNPCs.forEach(e=>{const t=a.npcs[e.name];a.npcs[e.name]=t?{...t,...e,lastSeen:new Date,interactionCount:(t.interactionCount||0)+1,knownSecrets:[...t.knownSecrets||[],...e.knownSecrets||[]],relationship:e.relationship||t.relationship,currentLocation:a.currentLocation}:{...e,id:Date.now().toString(),firstEncounter:new Date,lastSeen:new Date,interactionCount:1,relationship:"neutral",knownSecrets:[],memory:{playerActions:[],conversations:[],sharedSecrets:[],emotionalState:"neutral"},currentLocation:a.currentLocation}}),e.factionChanges&&e.factionChanges.forEach(e=>{a.factions[e.faction]||(a.factions[e.faction]={name:e.faction,influence:10,goals:[],members:[]}),e.change.includes("influence")&&(a.factions[e.faction].influence+=5)}),e.questUpdates&&e.questUpdates.forEach(e=>{const t=a.activeQuests.findIndex(t=>t.title===e.quest);t>=0&&(a.activeQuests[t]={...a.activeQuests[t],progress:e.progress,currentObjective:e.newObjective})}),a}),ve(t=>({...t,playerActions:[...t.playerActions,{description:`Player action: ${z}`,timestamp:new Date,location:te.currentLocation}],consequences:[...t.consequences,...e.consequences||[]]})))},Ke=({campaign:e,messages:t,inputMessage:n,setInputMessage:r,sendMessage:s,handleKeyPress:i,isAIThinking:o,messagesEndRef:l,onStartCombat:c,worldState:d,aiMemory:u,inputRef:h})=>{const[m,p]=a.useState(!1),[g,f]=a.useState(!1),[x,y]=a.useState(!1),[b,w]=a.useState(null),[v,j]=a.useState("all"),[N,k]=a.useState(!1),[C,S]=a.useState(!0),A=a.useRef(null),T=t.filter(e=>"all"===v||e.type===v);return a.useEffect(()=>{const e=A.current;if(!e)return;const t=()=>{const{scrollTop:t,scrollHeight:a,clientHeight:n}=e;f(!(a-t-n<100))};return e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)},[]),Te.jsxs("div",{className:"h-full flex flex-col transition-all duration-500 "+(N?"fixed inset-0 z-50":""),children:[Te.jsxs("div",{className:"relative bg-gradient-to-r from-slate-900/95 via-purple-900/95 to-slate-900/95 backdrop-blur-lg border-b border-purple-500/30",children:[Te.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-purple-900/20 via-transparent to-transparent"}),Te.jsxs("div",{className:"relative flex items-center justify-between p-4",children:[Te.jsxs("div",{className:"flex items-center space-x-4",children:[Te.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-blue-600 rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg",children:"ðŸ—ºï¸"}),Te.jsxs("div",{children:[Te.jsx("h2",{className:"text-xl font-bold text-white",children:(null==e?void 0:e.theme)||"Adventure"}),Te.jsxs("div",{className:"flex items-center space-x-4 text-sm text-purple-200",children:[Te.jsx("span",{children:"â€¢"}),Te.jsxs("span",{children:[T.length," messages"]}),Te.jsx("span",{children:"â€¢"}),Te.jsx("span",{className:"text-green-400",children:"Active Campaign"}),(null==d?void 0:d.currentLocation)&&Te.jsxs(Te.Fragment,{children:[Te.jsx("span",{children:"â€¢"}),Te.jsx("span",{className:"text-yellow-400",children:d.currentLocation})]})]})]})]}),Te.jsxs("div",{className:"flex items-center space-x-2",children:[Te.jsxs("select",{value:v,onChange:e=>j(e.target.value),className:"px-3 py-1.5 bg-white/10 border border-white/20 rounded-lg text-white text-sm focus:outline-none focus:border-purple-400",children:[Te.jsx("option",{value:"all",children:"All Messages"}),Te.jsx("option",{value:"dm",children:"DM Only"}),Te.jsx("option",{value:"player",children:"Player Only"}),Te.jsx("option",{value:"system",children:"System Only"})]}),Te.jsx("button",{onClick:()=>p(!m),className:"p-2 rounded-lg transition-all "+(m?"bg-purple-600 text-white":"bg-white/10 text-purple-200 hover:bg-white/20"),title:"Quick Actions",children:"âš¡"}),Te.jsx("button",{onClick:()=>y(!0),className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all text-purple-200",title:"Roll Dice",children:"ðŸŽ²"}),Te.jsx("button",{onClick:()=>S(!C),className:"p-2 rounded-lg transition-all "+(C?"bg-green-600 text-white":"bg-white/10 text-purple-200 hover:bg-white/20"),title:"Atmospheric Sounds",children:"ðŸ”Š"}),Te.jsx("button",{onClick:()=>k(!N),className:"p-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all text-purple-200",title:"Toggle Fullscreen",children:N?"ðŸ——":"ðŸ—–"})]})]})]}),m&&Te.jsx("div",{className:"bg-gradient-to-r from-purple-900/30 to-blue-900/30 border-b border-purple-500/30 backdrop-blur-sm",children:Te.jsxs("div",{className:"p-4",children:[Te.jsxs("h3",{className:"text-white font-semibold mb-3 flex items-center space-x-2",children:[Te.jsx("span",{children:"âš¡"}),Te.jsx("span",{children:"Quick Actions"})]}),Te.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:["I examine my surroundings carefully for clues","I search for hidden passages or secret doors","I listen carefully for any sounds or voices","I check my equipment and inventory","I try to communicate with any nearby NPCs","I cast a detection spell","I move stealthily forward","I prepare for combat"].map((e,t)=>Te.jsx("button",{onClick:()=>(e=>{r(e),p(!1),setTimeout(()=>s(),100)})(e),className:"text-left p-3 bg-white/10 hover:bg-white/20 rounded-lg border border-white/20 transition-all text-sm text-purple-100 hover:text-white transform hover:scale-105",disabled:o,children:e},t))})]})}),Te.jsxs("div",{ref:A,className:"flex-1 overflow-y-auto bg-gradient-to-br from-slate-950/90 via-purple-950/90 to-slate-950/90 relative",children:[Te.jsxs("div",{className:"absolute inset-0 opacity-5",children:[Te.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 h-64 bg-purple-500 rounded-full filter blur-3xl"}),Te.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-48 h-48 bg-blue-500 rounded-full filter blur-3xl"})]}),Te.jsxs("div",{className:"relative p-6 space-y-6",children:[T.map((e,t)=>{var a,n,i;return Te.jsx("div",{className:"group relative transform transition-all duration-300 hover:scale-[1.01] "+("player"===e.type?"ml-8":"dm"===e.type?"mr-8":""),children:Te.jsx("div",{className:"relative p-6 rounded-2xl backdrop-blur-sm border shadow-xl "+("player"===e.type?"bg-gradient-to-br from-blue-600/20 to-cyan-600/20 border-blue-400/30 shadow-blue-500/10":"dm"===e.type?"bg-gradient-to-br from-purple-600/20 to-pink-600/20 border-purple-400/30 shadow-purple-500/10":"bg-gradient-to-br from-gray-600/20 to-slate-600/20 border-gray-400/30 shadow-gray-500/10"),children:Te.jsxs("div",{className:"flex items-start space-x-4 mb-4",children:[Te.jsx("div",{className:"flex-shrink-0 w-12 h-12 rounded-xl flex items-center justify-center text-white font-bold shadow-lg "+("player"===e.type?"bg-gradient-to-br from-blue-500 to-cyan-600":"dm"===e.type?"bg-gradient-to-br from-purple-500 to-pink-600":"bg-gradient-to-br from-gray-500 to-slate-600"),children:"player"===e.type?(null==(a=null==D?void 0:D.name)?void 0:a.charAt(0))||"P":"dm"===e.type?"ðŸŽ­":"âš™ï¸"}),Te.jsxs("div",{className:"flex-1 min-w-0",children:[Te.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[Te.jsx("span",{className:"font-bold text-white text-lg",children:"player"===e.type?(null==D?void 0:D.name)||"You":"dm"===e.type?"Dungeon Master":e.playerName||"System"}),Te.jsx("span",{className:"text-xs text-gray-400 bg-black/30 px-2 py-1 rounded-full",children:new Date(e.timestamp).toLocaleTimeString()}),(null==(n=e.atmosphere)?void 0:n.mood)&&Te.jsx("span",{className:"text-xs px-3 py-1 rounded-full font-medium "+("tense"===e.atmosphere.mood?"bg-red-500/30 text-red-300 border border-red-500/50":"mysterious"===e.atmosphere.mood?"bg-purple-500/30 text-purple-300 border border-purple-500/50":"peaceful"===e.atmosphere.mood?"bg-green-500/30 text-green-300 border border-green-500/50":"bg-blue-500/30 text-blue-300 border border-blue-500/50"),children:e.atmosphere.mood})]}),Te.jsx("div",{className:"text-gray-100 leading-relaxed text-lg",dangerouslySetInnerHTML:{__html:(i=e.content,i?i.replace(/\*\*(.*?)\*\*/g,'<strong class="text-yellow-300">$1</strong>').replace(/\*(.*?)\*/g,'<em class="text-blue-300">$1</em>').replace(/"(.*?)"/g,'<span class="text-green-300">"$1"</span>'):"")}}),e.choices&&e.choices.length>0&&Te.jsxs("div",{className:"mt-6 space-y-3",children:[Te.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-300",children:[Te.jsx("span",{className:"w-2 h-2 bg-yellow-400 rounded-full animate-pulse"}),Te.jsx("span",{className:"font-medium",children:"Choose your path:"})]}),Te.jsx("div",{className:"grid gap-3",children:e.choices.map((e,t)=>Te.jsx("button",{onClick:()=>{r(e),setTimeout(()=>s(),100)},className:"group text-left p-4 bg-gradient-to-r from-white/10 to-white/5 hover:from-white/20 hover:to-white/10 rounded-xl border border-white/20 hover:border-white/40 transition-all duration-300 transform hover:scale-105 hover:shadow-lg",disabled:o,children:Te.jsxs("div",{className:"flex items-center space-x-3",children:[Te.jsx("span",{className:"w-8 h-8 bg-gradient-to-br from-purple-500 to-blue-600 rounded-lg flex items-center justify-center text-sm font-bold text-white group-hover:scale-110 transition-transform",children:t+1}),Te.jsx("span",{className:"text-gray-200 group-hover:text-white transition-colors font-medium",children:e})]})},t))})]}),e.atmosphere&&Te.jsxs("div",{className:"mt-4 p-3 bg-black/20 rounded-xl border border-white/10",children:[Te.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Atmosphere"}),Te.jsxs("div",{className:"text-sm text-gray-300",children:["ðŸŒ¡ï¸ ",e.atmosphere.mood," â€¢ ðŸŒ¤ï¸ ",e.atmosphere.lighting||"Normal"," â€¢ ðŸ”Š ",e.atmosphere.sounds||"Quiet"]})]})]})]})})},e.id||t)}),o&&Te.jsx("div",{className:"group transform transition-all duration-300",children:Te.jsx("div",{className:"relative p-6 rounded-2xl bg-gradient-to-br from-purple-600/20 to-pink-600/20 border border-purple-400/30 backdrop-blur-sm shadow-xl",children:Te.jsxs("div",{className:"flex items-center space-x-4",children:[Te.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl flex items-center justify-center text-white shadow-lg",children:"ðŸŽ­"}),Te.jsxs("div",{className:"flex-1",children:[Te.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[Te.jsx("span",{className:"font-bold text-white text-lg",children:"Dungeon Master"}),Te.jsxs("div",{className:"flex space-x-1",children:[Te.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-pulse"}),Te.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),Te.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-pulse",style:{animationDelay:"0.4s"}})]})]}),Te.jsx("div",{className:"text-purple-200 text-lg italic",children:"The Dungeon Master weaves the threads of fate..."})]})]})})}),Te.jsx("div",{ref:l})]})]}),g&&Te.jsx("div",{className:"absolute bottom-24 right-6 z-10",children:Te.jsx("button",{onClick:()=>{var e;return null==(e=l.current)?void 0:e.scrollIntoView({behavior:"smooth"})},className:"p-3 bg-gradient-to-br from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 rounded-full text-white shadow-lg transition-all transform hover:scale-110",children:"â†“"})}),Te.jsx("div",{className:"bg-gradient-to-r from-slate-900/95 via-purple-900/95 to-slate-900/95 backdrop-blur-lg border-t border-purple-500/30 p-6",children:Te.jsxs("div",{className:"flex space-x-4",children:[Te.jsxs("div",{className:"flex-1 relative",children:[Te.jsx("input",{ref:h,type:"text",value:n,onChange:e=>r(e.target.value),onKeyDown:i,placeholder:"What do you do? (Be specific and creative!)",className:"w-full px-6 py-4 bg-white/10 text-white placeholder-purple-200 rounded-2xl border border-white/20 focus:outline-none focus:border-purple-400 focus:ring-2 focus:ring-purple-400/50 transition-all text-lg backdrop-blur-sm",disabled:o,maxLength:500}),n.length>0&&Te.jsxs("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-sm text-gray-400 bg-black/30 px-2 py-1 rounded-full",children:[n.length,"/500"]})]}),Te.jsx("button",{onClick:s,disabled:o||!n.trim(),className:"px-8 py-4 bg-gradient-to-br from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 disabled:from-gray-600 disabled:to-gray-700 disabled:cursor-not-allowed rounded-2xl transition-all text-white font-bold text-lg shadow-lg transform hover:scale-105 disabled:transform-none",children:o?"â³":"ðŸš€"})]})}),x&&Te.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:Te.jsxs("div",{className:"bg-gradient-to-br from-purple-900/90 to-blue-900/90 backdrop-blur-lg rounded-2xl p-8 border border-purple-400/30 shadow-2xl max-w-md w-full mx-4",children:[Te.jsx("h3",{className:"text-2xl font-bold mb-6 text-white text-center",children:"ðŸŽ² Dice Roller"}),Te.jsx("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[4,6,8,10,12,20].map(e=>Te.jsxs("button",{onClick:()=>(e=>{const t=Math.floor(Math.random()*e)+1;w(t),r(`I roll a d${e} and get ${t}`),setTimeout(()=>w(null),3e3)})(e),className:"p-4 bg-white/10 hover:bg-white/20 rounded-xl transition-all text-white font-bold text-lg transform hover:scale-105 border border-white/20 hover:border-white/40",children:["d",e]},e))}),b&&Te.jsxs("div",{className:"text-center mb-6 p-4 bg-gradient-to-br from-yellow-500/20 to-orange-500/20 rounded-xl border border-yellow-400/30",children:[Te.jsxs("div",{className:"text-3xl font-bold text-yellow-400 mb-2",children:["ðŸŽ¯ ",b]}),Te.jsx("div",{className:"text-yellow-200",children:"Great roll!"})]}),Te.jsx("button",{onClick:()=>y(!1),className:"w-full px-6 py-3 bg-gradient-to-br from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 rounded-xl transition-all text-white font-bold",children:"Close"})]})})]})};return"welcome"===E?Te.jsx("div",{className:`min-h-screen bg-gradient-to-br ${Oe[q]} flex items-center justify-center p-4 transition-all duration-1000`,children:Te.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-3xl p-8 max-w-md w-full border border-white/20",children:[Te.jsxs("div",{className:"text-center mb-8",children:[Te.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"âš”ï¸ AI Dungeon Master"}),Te.jsx("p",{className:"text-blue-200",children:"Advanced RPG with real consequences"}),Te.jsxs("div",{className:"flex justify-center space-x-4 mt-4 text-sm",children:[Te.jsxs("div",{className:"flex items-center space-x-1 text-yellow-400",children:[Te.jsx(le,{size:16}),Te.jsx("span",{children:"Tactical Combat"})]}),Te.jsxs("div",{className:"flex items-center space-x-1 text-green-400",children:[Te.jsx(G,{size:16}),Te.jsx("span",{children:"Character Growth"})]}),Te.jsxs("div",{className:"flex items-center space-x-1 text-purple-400",children:[Te.jsx(ce,{size:16}),Te.jsx("span",{children:"Living World"})]})]}),Te.jsx(Hs,{content:"Interactive tutorial and help guide",ariaLabel:"Help tutorial",children:Te.jsxs("button",{onClick:()=>{d(!0),h("welcome")},className:"mt-4 px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-all flex items-center space-x-2 mx-auto","aria-label":"Open interactive tutorial and help guide",children:[Te.jsx(de,{size:16}),Te.jsx("span",{children:"Interactive Tutorial"})]})})]}),x?Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-4"}),Te.jsx("p",{className:"text-blue-200",children:"Loading..."})]}):b?Te.jsxs("div",{className:"space-y-4",children:[Te.jsxs("div",{className:"text-center mb-4",children:[Te.jsxs("p",{className:"text-white",children:["Welcome back, ",null==m?void 0:m.displayName,"!"]}),Te.jsx(Hs,{content:"Continue your adventure with existing characters",ariaLabel:"Continue adventure",children:Te.jsx("button",{onClick:()=>{P("character-select"),Ee("/characters")},className:"w-full px-6 py-3 bg-gradient-to-r from-green-600 to-blue-600 text-white rounded-xl font-semibold hover:from-green-700 hover:to-blue-700 transition-all","aria-label":"Continue your adventure with existing characters",children:"Continue Adventure"})})]}),Te.jsx(Hs,{content:"Sign out of your account",ariaLabel:"Sign out",children:Te.jsx("button",{onClick:async()=>{try{await ba.signOut(),R(null),L(null),f([]),p(null),w(!1),P("welcome"),Ce("goodbye",{message:"See you next time, adventurer!"})}catch(e){}},className:"w-full px-6 py-3 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-all","aria-label":"Sign out of your account",children:"Sign Out"})})]}):Te.jsxs("div",{className:"space-y-4",children:[Te.jsx(Hs,{content:"Sign in with your Google account to save progress",ariaLabel:"Sign in with Google",children:Te.jsxs("button",{onClick:Ae,disabled:x,className:"w-full px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-semibold hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center space-x-2","aria-label":"Sign in with your Google account to save progress","aria-describedby":"signin-description",children:[Te.jsx(ue,{size:20}),Te.jsx("span",{children:"Sign in with Google"})]})}),Te.jsx("div",{id:"signin-description",className:"sr-only",children:"Sign in to save your progress and access multiplayer features"}),Te.jsxs("div",{className:"text-center",children:[Te.jsx("p",{className:"text-blue-200 text-sm mb-3",children:"Or join an existing campaign:"}),Te.jsxs("div",{className:"flex space-x-2",children:[Te.jsx("input",{type:"text",placeholder:"Campaign Code",value:X,onChange:e=>Q(e.target.value.toUpperCase()),className:"flex-1 px-3 py-2 rounded-lg bg-white/20 text-white placeholder-blue-200 border border-white/30 focus:outline-none focus:border-blue-400 text-center","aria-label":"Enter campaign code to join existing game",maxLength:6}),Te.jsx(Hs,{content:"Join an existing campaign using the 6-character code",ariaLabel:"Join campaign",children:Te.jsx("button",{onClick:()=>{M.trim()&&X.trim()&&(D?alert("Join campaign feature coming soon!"):P("character"))},disabled:!M.trim()||!X.trim(),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 transition-all","aria-label":"Join campaign with entered code",children:"Join"})})]})]})]})]})}):("character-select"===E&&g.forEach((e,t)=>{}),Te.jsxs("div",{className:`main-container flex flex-col min-h-screen bg-gradient-to-br ${Oe[q]} transition-all duration-1000 ${A?"pb-16":""}`,children:[t&&Te.jsx(SuccessFeedback,{message:t.message,icon:t.icon,duration:t.duration,onClose:()=>n(null)}),Te.jsx(qs,{messages:r,onDismiss:Se}),o&&Te.jsx(oo,{character:D,onStart:()=>{l(!1),P("lobby"),Ce("welcomeBack")},onDismiss:()=>{l(!1),P("lobby"),Ce("ftueSkipped")}}),Te.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[Te.jsx(a.Suspense,{fallback:Te.jsx(fo,{}),children:Te.jsx(so,{active:v,onNavigate:Pe,theme:q,isMobile:!1})}),"dm-center"===E&&Te.jsxs("div",{className:"flex-1 flex flex-col h-full",children:[Te.jsx(a.Suspense,{fallback:Te.jsx(fo,{}),children:Te.jsx(io,{onNewCampaign:Ie,isMobile:A,onToggleMobile:()=>S(!C),currentScreen:E,onHelpClick:()=>d(!0)})}),Te.jsx(xo,{onScreenChange:P,currentScreen:E}),Te.jsx(go,{currentScreen:E,currentCampaign:$,character:D,onNavigate:Me}),Te.jsx("main",{className:"flex-1 overflow-auto",children:Te.jsx(a.Suspense,{fallback:Te.jsx(fo,{}),children:Te.jsx(po,{dmCenterData:ne,onUpdateDMCenter:e=>{re(e),"game"!==E&&"waiting"!==E||(setLastPersonaUpdate(Date.now()),Ce("Persona updated"))},currentCampaign:$})})})]}),"dm-center"!==E&&Te.jsx("div",{className:"flex flex-1 h-full",children:Te.jsxs("div",{className:"flex-1 flex flex-col h-full",children:[Te.jsx(a.Suspense,{fallback:Te.jsx(fo,{}),children:Te.jsx(io,{onNewCampaign:Ie,isMobile:A,onToggleMobile:()=>S(!C),currentScreen:E,onHelpClick:()=>d(!0)})}),Te.jsxs("main",{className:"flex-1 overflow-auto",children:[Te.jsx(xo,{onScreenChange:P,currentScreen:E}),Te.jsx(go,{currentScreen:E,currentCampaign:$,character:D,onNavigate:Me}),["character","waiting","game","combat","world","characters","character-select"].includes(E)&&Te.jsx("div",{className:"w-full h-full",children:(()=>{switch(E){case"character":return b?Te.jsxs("div",{className:"h-full p-6",children:[Te.jsxs("div",{className:"flex justify-between items-center mb-6",children:[Te.jsx("h2",{className:"text-3xl font-bold text-white",children:"Create Your Hero"}),Te.jsx("button",{onClick:()=>P("character-select"),className:"px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-all",children:"â† Back to Characters"})]}),Te.jsx(bo,{playerName:(null==m?void 0:m.displayName)||"",classes:$e,onCreateCharacter:Ue,joinCode:X})]}):Te.jsx("div",{className:"h-full flex items-center justify-center p-4",children:Te.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-3xl p-8 max-w-md w-full border border-white/20 text-center",children:[Te.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Authentication Required"}),Te.jsx("p",{className:"text-blue-200 mb-6",children:"Please sign in to create a character"}),Te.jsx("button",{onClick:Ae,className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-semibold hover:from-blue-700 hover:to-purple-700 transition-all",children:"Sign in with Google"})]})});case"waiting":return Te.jsx(vo,{campaign:$,onStart:Fe,onBack:()=>P("lobby")});case"game":return Te.jsx(Ke,{campaign:$,messages:U,inputMessage:z,setInputMessage:W,sendMessage:Be,handleKeyPress:qe,isAIThinking:H,messagesEndRef:oe,onStartCombat:Ve,worldState:te,aiMemory:we,inputRef:me});case"combat":return Z&&Te.jsx(a.Suspense,{fallback:Te.jsx(fo,{}),children:Te.jsx(lo,{combatants:Z.combatants,battleMap:Z.battleMap,currentTurn:Z.currentTurn,activeCombatantId:Z.turnOrder[Z.currentCombatantIndex],onAction:Ye,onEndCombat:Ge,isPlayerTurn:e.isPlayerTurn()})});case"world":return Te.jsxs("div",{className:"h-full p-6",children:[Te.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"World Map & Exploration"}),Te.jsxs("div",{className:"bg-white/10 rounded-lg p-6 border border-white/20",children:[Te.jsx("p",{className:"text-blue-200 mb-4",children:"Interactive world map coming soon!"}),Te.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Te.jsxs("div",{className:"bg-black/20 rounded-lg p-4",children:[Te.jsx("h3",{className:"text-white font-semibold mb-2",children:"Current Location"}),Te.jsx("p",{className:"text-blue-200",children:(null==te?void 0:te.currentLocation)||"Unknown"})]}),Te.jsxs("div",{className:"bg-black/20 rounded-lg p-4",children:[Te.jsx("h3",{className:"text-white font-semibold mb-2",children:"Weather"}),Te.jsx("p",{className:"text-blue-200",children:(null==te?void 0:te.weather)||"Clear"})]})]})]})]});case"characters":case"character-select":return Te.jsxs("div",{className:"h-full p-6",children:[Te.jsxs("div",{className:"flex justify-between items-center mb-6",children:[Te.jsxs("div",{children:[Te.jsx("h2",{className:"text-3xl font-bold text-white",children:"Choose Your Character"}),Te.jsxs("p",{className:"text-blue-200",children:["Welcome back, ",null==m?void 0:m.displayName,"!"]})]}),Te.jsxs("div",{className:"flex space-x-3",children:[Te.jsx("button",{onClick:()=>P("dashboard"),className:"px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-all",children:"â† Back to Dashboard"}),Te.jsx("button",{onClick:()=>P("character"),className:"px-6 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all",children:"Create New Character"})]})]}),0===g.length?Te.jsxs("div",{className:"text-center py-12",children:[Te.jsx("div",{className:"text-6xl mb-4",children:"ðŸ°"}),Te.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No Characters Yet"}),Te.jsx("p",{className:"text-blue-200 mb-6",children:"Create your first character to begin your adventure!"}),Te.jsx("button",{onClick:()=>P("character"),className:"px-6 py-3 bg-gradient-to-r from-green-600 to-blue-600 text-white rounded-xl font-semibold hover:from-green-700 hover:to-blue-700 transition-all",children:"Create Your First Character"})]}):Te.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[g.map(e=>Te.jsx("div",{className:"bg-white/10 rounded-xl p-6 border border-white/20 hover:border-blue-400 hover:bg-white/20 cursor-pointer transition-all",onClick:()=>(async e=>{try{const t=JSON.parse(localStorage.getItem("mythseeker_characters")||"[]").find(t=>t.id===e);if(t)return R(t),P("lobby"),Ee("/campaigns"),void Ce("characterLoaded",{character:t.name});if(m){const t=await ba.getCharacter(e);t?(R(t),P("lobby"),Ee("/campaigns"),Ce("characterLoaded",{character:t.name})):Ce("error",{message:"Character not found in database"})}else Ce("error",{message:"Character not found"})}catch(t){Ce("error",{message:`Failed to load character: ${t.message||"Unknown error"}`})}})(e.id),children:Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-4xl mb-3",children:"Warrior"===e.class?"âš”ï¸":"Rogue"===e.class?"ðŸ—¡ï¸":"Mage"===e.class?"ðŸ”®":"Cleric"===e.class?"âš¡":"Ranger"===e.class?"ðŸ¹":"ðŸŽµ"}),Te.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:e.name}),Te.jsxs("p",{className:"text-blue-200 mb-3",children:["Level ",e.level," ",e.class]}),Te.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-blue-200",children:[Te.jsxs("div",{children:["HP: ",e.health,"/",e.maxHealth]}),Te.jsxs("div",{children:["XP: ",e.experience]}),Te.jsxs("div",{children:["Gold: ",e.gold]}),Te.jsxs("div",{children:["Play Time: ",Math.floor(e.totalPlayTime/6e4),"m"]})]}),Te.jsxs("div",{className:"mt-3 text-xs text-green-400",children:["Last played: ",new Date(e.lastPlayed).toLocaleDateString()]})]})},e.id)),Te.jsx("div",{onClick:()=>P("character"),className:"bg-gradient-to-br from-green-500/20 to-blue-500/20 rounded-xl p-6 border-2 border-dashed border-white/30 hover:border-white/50 hover:from-green-500/30 hover:to-blue-500/30 cursor-pointer transition-all",children:Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-4xl mb-3",children:"âœ¨"}),Te.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Create New Character"}),Te.jsx("p",{className:"text-blue-200",children:"Start a new adventure with a fresh hero"})]})})]})]});case"profile":return b?Te.jsxs("div",{className:"h-full p-6",children:[Te.jsxs("div",{className:"flex justify-between items-center mb-6",children:[Te.jsx("h2",{className:"text-3xl font-bold text-white",children:"Player Profile"}),Te.jsx("button",{onClick:()=>P("dashboard"),className:"px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-all",children:"â† Back to Dashboard"})]}),Te.jsx("div",{className:"h-[calc(100vh-200px)]",children:Te.jsx(wa,{})})]}):Te.jsx("div",{className:"h-full flex items-center justify-center p-4",children:Te.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-3xl p-8 max-w-md w-full border border-white/20 text-center",children:[Te.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Authentication Required"}),Te.jsx("p",{className:"text-blue-200 mb-6",children:"Please sign in to view your profile"}),Te.jsx("button",{onClick:Ae,className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-semibold hover:from-blue-700 hover:to-purple-700 transition-all",children:"Sign in with Google"})]})});default:return null}})()}),["dashboard","lobby","party","magic"].includes(E)&&Te.jsx("div",{className:"px-4 lg:px-6 py-2",children:Te.jsxs("div",{className:"relative min-h-full",children:[Te.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent rounded-3xl pointer-events-none"}),Te.jsxs("div",{className:"relative z-10",children:["dashboard"===E&&Te.jsx("div",{className:"h-full flex items-center justify-center",children:Te.jsxs("div",{className:"text-center",children:[Te.jsx("h2",{className:"text-3xl font-bold text-white mb-4",children:"Dashboard"}),Te.jsx("p",{className:"text-blue-200 mb-6",children:"Welcome to MythSeeker RPG!"}),Te.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 w-full",children:[Te.jsx(Hs,{content:"Start playing immediately with a pre-made character and campaign",children:Te.jsxs("button",{onClick:()=>(async()=>{try{const e={id:`quick_${Date.now()}`,name:"Adventurer",class:"Warrior",level:1,health:20,maxHealth:20,mana:0,maxMana:0,experience:0,gold:50,inventory:{Sword:1,Shield:1,"Health Potion":2},baseStats:{strength:16,dexterity:12,intelligence:10,charisma:14},skills:["Athletics","Intimidation"],backstory:"A brave warrior seeking adventure and glory.",totalPlayTime:0,lastPlayed:new Date,achievements:[]};R(e);const t={id:`quick_campaign_${Date.now()}`,name:"Quick Adventure",theme:"Fantasy",description:"A fast-paced fantasy adventure for quick play",isMultiplayer:!1,started:!1,status:"active",players:[{id:Y,name:(null==m?void 0:m.displayName)||"Player",character:e}],customPrompt:"A classic fantasy adventure with action, exploration, and discovery.",createdAt:new Date,lastActivity:new Date};await Fe(t),Ce("success",{message:"Quick start campaign created! Welcome to your adventure!"})}catch(e){Ce("error")}})(),className:"p-6 bg-gradient-to-br from-green-600/20 to-blue-600/20 rounded-lg border-2 border-green-400/30 hover:border-green-400 hover:from-green-600/30 hover:to-blue-600/30 transition-all",children:[Te.jsx("div",{className:"text-3xl mb-2",children:"âš¡"}),Te.jsx("h3",{className:"text-white font-semibold",children:"Quick Start"}),Te.jsx("p",{className:"text-green-200 text-sm",children:"Play in 30 seconds"})]})}),Te.jsx(Hs,{content:"Learn MythSeeker mechanics through guided gameplay",children:Te.jsxs("button",{onClick:()=>(async()=>{try{const e={id:`tutorial_${Date.now()}`,name:"Apprentice",class:"Mage",level:1,health:16,maxHealth:16,mana:20,maxMana:20,experience:0,gold:25,inventory:{Staff:1,Spellbook:1,"Mana Potion":2},baseStats:{strength:8,dexterity:12,intelligence:16,charisma:14},skills:["Arcana","Investigation"],backstory:"A young apprentice learning the ways of magic and adventure.",totalPlayTime:0,lastPlayed:new Date,achievements:[]};R(e);const t={id:`tutorial_campaign_${Date.now()}`,name:"Learning Adventure",theme:"Fantasy",description:"A guided tutorial to learn MythSeeker mechanics",isMultiplayer:!1,started:!1,status:"active",isTutorial:!0,players:[{id:Y,name:(null==m?void 0:m.displayName)||"Player",character:e}],customPrompt:"You are a patient, educational DM teaching a new player. This is a tutorial campaign designed to teach MythSeeker mechanics through play.\n\nTUTORIAL OBJECTIVES:\n1. Teach basic movement and exploration\n2. Introduce NPC interaction and dialogue\n3. Demonstrate simple combat mechanics\n4. Show inventory and character management\n5. Explain quest and objective systems\n\nGUIDELINES:\n- Be encouraging and supportive\n- Explain mechanics naturally through story\n- Provide clear choices that teach different systems\n- Keep challenges easy and educational\n- Celebrate player successes\n- Use simple, clear language\n- Reference the tutorial nature when helpful\n\nStart with a welcoming scene that introduces the magical academy setting and the player's role as an apprentice.",createdAt:new Date,lastActivity:new Date};await Fe(t),Ce("success",{message:"Tutorial started! Learn the ropes of MythSeeker!"})}catch(e){Ce("error")}})(),className:"p-6 bg-gradient-to-br from-purple-600/20 to-blue-600/20 rounded-lg border-2 border-purple-400/30 hover:border-purple-400 hover:from-purple-600/30 hover:to-blue-600/30 transition-all",children:[Te.jsx("div",{className:"text-3xl mb-2",children:"ðŸ“š"}),Te.jsx("h3",{className:"text-white font-semibold",children:"Tutorial"}),Te.jsx("p",{className:"text-purple-200 text-sm",children:"Learn the ropes"})]})}),Te.jsx(Hs,{content:"Create new campaigns or join existing ones",children:Te.jsxs("button",{onClick:()=>Pe("campaigns"),className:"p-6 bg-white/10 rounded-lg border border-white/20 hover:bg-white/20 transition-all",children:[Te.jsx(he,{size:32,className:"text-blue-400 mx-auto mb-2"}),Te.jsx("h3",{className:"text-white font-semibold",children:"Campaigns"}),Te.jsx("p",{className:"text-blue-200 text-sm",children:"Create or join campaigns"})]})}),Te.jsx(Hs,{content:"View and manage your characters",children:Te.jsxs("button",{onClick:()=>Pe("characters"),className:"p-6 bg-white/10 rounded-lg border border-white/20 hover:bg-white/20 transition-all",children:[Te.jsx(ue,{size:32,className:"text-green-400 mx-auto mb-2"}),Te.jsx("h3",{className:"text-white font-semibold",children:"Characters"}),Te.jsx("p",{className:"text-blue-200 text-sm",children:"Manage your characters"})]})}),Te.jsx(Hs,{content:"View your party members and their status",children:Te.jsxs("button",{onClick:()=>Pe("party"),className:"p-6 bg-white/10 rounded-lg border border-white/20 hover:bg-white/20 transition-all",children:[Te.jsx(J,{size:32,className:"text-purple-400 mx-auto mb-2"}),Te.jsx("h3",{className:"text-white font-semibold",children:"Party"}),Te.jsx("p",{className:"text-blue-200 text-sm",children:"View party members"})]})})]})]})}),"character"===E&&Te.jsx(bo,{playerName:(null==m?void 0:m.displayName)||"",classes:$e,onCreateCharacter:Ue,joinCode:X}),"lobby"===E&&Te.jsx(wo,{campaigns:O,campaignThemes:Le,onCreateCampaign:async(e,t="",a=!0)=>{const n={code:Math.random().toString(36).substr(2,6).toUpperCase(),theme:e.name,background:e.bg,players:[{id:Y||"unknown",name:M,character:{...D,playerId:Y},isHost:!0,isOnline:!0,status:"ready"}],messages:[],systemMessages:[],started:!1,customPrompt:t,isMultiplayer:a,maxPlayers:a?6:1};try{let t;if(a&&b&&m)try{const e=await Ys.createCampaign(n);t={...n,id:e}}catch(r){t={...n,id:Date.now().toString()}}else t={...n,id:Date.now().toString()};await Re(t),_([...O,t]),L(t),V(e.bg),Ce("campaignCreated",{campaign:t}),(()=>{const e=[];se.find(e=>"first_steps"===e.id)||e.push(_e[0]),e.length>0&&(ie(t=>[...t,...e]),e.forEach(e=>{setTimeout(()=>{alert(`ðŸ† Achievement Unlocked: ${e.name}! (+${e.points} points)`)},500)}))})(),a?(P("waiting"),Ee(`/campaigns/${t.id}/waiting`)):await Fe(t)}catch(s){alert("Failed to create campaign. Please try again.")}},character:D,onDeleteCampaign:async e=>{try{const a=JSON.parse(localStorage.getItem("mythseeker_campaigns")||"[]").filter(t=>t.id!==e);localStorage.setItem("mythseeker_campaigns",JSON.stringify(a));const n=O.find(t=>t.id===e);if((null==n?void 0:n.isMultiplayer)&&b)try{await Ys.deleteCampaign(e)}catch(t){}_(a),(null==$?void 0:$.id)===e&&(L(null),F([]),P("lobby"),Ee("/campaigns")),Ce("campaignDeleted",{message:"Campaign deleted successfully"})}catch(a){Ce("error")}},onJoinCampaign:async e=>{if(e.trim()&&D)try{const t=await Ys.joinCampaign(e,{name:M,character:D,isHost:!1,isOnline:!0,status:"ready"}),a=await Ys.getCampaign(t);a&&(L(a),_(e=>e.find(e=>e.id===a.id)?e.map(e=>e.id===a.id?a:e):[...e,a]),a.started?(P("game"),Ee(`/campaigns/${a.id}`)):(P("waiting"),Ee(`/campaigns/${a.id}/waiting`)),Ce("campaignJoined",{campaign:a}))}catch(t){alert("Failed to join campaign. Please check the code and try again.")}},onResumeCampaign:async e=>{const t=O.find(t=>t.id===e);if(!t)return;L(t),F(t.messages||[]);const a={...t,status:t.started?"active":t.status};if(_(t=>t.map(t=>t.id===e?a:t)),t.started?(P("game"),Ee(`/campaigns/${t.id}`),Ce("campaignResumed")):(P("waiting"),Ee(`/campaigns/${t.id}/waiting`)),t.isMultiplayer&&t.started)try{await Ys.updateCampaignState(e,{status:"active"})}catch(n){}},onPauseCampaign:async e=>{const t=O.find(t=>t.id===e);if(!t)return;const a={...t,status:"paused"};if(_(t=>t.map(t=>t.id===e?a:t)),(null==$?void 0:$.id)===e&&L(a),t.isMultiplayer)try{await Ys.updateCampaignState(e,{status:"paused"})}catch(n){}}}),"waiting"===E&&Te.jsx(vo,{campaign:$,onStart:Fe,onBack:()=>P("lobby")}),"game"===E&&Te.jsx(Ke,{campaign:$,messages:U,inputMessage:z,setInputMessage:W,sendMessage:Be,handleKeyPress:qe,isAIThinking:H,messagesEndRef:oe,onStartCombat:Ve,worldState:te,aiMemory:we,inputRef:me}),"party"===E&&Te.jsxs("div",{className:"h-full p-6",children:[Te.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Party Management"}),Te.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:fe.players.map(e=>{var t,a,n;return Te.jsxs("div",{className:"bg-white/10 rounded-lg p-4 border border-white/20",children:[Te.jsx("h3",{className:"text-white font-semibold",children:(null==(t=e.character)?void 0:t.name)||e.name}),Te.jsx("p",{className:"text-blue-200 text-sm",children:(null==(a=e.character)?void 0:a.class)||"Unknown Class"}),Te.jsxs("p",{className:"text-green-400 text-xs",children:["Level ",(null==(n=e.character)?void 0:n.level)||1]})]},e.id)})})]}),"magic"===E&&Te.jsxs("div",{className:"h-full p-6",children:[Te.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Magic & Spells"}),Te.jsxs("div",{className:"bg-white/10 rounded-lg p-6 border border-white/20",children:[Te.jsx("p",{className:"text-blue-200 mb-4",children:"Spell system coming soon!"}),Te.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Te.jsxs("div",{className:"bg-black/20 rounded-lg p-4",children:[Te.jsx("h3",{className:"text-white font-semibold mb-2",children:"Known Spells"}),Te.jsx("p",{className:"text-blue-200",children:"No spells learned yet"})]}),Te.jsxs("div",{className:"bg-black/20 rounded-lg p-4",children:[Te.jsx("h3",{className:"text-white font-semibold mb-2",children:"Spell Slots"}),Te.jsx("p",{className:"text-blue-200",children:"0 slots available"})]})]})]})]}),!["dashboard","character","lobby","waiting","game","party","world","combat","magic","dm-center"].includes(E)&&Te.jsx("div",{className:"h-full flex items-center justify-center",children:Te.jsxs("div",{className:"text-center",children:[Te.jsx("h2",{className:"text-3xl font-bold text-white mb-4",children:"Welcome to MythSeeker"}),Te.jsx("p",{className:"text-blue-200",children:"Use the navigation to get started!"})]})})]})]})})]})]})}),"dm-center"!==E&&Te.jsx(a.Suspense,{fallback:Te.jsx(fo,{}),children:Te.jsx(co,{isOpen:N,onClose:()=>k(!1),activeTab:ye,onTabChange:be,isMobile:A,campaign:$,messages:U,players:fe.players,worldState:te,achievements:se,onSendMessage:De,onUpdateSettings:e=>{},drawerWidth:je,setDrawerWidth:Ne,minWidth:320,maxWidth:600})})]}),Te.jsx(a.Suspense,{fallback:Te.jsx(fo,{}),children:Te.jsx(co,{isOpen:N,onClose:()=>k(!1),activeTab:ye,onTabChange:be,isMobile:A,campaign:$,messages:U,players:fe.players,worldState:te,achievements:se,onSendMessage:De,onUpdateSettings:e=>{},drawerWidth:je,setDrawerWidth:Ne,minWidth:320,maxWidth:600})}),Te.jsx(uo,{onToggleDrawer:()=>k(!N),isDrawerOpen:N,onQuickAction:e=>{be(e),k(!0)},isMobile:A,hasNotifications:U.length>0,notificationCount:U.filter(e=>"system"===e.type).length}),Te.jsx(a.Suspense,{fallback:Te.jsx(fo,{}),children:Te.jsx(so,{active:v,onNavigate:Pe,theme:q,isMobile:!0,onToggleMobile:()=>S(!C)})}),Te.jsx(a.Suspense,{fallback:Te.jsx(fo,{}),children:Te.jsx(ho,{isOpen:c,onClose:()=>d(!1)})}),Te.jsx(a.Suspense,{fallback:Te.jsx(fo,{}),children:Te.jsx(mo,{isOpen:c,onClose:()=>d(!1),currentScreen:u,onAction:(e,t)=>{switch(e){case"close":d(!1);break;case"navigate":h(t.screen)}no.trackUserAction("help_action",{action:e,data:t})}})}),lastPersonaUpdate>0&&Date.now()-lastPersonaUpdate<5e3&&Te.jsx("div",{className:"fixed top-4 right-4 z-50 bg-blue-700 text-white px-4 py-2 rounded shadow-lg animate-pulse",children:"AI DM Persona Updated!"})]}))},bo=({playerName:e,classes:t,onCreateCharacter:n,joinCode:r})=>{const[s,i]=a.useState(null),[o,l]=a.useState(e),[c,d]=a.useState(""),[u,h]=a.useState(null),[m,p]=a.useState({}),[g,f]=a.useState(!1),[x,y]=a.useState(1),[b,w]=a.useState(!1),v=["fuck","shit","bitch","asshole","bastard","dick","cunt","piss","cock","fag","slut","whore"],j=e=>{if(!e)return!1;const t=e.toLowerCase();return v.some(e=>t.includes(e))},N=()=>{let e=0;return o.trim()&&(e+=40),s&&(e+=40),c.trim()&&(e+=20),e},k=u||s,C=o.trim().length>0&&!m.name,S=null!==s&&!m.class,A=0===c.length||!m.backstory&&c.trim().length>0;return Te.jsxs("div",{className:"space-y-6 character-creation",children:[Te.jsxs("div",{className:"bg-white/10 rounded-xl p-4 mb-6",children:[Te.jsxs("div",{className:"flex items-center justify-between mb-3",children:[Te.jsx("h3",{className:"text-white font-semibold",children:"Character Creation Progress"}),Te.jsxs("span",{className:"text-blue-300 text-sm",children:[N(),"% Complete"]})]}),Te.jsx("div",{className:"w-full bg-white/20 rounded-full h-2 mb-4",children:Te.jsx("div",{className:"bg-gradient-to-r from-green-500 to-blue-500 h-2 rounded-full transition-all duration-500 ease-out",style:{width:`${N()}%`}})}),Te.jsxs("div",{className:"flex items-center justify-between text-sm",children:[Te.jsxs("div",{className:"flex items-center space-x-2 "+(C?"text-green-400":o.trim()?"text-yellow-400":"text-gray-400"),children:[Te.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold "+(C?"bg-green-500":o.trim()?"bg-yellow-500":"bg-gray-500"),children:C?"âœ“":"1"}),Te.jsx("span",{children:"Name"})]}),Te.jsxs("div",{className:"flex items-center space-x-2 "+(S?"text-green-400":s?"text-yellow-400":"text-gray-400"),children:[Te.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold "+(S?"bg-green-500":s?"bg-yellow-500":"bg-gray-500"),children:S?"âœ“":"2"}),Te.jsx("span",{children:"Class"})]}),Te.jsxs("div",{className:"flex items-center space-x-2 "+(A?"text-green-400":c.trim()?"text-yellow-400":"text-gray-400"),children:[Te.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold "+(A?"bg-green-500":c.trim()?"bg-yellow-500":"bg-gray-500"),children:A?"âœ“":"3"}),Te.jsx("span",{children:"Story"})]})]})]}),b&&Te.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center",children:Te.jsxs("div",{className:"bg-gradient-to-br from-purple-900/90 to-blue-900/90 rounded-2xl p-8 max-w-md mx-4 text-center border border-purple-500/50",children:[Te.jsx("div",{className:"text-6xl mb-4 animate-bounce",children:null==s?void 0:s.icon}),Te.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Character Created!"}),Te.jsxs("p",{className:"text-purple-200 mb-4",children:[o," the ",null==s?void 0:s.name," is ready for adventure!"]}),Te.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-purple-300/30 border-t-purple-400 rounded-full mx-auto"})]})}),Te.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-8",children:[Te.jsxs("div",{className:"space-y-4 lg:space-y-6",children:[Te.jsxs("div",{className:"transition-all duration-300 "+(1===x?"ring-2 ring-blue-400 rounded-xl p-4":""),children:[Te.jsxs("label",{className:"block text-white font-semibold mb-2 lg:mb-3 text-sm lg:text-base flex items-center space-x-2",children:[Te.jsx("span",{className:"bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold",children:"1"}),Te.jsx("span",{children:"Character Name"}),C&&Te.jsx("span",{className:"text-green-400",children:"âœ“"})]}),Te.jsx("input",{type:"text",placeholder:"Enter your hero's name...",value:o,onChange:e=>{l(e.target.value),1===x&&e.target.value.trim()&&setTimeout(()=>y(2),500)},onFocus:()=>y(1),className:"w-full px-3 lg:px-4 py-2 lg:py-3 rounded-xl bg-white/20 text-white placeholder-blue-200 border transition-all duration-300 focus:outline-none text-sm lg:text-base "+(m.name?"border-red-400 focus:border-red-400":C?"border-green-400 focus:border-green-400":"border-white/30 focus:border-blue-400")}),m.name&&Te.jsx("div",{className:"text-red-400 text-xs mt-1 animate-pulse",children:m.name}),C&&!m.name&&Te.jsxs("div",{className:"text-green-400 text-xs mt-1 flex items-center space-x-1",children:[Te.jsx("span",{children:"âœ“"}),Te.jsx("span",{children:"Great name choice!"})]})]}),Te.jsxs("div",{className:"transition-all duration-300 "+(2===x?"ring-2 ring-blue-400 rounded-xl p-4":""),children:[Te.jsxs("label",{className:"block text-white font-semibold mb-2 lg:mb-3 text-sm lg:text-base flex items-center space-x-2",children:[Te.jsx("span",{className:"bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold",children:"2"}),Te.jsx("span",{children:"Choose Your Class"}),S&&Te.jsx("span",{className:"text-green-400",children:"âœ“"})]}),Te.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 lg:gap-4 class-grid",children:t.map(e=>Te.jsx("div",{onClick:()=>{i(e),2===x&&setTimeout(()=>y(3),500)},onFocus:()=>y(2),onMouseEnter:()=>h(e),onMouseLeave:()=>h(null),className:"class-card p-3 lg:p-4 rounded-xl border-2 cursor-pointer transition-all duration-300 transform "+((null==s?void 0:s.name)===e.name?"border-green-400 bg-green-500/30 shadow-lg scale-105 selected":(null==u?void 0:u.name)===e.name?"border-blue-400 bg-blue-500/20 shadow-md scale-102":"border-white/30 bg-white/10 hover:border-white/50 hover:scale-102"),children:Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-2xl lg:text-3xl mb-2 transition-transform duration-300 hover:scale-110",children:e.icon}),Te.jsx("h3",{className:"text-white font-semibold text-sm lg:text-base mb-2",children:e.name}),Te.jsxs("div",{className:"text-xs text-blue-200 space-y-1 mb-2",children:[Te.jsxs("div",{className:"flex justify-between",children:[Te.jsxs("span",{children:["STR: ",e.stats.strength]}),Te.jsx("span",{className:"text-yellow-300",children:"Attack Power"})]}),Te.jsxs("div",{className:"flex justify-between",children:[Te.jsxs("span",{children:["DEX: ",e.stats.dexterity]}),Te.jsx("span",{className:"text-green-300",children:"Agility"})]}),Te.jsxs("div",{className:"flex justify-between",children:[Te.jsxs("span",{children:["INT: ",e.stats.intelligence]}),Te.jsx("span",{className:"text-purple-300",children:"Magic"})]}),Te.jsxs("div",{className:"flex justify-between",children:[Te.jsxs("span",{children:["CHA: ",e.stats.charisma]}),Te.jsx("span",{className:"text-pink-300",children:"Social"})]})]}),(null==s?void 0:s.name)===e.name&&Te.jsxs("div",{className:"flex items-center justify-center space-x-1 text-green-400 text-xs animate-pulse",children:[Te.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),Te.jsx("span",{children:"Selected"})]})]})},e.name))}),m.class&&Te.jsx("div",{className:"text-red-400 text-xs mt-1 animate-pulse",children:m.class}),S&&!m.class&&Te.jsxs("div",{className:"text-green-400 text-xs mt-1 flex items-center space-x-1",children:[Te.jsx("span",{children:"âœ“"}),Te.jsxs("span",{children:["Excellent choice! ",s.name," is a powerful class."]})]})]}),Te.jsxs("div",{className:"transition-all duration-300 "+(3===x?"ring-2 ring-blue-400 rounded-xl p-4":""),children:[Te.jsxs("label",{className:"block text-white font-semibold mb-2 lg:mb-3 text-sm lg:text-base flex items-center space-x-2",children:[Te.jsx("span",{className:"bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold",children:"3"}),Te.jsx("span",{children:"Character Backstory"}),Te.jsx("span",{className:"text-blue-300 text-xs",children:"(Optional)"}),A&&Te.jsx("span",{className:"text-green-400",children:"âœ“"})]}),Te.jsx("div",{className:"mb-3 flex flex-wrap gap-2",children:["What is your character's greatest fear?","Where did they grow up?","What brought them to adventure?","Who is their closest friend?","What do they value most?"].map((e,t)=>Te.jsx("button",{onClick:()=>{d(t=>t?`${t}\n\n${e}`:e),y(3)},className:"px-2 py-1 bg-blue-600/30 text-blue-200 text-xs rounded hover:bg-blue-600/50 transition-all transform hover:scale-105",children:e},t))}),Te.jsx("textarea",{value:c,onChange:e=>{d(e.target.value),y(3)},onFocus:()=>y(3),placeholder:"Describe your character's background, motivations, and personality... (Click prompts above for inspiration)",className:"w-full px-3 lg:px-4 py-2 lg:py-3 rounded-xl bg-white/20 text-white placeholder-blue-200 border transition-all duration-300 focus:outline-none h-24 lg:h-32 resize-none text-sm lg:text-base "+(m.backstory?"border-red-400 focus:border-red-400":A&&c.trim()?"border-green-400 focus:border-green-400":"border-white/30 focus:border-blue-400")}),m.backstory&&Te.jsx("div",{className:"text-red-400 text-xs mt-1 animate-pulse",children:m.backstory}),A&&c.trim()&&!m.backstory&&Te.jsxs("div",{className:"text-green-400 text-xs mt-1 flex items-center space-x-1",children:[Te.jsx("span",{children:"âœ“"}),Te.jsx("span",{children:"Great backstory! This will enhance your roleplay experience."})]})]}),Te.jsx("button",{onClick:()=>{(()=>{f(!0);const e={};return o.trim()?o.length>50?e.name="Character name must be 50 characters or less.":j(o)&&(e.name="Please choose a more appropriate name."):e.name="Character name is required.",s||(e.class="Character class is required."),c.length>0&&j(c)?e.backstory="Please remove inappropriate language from the backstory.":c.length>500&&(e.backstory="Backstory must be 500 characters or less."),p(e),setTimeout(()=>f(!1),500),0===Object.keys(e).length})()&&(w(!0),setTimeout(()=>{n({name:o.trim(),class:s.name,backstory:c.trim()})},1500))},disabled:!s||!o.trim()||g,className:"w-full px-4 lg:px-6 py-3 rounded-xl font-semibold transition-all duration-300 text-sm lg:text-base transform "+(s&&o.trim()&&!g?"bg-gradient-to-r from-green-600 to-blue-600 text-white hover:from-green-700 hover:to-blue-700 shadow-lg hover:scale-105 hover:shadow-xl":"bg-gray-600 text-gray-300 cursor-not-allowed opacity-50"),children:g?Te.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[Te.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white/30 border-t-white rounded-full"}),Te.jsx("span",{children:"Validating..."})]}):s&&o.trim()?`Create ${o} the ${s.name}`:"Complete required fields to create character"})]}),Te.jsxs("div",{className:"bg-white/10 rounded-xl p-4 lg:p-6 transition-all duration-300",children:[Te.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:k?`Class Preview: ${k.name}`:"Select a Class"}),k?Te.jsxs("div",{className:"space-y-4",children:[Te.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[Te.jsx("div",{className:"text-4xl animate-pulse",children:k.icon}),Te.jsxs("div",{children:[Te.jsx("h4",{className:"text-lg font-semibold text-white",children:k.name}),Te.jsx("p",{className:"text-blue-200 text-sm",children:"Master of tactical combat"})]})]}),o.trim()&&Te.jsxs("div",{className:"bg-gradient-to-r from-purple-900/50 to-blue-900/50 rounded-lg p-4 border border-purple-500/30",children:[Te.jsxs("h5",{className:"text-white font-semibold mb-2 flex items-center space-x-2",children:[Te.jsx("span",{children:"âœ¨"}),Te.jsx("span",{children:"Character Preview"})]}),Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-3xl mb-2",children:k.icon}),Te.jsx("p",{className:"text-lg font-bold text-white",children:o}),Te.jsxs("p",{className:"text-blue-300",children:["Level 1 ",k.name]}),Te.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-xs",children:[Te.jsx("div",{className:"bg-red-500/20 rounded px-2 py-1",children:Te.jsx("span",{className:"text-red-300",children:"â¤ï¸ Health: 100"})}),Te.jsx("div",{className:"bg-blue-500/20 rounded px-2 py-1",children:Te.jsx("span",{className:"text-blue-300",children:"âœ¨ Mana: 50"})})]})]})]}),Te.jsxs("div",{className:"bg-black/20 rounded-lg p-3",children:[Te.jsx("h5",{className:"text-white font-semibold mb-2",children:"Class Description"}),Te.jsxs("p",{className:"text-blue-200 text-sm leading-relaxed",children:["Warrior"===k.name&&"A mighty warrior skilled in close combat, wielding powerful weapons and wearing heavy armor. Your strength and endurance make you the frontline defender of your party.","Rogue"===k.name&&"A stealthy rogue who excels at sneaking, lockpicking, and dealing devastating sneak attacks. Your agility and cunning allow you to strike from the shadows.","Mage"===k.name&&"A powerful spellcaster who harnesses the arcane arts to cast devastating spells. Your intelligence and magical prowess make you a force to be reckoned with.","Cleric"===k.name&&"A divine spellcaster who channels the power of the gods to heal allies and smite enemies. Your faith and charisma make you an invaluable support.","Ranger"===k.name&&"A skilled hunter and tracker who excels at ranged combat and wilderness survival. Your dexterity and knowledge of nature make you a versatile adventurer.","Bard"===k.name&&"A charismatic performer who uses music and magic to inspire allies and charm enemies. Your creativity and social skills make you the heart of any party."]})]}),Te.jsxs("div",{className:"bg-black/20 rounded-lg p-3",children:[Te.jsx("h5",{className:"text-white font-semibold mb-2",children:"Starting Equipment"}),Te.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[Te.jsxs("div",{className:"flex items-center space-x-2",children:[Te.jsx("span",{className:"text-yellow-400",children:"âš”ï¸"}),Te.jsx("span",{className:"text-blue-200",children:"Iron Sword"})]}),Te.jsxs("div",{className:"flex items-center space-x-2",children:[Te.jsx("span",{className:"text-brown-400",children:"ðŸ›¡ï¸"}),Te.jsx("span",{className:"text-blue-200",children:"Leather Armor"})]}),Te.jsxs("div",{className:"flex items-center space-x-2",children:[Te.jsx("span",{className:"text-red-400",children:"ðŸ§ª"}),Te.jsx("span",{className:"text-blue-200",children:"3x Healing Potions"})]}),Te.jsxs("div",{className:"flex items-center space-x-2",children:[Te.jsx("span",{className:"text-yellow-400",children:"ðŸ’°"}),Te.jsx("span",{className:"text-blue-200",children:"100 Gold Pieces"})]})]})]}),Te.jsxs("div",{className:"bg-black/20 rounded-lg p-3",children:[Te.jsx("h5",{className:"text-white font-semibold mb-2",children:"Class Abilities"}),Te.jsx("div",{className:"space-y-2 text-sm",children:k.skills&&Object.entries(k.skills).slice(0,3).map(([e,t])=>Te.jsxs("div",{className:"flex justify-between items-center",children:[Te.jsx("span",{className:"text-blue-200 capitalize",children:e.replace(/([A-Z])/g," $1").trim()}),Te.jsx("div",{className:"flex items-center space-x-1",children:[...Array(5)].map((e,a)=>Te.jsx("div",{className:"w-2 h-2 rounded-full "+(a<t?"bg-yellow-400":"bg-gray-600")},a))})]},e))})]})]}):Te.jsxs("div",{className:"text-center text-blue-200 py-8",children:[Te.jsx("div",{className:"text-4xl mb-4 opacity-50",children:"ðŸŽ­"}),Te.jsx("p",{children:"Select a class to see detailed information"})]})]})]})]})},wo=({campaigns:e,campaignThemes:t,onCreateCampaign:n,character:r,onDeleteCampaign:s,onJoinCampaign:o,onResumeCampaign:l,onPauseCampaign:c})=>{var d;const[u,h]=a.useState(!1),[m,p]=a.useState(!1),[g,f]=a.useState(null),[x,y]=a.useState(""),[b,w]=a.useState(""),[v,j]=a.useState(!0),[N,k]=a.useState({}),[C,S]=a.useState(""),[A,T]=a.useState("all"),[E,P]=a.useState("date"),[M,I]=a.useState("grid"),D=["fuck","shit","bitch","asshole","bastard","dick","cunt","piss","cock","fag","slut","whore"],R=e=>{l&&l(e)},$=i.useMemo(()=>{let t=e.filter(e=>{var t;const a=e.theme.toLowerCase().includes(C.toLowerCase())||(null==(t=e.customPrompt)?void 0:t.toLowerCase().includes(C.toLowerCase()));let n=!0;return"all"!==A&&(n="not-started"===A?!e.started:e.status===A),a&&n});return t.sort((e,t)=>{var a,n;switch(E){case"name":return e.theme.localeCompare(t.theme);case"status":const r=e=>e.started?"active"===e.status?1:"paused"===e.status?2:4:3;return r(e)-r(t);case"players":return((null==(a=t.players)?void 0:a.length)||0)-((null==(n=e.players)?void 0:n.length)||0);default:return new Date(t.createdAt||0).getTime()-new Date(e.createdAt||0).getTime()}}),t},[e,C,A,E]),L=e=>e.started?"active"===e.status||!e.status&&e.started?"In Progress":"paused"===e.status?"Paused":"Unknown":"Not Started",O=e=>e.started?"active"===e.status||!e.status&&e.started?"text-green-400":"paused"===e.status?"text-yellow-400":"text-gray-400":"text-gray-400",_=e=>{const a=t.find(t=>t.name===e);return(null==a?void 0:a.icon)||"ðŸŽ²"},U=e=>({Fantasy:"from-emerald-600 to-teal-600","Sci-Fi":"from-blue-600 to-cyan-600",Horror:"from-red-600 to-orange-600",Mystery:"from-purple-600 to-indigo-600",Western:"from-yellow-600 to-orange-600",Modern:"from-gray-600 to-blue-600","Post-Apocalyptic":"from-orange-600 to-red-600",Steampunk:"from-amber-600 to-yellow-600"}[e]||"from-blue-600 to-purple-600");return u?Te.jsxs("div",{className:"space-y-6 animate-slide-up",children:[Te.jsxs("div",{className:"flex justify-between items-center",children:[Te.jsxs("div",{children:[Te.jsx("h3",{className:"text-2xl lg:text-3xl font-bold text-white",children:"Create New Campaign"}),Te.jsx("p",{className:"text-blue-200 mt-1",children:"Choose a theme and customize your adventure"})]}),Te.jsxs("button",{onClick:()=>h(!1),className:"px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-all flex items-center space-x-2",children:[Te.jsx("span",{children:"â†"}),Te.jsx("span",{children:"Back"})]})]}),Te.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 theme-grid",children:t.map(e=>Te.jsx("div",{onClick:()=>f(e),className:"group p-6 rounded-xl border-2 cursor-pointer transition-all duration-300 transform hover:scale-105 "+((null==g?void 0:g.name)===e.name?"border-blue-400 bg-gradient-to-br from-blue-500/30 to-purple-500/30 shadow-xl scale-105":"border-white/30 bg-white/10 hover:border-white/50 hover:bg-white/20"),children:Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-4xl mb-3 group-hover:scale-110 transition-transform duration-300",children:e.icon}),Te.jsx("h4",{className:"text-white font-bold mb-2 text-lg",children:e.name}),Te.jsx("p",{className:"text-blue-200 text-sm leading-relaxed",children:e.description}),(null==g?void 0:g.name)===e.name&&Te.jsxs("div",{className:"mt-3 flex items-center justify-center space-x-1 text-blue-400 text-sm animate-pulse",children:[Te.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),Te.jsx("span",{children:"Selected"})]})]})},e.name))}),N.theme&&Te.jsx("div",{className:"text-red-400 text-sm animate-pulse",children:N.theme}),Te.jsxs("div",{className:"bg-white/10 rounded-xl p-6 border border-white/20",children:[Te.jsx("label",{className:"block text-white font-semibold mb-3",children:"Custom Campaign Prompt (Optional)"}),Te.jsx("textarea",{value:x,onChange:e=>y(e.target.value),placeholder:"Add specific details, themes, or story elements you want the AI to include in your campaign...",className:"w-full px-4 py-3 rounded-xl bg-white/20 text-white placeholder-blue-200 border border-white/30 focus:outline-none focus:border-blue-400 h-32 resize-none"}),Te.jsxs("div",{className:"flex justify-between items-center mt-2",children:[N.customPrompt&&Te.jsx("div",{className:"text-red-400 text-sm animate-pulse",children:N.customPrompt}),Te.jsxs("div",{className:"text-xs text-gray-400 ml-auto",children:[x.length,"/1000 characters"]})]})]}),Te.jsxs("div",{className:"bg-white/10 rounded-xl p-6 border border-white/20",children:[Te.jsxs("div",{className:"flex items-center space-x-3",children:[Te.jsx("input",{type:"checkbox",id:"multiplayer",checked:v,onChange:e=>j(e.target.checked),className:"w-5 h-5 text-blue-600 bg-white/20 border-white/30 rounded focus:ring-blue-500"}),Te.jsx("label",{htmlFor:"multiplayer",className:"text-white font-medium",children:"Multiplayer Campaign (up to 6 players)"})]}),Te.jsx("p",{className:"text-blue-200 text-sm mt-2 ml-8",children:v?"Others can join using the campaign code":"Solo adventure - just you and the AI"})]}),Te.jsx("button",{onClick:()=>{(()=>{const e={};return g||(e.theme="Campaign theme is required."),x.length>1e3?e.customPrompt="Custom prompt must be 1000 characters or less.":x.length>0&&(e=>{if(!e)return!1;const t=e.toLowerCase();return D.some(e=>t.includes(e))})(x)&&(e.customPrompt="Please remove inappropriate language from the custom prompt."),k(e),0===Object.keys(e).length})()&&(n(g,x,v),h(!1),f(null),y(""))},disabled:!g,className:"w-full px-6 py-4 rounded-xl font-bold text-lg transition-all duration-300 transform "+(g?`bg-gradient-to-r ${U(g.name)} text-white hover:shadow-xl hover:scale-105`:"bg-gray-600 text-gray-300 cursor-not-allowed opacity-50"),children:g?`Create ${g.name} Campaign ${v?"(Multiplayer)":"(Solo)"}`:"Select a theme to continue"})]}):m?Te.jsxs("div",{className:"space-y-6 animate-slide-up",children:[Te.jsxs("div",{className:"flex justify-between items-center",children:[Te.jsxs("div",{children:[Te.jsx("h3",{className:"text-2xl lg:text-3xl font-bold text-white",children:"Join Campaign"}),Te.jsx("p",{className:"text-blue-200 mt-1",children:"Enter a campaign code to join an existing adventure"})]}),Te.jsxs("button",{onClick:()=>p(!1),className:"px-4 py-2 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-all flex items-center space-x-2",children:[Te.jsx("span",{children:"â†"}),Te.jsx("span",{children:"Back"})]})]}),Te.jsx("div",{className:"w-full max-w-lg mx-auto",children:Te.jsxs("div",{className:"bg-white/10 rounded-xl p-8 border border-white/20 text-center",children:[Te.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ¯"}),Te.jsx("h4",{className:"text-xl font-bold text-white mb-4",children:"Join Adventure"}),Te.jsxs("div",{className:"space-y-4",children:[Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-white font-semibold mb-3",children:"Campaign Code"}),Te.jsx("input",{type:"text",value:b,onChange:e=>w(e.target.value.toUpperCase()),placeholder:"ABC123",className:"w-full px-4 py-4 rounded-xl bg-white/20 text-white placeholder-blue-200 border border-white/30 focus:outline-none focus:border-blue-400 text-center text-2xl font-mono tracking-wider",maxLength:6}),Te.jsx("p",{className:"text-blue-200 text-sm mt-2",children:"Ask your Game Master for the 6-character code"})]}),Te.jsx("button",{onClick:()=>{b.trim()&&o&&(o(b.trim()),w(""),p(!1))},disabled:!b.trim()||6!==b.length,className:"w-full px-6 py-4 rounded-xl font-bold text-lg transition-all duration-300 transform "+(b.trim()&&6===b.length?"bg-gradient-to-r from-green-600 to-blue-600 text-white hover:shadow-xl hover:scale-105":"bg-gray-600 text-gray-300 cursor-not-allowed opacity-50"),children:6===b.length?`Join Campaign ${b}`:"Enter Campaign Code"})]})]})})]}):Te.jsxs("div",{className:"space-y-6 campaign-lobby",children:[Te.jsxs("div",{className:"text-center mb-8",children:[Te.jsx("h2",{className:"text-4xl font-bold text-white mb-3 drop-shadow-lg",children:"Campaign Lobby"}),Te.jsxs("div",{className:"flex items-center justify-center space-x-3 text-blue-100",children:[Te.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold",children:(null==(d=null==r?void 0:r.name)?void 0:d.charAt(0))||"A"}),Te.jsxs("p",{className:"text-lg",children:["Welcome, ",Te.jsx("span",{className:"font-semibold text-white",children:null==r?void 0:r.name})," the Level ",null==r?void 0:r.level," ",null==r?void 0:r.class,"!"]})]})]}),Te.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8",children:[Te.jsx("button",{onClick:()=>h(!0),className:"group p-6 bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105",children:Te.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[Te.jsx("div",{className:"p-2 bg-white/20 rounded-full group-hover:scale-110 transition-transform duration-300",children:Te.jsx(me,{size:24})}),Te.jsxs("div",{className:"text-left",children:[Te.jsx("div",{children:"Create New Campaign"}),Te.jsx("div",{className:"text-emerald-100 text-sm font-normal",children:"Start a fresh adventure"})]})]})}),Te.jsx("button",{onClick:()=>p(!0),className:"group p-6 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105",children:Te.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[Te.jsx("div",{className:"p-2 bg-white/20 rounded-full group-hover:scale-110 transition-transform duration-300",children:Te.jsx(J,{size:24})}),Te.jsxs("div",{className:"text-left",children:[Te.jsx("div",{children:"Join Campaign"}),Te.jsx("div",{className:"text-blue-100 text-sm font-normal",children:"Use a campaign code"})]})]})})]}),e.length>0&&Te.jsxs("div",{className:"space-y-6",children:[Te.jsx("div",{className:"bg-white/10 rounded-xl p-4 border border-white/20",children:Te.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0",children:[Te.jsxs("div",{className:"flex items-center space-x-4",children:[Te.jsx("h3",{className:"text-xl font-bold text-white",children:"Your Campaigns"}),Te.jsxs("span",{className:"px-3 py-1 bg-blue-600/30 text-blue-200 rounded-full text-sm font-medium",children:[$.length," of ",e.length]})]}),Te.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3",children:[Te.jsx("input",{type:"text",placeholder:"Search campaigns...",value:C,onChange:e=>S(e.target.value),className:"px-4 py-2 bg-white/10 text-white placeholder-gray-300 rounded-lg border border-white/20 focus:outline-none focus:border-blue-400"}),Te.jsxs("select",{value:A,onChange:e=>T(e.target.value),className:"px-4 py-2 bg-white/10 text-white rounded-lg border border-white/20 focus:outline-none focus:border-blue-400",children:[Te.jsx("option",{value:"all",children:"All Status"}),Te.jsx("option",{value:"active",children:"Active"}),Te.jsx("option",{value:"paused",children:"Paused"}),Te.jsx("option",{value:"not-started",children:"Not Started"})]}),Te.jsxs("select",{value:E,onChange:e=>P(e.target.value),className:"px-4 py-2 bg-white/10 text-white rounded-lg border border-white/20 focus:outline-none focus:border-blue-400",children:[Te.jsx("option",{value:"date",children:"Sort by Date"}),Te.jsx("option",{value:"name",children:"Sort by Name"}),Te.jsx("option",{value:"status",children:"Sort by Status"}),Te.jsx("option",{value:"players",children:"Sort by Players"})]}),Te.jsxs("div",{className:"flex border border-white/20 rounded-lg overflow-hidden",children:[Te.jsx("button",{onClick:()=>I("grid"),className:`px-3 py-2 ${"grid"===M?"bg-blue-600 text-white":"bg-white/10 text-blue-200"} transition-colors`,children:"âŠž"}),Te.jsx("button",{onClick:()=>I("list"),className:`px-3 py-2 ${"list"===M?"bg-blue-600 text-white":"bg-white/10 text-blue-200"} transition-colors`,children:"â˜°"})]})]})]})}),Te.jsx("div",{className:"grid"===M?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6":"space-y-4",children:$.map(e=>{var t,a,n,r,i,o;return Te.jsxs("div",{className:"group relative bg-white/10 backdrop-blur-sm rounded-xl border border-white/20 hover:border-blue-400/50 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 "+("list"===M?"p-4 flex items-center space-x-4":"p-6"),children:[Te.jsxs("div",{className:`absolute ${"list"===M?"left-2 top-1/2 transform -translate-y-1/2":"top-4 right-4"} flex items-center space-x-2`,children:[Te.jsx("div",{className:"w-3 h-3 rounded-full "+(e.started?"active"===e.status?"bg-green-400":"paused"===e.status?"bg-orange-400":"bg-gray-400":"bg-yellow-400 animate-pulse")}),"list"===M&&Te.jsx("span",{className:`text-xs font-medium ${O(e)}`,children:L(e)})]}),Te.jsxs("div",{className:"list"===M?"flex-1":"",children:[Te.jsxs("div",{className:"list"===M?"flex items-center space-x-4":"mb-4",children:[Te.jsxs("div",{className:"list"===M?"flex items-center space-x-3":"flex items-center space-x-3 mb-2",children:[Te.jsx("div",{className:`p-2 bg-gradient-to-r ${U(e.theme)} rounded-lg`,children:Te.jsx("span",{className:"text-xl",children:_(e.theme)})}),Te.jsxs("div",{children:[Te.jsx("h4",{className:"text-lg font-bold text-white",children:e.theme}),"grid"===M&&Te.jsxs("p",{className:`text-sm font-medium ${O(e)}`,children:[L(e)," â€¢ ",(null==(t=e.players)?void 0:t.length)||0," player",1!==((null==(a=e.players)?void 0:a.length)||0)?"s":""]})]})]}),"list"===M&&Te.jsxs("div",{className:"text-right",children:[Te.jsxs("div",{className:"text-blue-200 text-sm",children:[(null==(n=e.players)?void 0:n.length)||0," players"]}),Te.jsxs("div",{className:"text-gray-400 text-xs",children:[(null==(r=e.messages)?void 0:r.length)||0," messages"]})]})]}),!e.started&&e.isMultiplayer&&"grid"===M&&Te.jsx("div",{className:"mb-4 p-3 bg-yellow-900/30 rounded-lg border border-yellow-500/30",children:Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("div",{children:[Te.jsx("span",{className:"text-yellow-300 text-sm font-medium",children:"Campaign Code:"}),Te.jsx("code",{className:"ml-2 bg-yellow-900/50 text-yellow-200 px-2 py-1 rounded text-sm font-mono",children:e.code})]}),Te.jsx("button",{onClick:t=>{t.stopPropagation(),navigator.clipboard.writeText(e.code)},className:"text-yellow-300 hover:text-yellow-100 transition-colors p-1",title:"Copy campaign code",children:Te.jsx(pe,{size:16})})]})}),e.started&&"grid"===M&&Te.jsxs("div",{className:"mb-4",children:[Te.jsxs("div",{className:"flex justify-between text-sm text-white mb-2",children:[Te.jsx("span",{children:"Adventure Progress"}),Te.jsxs("span",{children:[(null==(i=e.messages)?void 0:i.length)||0," messages"]})]}),Te.jsx("div",{className:"w-full bg-white/20 rounded-full h-2",children:Te.jsx("div",{className:`bg-gradient-to-r ${U(e.theme)} h-2 rounded-full transition-all duration-500`,style:{width:`${Math.min(2*((null==(o=e.messages)?void 0:o.length)||0),100)}%`}})})]})]}),Te.jsxs("div",{className:"list"===M?"flex space-x-2":"flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.started&&Te.jsxs("button",{onClick:t=>{t.stopPropagation(),R(e.id)},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all text-sm font-medium flex items-center space-x-1",title:"paused"===e.status?"Resume Campaign":"Continue Campaign",children:[Te.jsx("span",{children:"â–¶"}),Te.jsx("span",{children:"paused"===e.status?"Resume":"Continue"})]}),!e.started&&Te.jsxs("button",{onClick:t=>{t.stopPropagation(),R(e.id)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all text-sm font-medium flex items-center space-x-1",title:"Start Campaign",children:[Te.jsx("span",{children:"ðŸš€"}),Te.jsx("span",{children:"Start"})]}),Te.jsx("button",{onClick:t=>{var a;t.stopPropagation(),a=e.id,window.confirm("Are you sure you want to delete this campaign? This action cannot be undone.")&&(null==s||s(a))},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all text-sm font-medium",title:"Delete Campaign",children:Te.jsx(ge,{size:16})})]})]},e.id)})}),0===$.length&&e.length>0&&Te.jsxs("div",{className:"text-center py-12",children:[Te.jsx("div",{className:"text-6xl mb-4 opacity-50",children:"ðŸ”"}),Te.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"No campaigns match your filters"}),Te.jsx("p",{className:"text-blue-200",children:"Try adjusting your search or filter settings"}),Te.jsx("button",{onClick:()=>{S(""),T("all")},className:"mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all",children:"Clear Filters"})]})]}),0===e.length&&Te.jsxs("div",{className:"text-center py-12",children:[Te.jsx("div",{className:"text-8xl mb-6 opacity-50",children:"ðŸ°"}),Te.jsx("h3",{className:"text-3xl font-bold text-white mb-4",children:"Ready for Adventure?"}),Te.jsx("p",{className:"text-blue-200 text-lg mb-8 max-w-2xl mx-auto",children:"Your epic journey awaits! Create your first campaign or join an existing one to begin your adventure in the realms of MythSeeker."}),Te.jsxs("div",{className:"flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4",children:[Te.jsx("button",{onClick:()=>h(!0),className:"px-8 py-4 bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-xl hover:from-emerald-700 hover:to-teal-700 transition-all font-bold text-lg shadow-lg transform hover:scale-105",children:"ðŸŽ² Create Your First Campaign"}),Te.jsx("button",{onClick:()=>p(!0),className:"px-8 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all font-bold text-lg shadow-lg transform hover:scale-105",children:"ðŸ¤ Join Existing Campaign"})]})]})]})},vo=({campaign:e,onStart:t,onBack:n})=>{var r,s,i;const[o,l]=a.useState(0),[c,d]=a.useState(1);a.useEffect(()=>{if(null==e?void 0:e.players){const t=e.players.filter(e=>"ready"===e.status).length;l(t),d(e.players.length)}},[e]);const u=(null==(s=null==(r=null==e?void 0:e.players)?void 0:r[0])?void 0:s.isHost)||!1;return Te.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 text-white p-6",children:Te.jsxs("div",{className:"w-full",children:[Te.jsxs("div",{className:"text-center mb-8",children:[Te.jsx("h2",{className:"text-4xl font-bold mb-4",children:"Campaign Lobby"}),Te.jsxs("div",{className:"bg-white/10 rounded-lg p-4 inline-block",children:[Te.jsx("p",{className:"text-lg mb-2",children:"Campaign Code:"}),Te.jsx("div",{className:"font-mono text-3xl bg-white/20 px-6 py-3 rounded-lg border border-white/30",children:(null==e?void 0:e.code)||"LOADING"}),Te.jsx("p",{className:"text-blue-200 text-sm mt-2",children:"Share this code with other players"})]})]}),Te.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[Te.jsxs("div",{className:"bg-white/10 rounded-lg p-6 border border-white/20",children:[Te.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Campaign Details"}),Te.jsxs("div",{className:"space-y-2",children:[Te.jsxs("p",{children:[Te.jsx("span",{className:"text-blue-200",children:"Theme:"})," ",(null==e?void 0:e.theme)||"Unknown"]}),Te.jsxs("p",{children:[Te.jsx("span",{className:"text-blue-200",children:"Max Players:"})," ",(null==e?void 0:e.maxPlayers)||6]}),Te.jsxs("p",{children:[Te.jsx("span",{className:"text-blue-200",children:"Type:"})," ",(null==e?void 0:e.isMultiplayer)?"Multiplayer":"Solo"]}),(null==e?void 0:e.customPrompt)&&Te.jsxs("p",{children:[Te.jsx("span",{className:"text-blue-200",children:"Custom Story:"})," ",e.customPrompt]})]})]}),Te.jsxs("div",{className:"bg-white/10 rounded-lg p-6 border border-white/20",children:[Te.jsxs("h3",{className:"text-xl font-semibold mb-4",children:["Players (",c,"/",(null==e?void 0:e.maxPlayers)||6,")"]}),Te.jsx("div",{className:"space-y-3",children:(null==(i=null==e?void 0:e.players)?void 0:i.map((e,t)=>{var a,n;return Te.jsxs("div",{className:"flex items-center space-x-3",children:[Te.jsx("div",{className:"w-3 h-3 rounded-full "+("ready"===e.status?"bg-green-400":"bg-yellow-400")}),Te.jsxs("div",{className:"flex-1",children:[Te.jsx("p",{className:"font-medium",children:(null==(a=e.character)?void 0:a.name)||e.name}),Te.jsxs("p",{className:"text-sm text-blue-200",children:[(null==(n=e.character)?void 0:n.class)||"Unknown Class"," ",e.isHost?"(Host)":""]})]}),Te.jsx("div",{className:"px-3 py-1 rounded-full text-xs "+("ready"===e.status?"bg-green-600 text-white":"bg-yellow-600 text-white"),children:"ready"===e.status?"Ready":"Not Ready"})]},e.id||t)}))||Te.jsx("div",{className:"text-center text-blue-200 py-4",children:Te.jsx("p",{children:"Loading players..."})})})]})]}),Te.jsx("div",{className:"bg-gradient-to-r from-orange-600/20 to-yellow-600/20 rounded-lg p-6 border border-orange-400/30 mb-6",children:Te.jsxs("div",{className:"flex items-start space-x-4",children:[Te.jsx("div",{className:"text-3xl",children:"ðŸŽ¯"}),Te.jsxs("div",{className:"flex-1",children:[Te.jsx("h3",{className:"text-xl font-semibold text-orange-200 mb-2",children:"Turn-Based Multiplayer"}),Te.jsx("p",{className:"text-orange-100 mb-3",children:"You can start this multiplayer campaign solo! Other players can join during the game when it's their turn. Perfect for turn-based gameplay where friends hop in and out as needed."}),Te.jsxs("div",{className:"flex items-center space-x-2 text-sm text-orange-200",children:[Te.jsx("span",{children:"âœ¨"}),Te.jsx("span",{children:"Players can join mid-game using the campaign code"})]})]})]})}),Te.jsxs("div",{className:"flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4",children:[u&&Te.jsxs("button",{onClick:()=>{t(e)},className:"flex-1 px-8 py-4 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-xl font-bold text-lg transition-all transform hover:scale-105 shadow-lg",children:["ðŸš€ Start Adventure",1===c?" Solo":` (${o}/${c} Ready)`]}),!u&&Te.jsx("div",{className:"flex-1 px-8 py-4 bg-blue-600/50 text-white rounded-xl font-bold text-lg text-center",children:"Waiting for host to start..."}),Te.jsx("button",{onClick:n,className:"px-8 py-4 bg-gray-600 hover:bg-gray-700 text-white rounded-xl font-bold text-lg transition-all",children:"â† Back to Lobby"})]}),Te.jsxs("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-4",children:[Te.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[Te.jsx("h4",{className:"font-semibold mb-2",children:"ðŸ’¡ For Hosts"}),Te.jsx("p",{className:"text-sm text-blue-200",children:"You can start the campaign anytime! Other players can join later using the campaign code, making it perfect for flexible scheduling."})]}),Te.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[Te.jsx("h4",{className:"font-semibold mb-2",children:"ðŸŽ® For Players"}),Te.jsx("p",{className:"text-sm text-blue-200",children:"Even if the campaign has started, you can still join! Just use the campaign code and jump in when it's your turn or during a break in the action."})]})]})]})})};function jo(){return Te.jsxs(da,{children:[Te.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only absolute top-2 left-2 bg-blue-700 text-white px-4 py-2 rounded z-50",children:"Skip to main content"}),Te.jsx(Bs,{children:Te.jsxs(qt,{children:[Te.jsx(Ht,{path:"/",element:Te.jsx(yo,{})}),Te.jsx(Ht,{path:"/dashboard",element:Te.jsx(yo,{})}),Te.jsx(Ht,{path:"/characters",element:Te.jsx(yo,{})}),Te.jsx(Ht,{path:"/characters/create",element:Te.jsx(yo,{})}),Te.jsx(Ht,{path:"/campaigns",element:Te.jsx(yo,{})}),Te.jsx(Ht,{path:"/campaigns/:id",element:Te.jsx(yo,{})}),Te.jsx(Ht,{path:"/campaigns/:id/waiting",element:Te.jsx(yo,{})}),Te.jsx(Ht,{path:"/party",element:Te.jsx(yo,{})}),Te.jsx(Ht,{path:"/world",element:Te.jsx(yo,{})}),Te.jsx(Ht,{path:"/combat",element:Te.jsx(yo,{})}),Te.jsx(Ht,{path:"/magic",element:Te.jsx(yo,{})}),Te.jsx(Ht,{path:"/dm-center",element:Te.jsx(yo,{})}),Te.jsx(Ht,{path:"/profile",element:Te.jsx(yo,{})}),Te.jsx(Ht,{path:"*",element:Te.jsx(Wt,{to:"/dashboard",replace:!0})})]})})]})}const No=console.warn;console.warn=(...e)=>{const t=e[0];"string"==typeof t&&t.includes("Cross-Origin-Opener-Policy")||No.apply(console,e)},Ee.createRoot(document.getElementById("root")).render(Te.jsx(i.StrictMode,{children:Te.jsx(jo,{})}));export{Hs as T,wa as U,Te as j};
