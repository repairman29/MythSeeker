import{j as e}from"./index-db0beffd.js";import{r as t}from"./react-vendor-132e4a4f.js";import{r as s,d as i,Z as l}from"./ui-vendor-ea82f2ea.js";import"./firebase-core-8eeeb07d.js";import"./firebase-auth-1430596a.js";import"./firebase-firestore-534e8e51.js";import"./firebase-database-c7b0c40e.js";import"./firebase-functions-a61ddb80.js";const n=({combatants:n,battleMap:a,currentTurn:r,activeCombatantId:o,onAction:c,onEndCombat:d,isPlayerTurn:x})=>{const[h,u]=t.useState(null),[m,b]=t.useState(null),[p,f]=t.useState(null),[y,j]=t.useState(null),[v,g]=t.useState([]),[w,k]=t.useState([]),N=n.find(e=>e.id===o),C=t.useCallback(e=>{if(!e||e.currentActionPoints.move<=0)return[];const t=[],s=new Set,i=[{x:e.position.x,y:e.position.y,cost:0}];for(;i.length>0;){const l=i.shift(),n=`${l.x},${l.y}`;if(!s.has(n)&&(s.add(n),l.cost<=e.currentActionPoints.move)){t.push({x:l.x,y:l.y});const e=[{dx:-1,dy:0},{dx:1,dy:0},{dx:0,dy:-1},{dx:0,dy:1}];for(const t of e){const e=l.x+t.dx,s=l.y+t.dy;if(e>=0&&e<a.width&&s>=0&&s<a.height){const t=a.tiles[s][e];if("wall"!==t.type&&!t.occupied){const n="difficult"===t.type?2:1;i.push({x:e,y:s,cost:l.cost+n})}}}}}return t},[a]),A=t.useCallback((e,t)=>{const s=[],i=t?e.skills[t]:null,l=(null==i?void 0:i.range)||e.reach;for(let r=0;r<a.height;r++)for(let t=0;t<a.width;t++)Math.abs(t-e.position.x)+Math.abs(r-e.position.y)<=l&&n.find(s=>s.position.x===t&&s.position.y===r&&s.id!==e.id)&&s.push({x:t,y:r});return s},[n,a]);t.useEffect(()=>{N&&"move"===p?g(C(N)):!N||"attack"!==p&&"skill"!==p?(g([]),k([])):k(A(N,y||void 0))},[N,p,y,C,A]);const $=(e,t)=>{const s=a.tiles[t][e];let i="w-8 h-8 border border-gray-600 cursor-pointer transition-all";if((null==m?void 0:m.x)===e&&(null==m?void 0:m.y)===t)i+=" bg-blue-400/50";else if(v.some(s=>s.x===e&&s.y===t))i+=" bg-green-400/30";else if(w.some(s=>s.x===e&&s.y===t))i+=" bg-red-400/30";else switch(s.type){case"floor":i+=" bg-gray-700";break;case"wall":i+=" bg-gray-900";break;case"difficult":i+=" bg-yellow-700";break;case"hazard":i+=" bg-red-700"}return i},M=e=>"player"===e.type?"ðŸ‘¤":"enemy"===e.type?"ðŸ‘¹":"ðŸ¤–";return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"bg-black/30 border-b border-white/20 p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-white",children:[e.jsxs("h3",{className:"text-lg font-bold",children:["Combat - Turn ",r]}),N&&e.jsxs("p",{className:"text-blue-200",children:[N.name,"'s turn",!x&&" (AI thinking...)"]})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsx("button",{onClick:d,className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition-all",children:"End Combat"})})]})}),e.jsxs("div",{className:"flex-1 flex",children:[e.jsx("div",{className:"flex-1 p-4",children:e.jsx("div",{className:"bg-black/20 rounded-lg p-4",children:e.jsx("div",{className:"grid gap-1",style:{gridTemplateColumns:`repeat(${a.width}, 1fr)`,width:"fit-content"},children:a.tiles.map((t,s)=>t.map((t,i)=>e.jsx("div",{className:$(i,s),onClick:()=>((e,t)=>{N&&x&&("move"===p&&v.some(s=>s.x===e&&s.y===t)?(c({type:"move",target:{x:e,y:t},path:[{x:N.position.x,y:N.position.y},{x:e,y:t}]}),f(null)):"attack"!==p&&"skill"!==p||!w.some(s=>s.x===e&&s.y===t)||(c({type:"attack"===p?"attack":"skill",target:{x:e,y:t},skillId:y||void 0}),f(null),j(null)))})(i,s),onMouseEnter:()=>b({x:i,y:s}),onMouseLeave:()=>b(null),children:n.map(t=>t.position.x===i&&t.position.y===s?e.jsx("div",{className:`w-full h-full flex items-center justify-center text-lg cursor-pointer ${t.id===o?"ring-2 ring-yellow-400":""} ${t.health<=0?"opacity-50":""}`,onClick:()=>(e=>{u(e)})(t),children:M(t)},t.id):null)},`${i}-${s}`)))})})}),e.jsx("div",{className:"w-80 bg-black/20 border-l border-white/20 p-4",children:N&&x?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[e.jsx("h4",{className:"text-white font-semibold",children:N.name}),e.jsxs("div",{className:"text-sm text-blue-200",children:[e.jsxs("div",{children:["Health: ",N.health,"/",N.maxHealth]}),void 0!==N.mana&&e.jsxs("div",{children:["Mana: ",N.mana,"/",N.maxMana]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{children:["Move: ",N.currentActionPoints.move]}),e.jsxs("div",{children:["Action: ",N.currentActionPoints.action]}),e.jsxs("div",{children:["Bonus: ",N.currentActionPoints.bonus]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>f("move"),disabled:N.currentActionPoints.move<=0,className:`w-full px-3 py-2 rounded flex items-center space-x-2 ${"move"===p?"bg-blue-600 text-white":"bg-white/20 text-white hover:bg-white/30"} disabled:opacity-50 disabled:cursor-not-allowed transition-all`,children:[e.jsx(s,{size:16}),e.jsx("span",{children:"Move"})]}),e.jsxs("button",{onClick:()=>f("attack"),disabled:N.currentActionPoints.action<=0,className:`w-full px-3 py-2 rounded flex items-center space-x-2 ${"attack"===p?"bg-red-600 text-white":"bg-white/20 text-white hover:bg-white/30"} disabled:opacity-50 disabled:cursor-not-allowed transition-all`,children:[e.jsx(i,{size:16}),e.jsx("span",{children:"Attack"})]}),e.jsxs("button",{onClick:()=>f("skill"),disabled:N.currentActionPoints.action<=0,className:`w-full px-3 py-2 rounded flex items-center space-x-2 ${"skill"===p?"bg-purple-600 text-white":"bg-white/20 text-white hover:bg-white/30"} disabled:opacity-50 disabled:cursor-not-allowed transition-all`,children:[e.jsx(l,{size:16}),e.jsx("span",{children:"Skills"})]})]}),"skill"===p&&e.jsx("div",{className:"space-y-1",children:Object.entries(N.skills).map(([t,s])=>e.jsxs("button",{onClick:()=>j(t),className:`w-full text-left px-2 py-1 rounded text-sm ${y===t?"bg-purple-600 text-white":"bg-white/10 text-white hover:bg-white/20"} transition-all`,children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsx("div",{className:"text-xs text-blue-200",children:s.description})]},t))}),e.jsx("button",{onClick:()=>{c({type:"end-turn"}),f(null),j(null)},className:"w-full px-3 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-all",children:"End Turn"})]}):e.jsxs("div",{className:"text-center text-white",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-2"}),e.jsx("p",{children:"Waiting for turn..."})]})})]})]})};export{n as default};
